
import requests
import time

def create_fastapi_project():
    """åˆ›å»ºFastAPIé¡¹ç›®çš„å®Œæ•´ç¤ºä¾‹"""
    
    # 1. åˆ›å»ºå¯¹è¯
    conversation_data = {
        "initial_user_msg": "åˆ›å»ºä¸€ä¸ªFastAPIåº”ç”¨ï¼ŒåŒ…å«ï¼š1ï¼‰ç”¨æˆ·æ³¨å†Œ/ç™»å½• 2ï¼‰JWTè®¤è¯ 3ï¼‰SQLAlchemyæ•°æ®åº“æ¨¡å‹ 4ï¼‰RESTful APIç«¯ç‚¹",
        "conversation_instructions": "ä½¿ç”¨ç°ä»£Pythonå¼€å‘æœ€ä½³å®è·µï¼ŒåŒ…å«ç±»å‹æç¤ºã€å¼‚å¸¸å¤„ç†ã€APIæ–‡æ¡£"
    }
    
    response = requests.post(
        "http://localhost:3002/api/conversations",
        json=conversation_data,
        headers={"Content-Type": "application/json"}
    )
    
    if response.status_code != 200:
        print(f"åˆ›å»ºå¯¹è¯å¤±è´¥: {response.text}")
        return None
        
    conversation_id = response.json()["conversation_id"]
    print(f"âœ… å¯¹è¯åˆ›å»ºæˆåŠŸ: {conversation_id}")
    
    # 2. ç­‰å¾…ä»£ç ç”Ÿæˆå®Œæˆ (é€šå¸¸éœ€è¦å‡ åˆ†é’Ÿ)
    time.sleep(30)
    
    # 3. è·å–ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨
    files_response = requests.get(
        f"http://localhost:3002/api/conversations/{conversation_id}/list-files"
    )
    
    if files_response.status_code == 200:
        files = files_response.json()
        print(f"âœ… ç”Ÿæˆäº† {len(files)} ä¸ªæ–‡ä»¶")
        
        # 4. æŸ¥çœ‹ä¸»æ–‡ä»¶å†…å®¹
        for file_path in files[:5]:  # åªçœ‹å‰5ä¸ªæ–‡ä»¶
            content_response = requests.get(
                f"http://localhost:3002/api/conversations/{conversation_id}/select-file",
                params={"file": file_path}
            )
            if content_response.status_code == 200:
                content = content_response.json()["code"]
                print(f"\nğŸ“„ æ–‡ä»¶: {file_path}")
                print(f"å†…å®¹é¢„è§ˆ: {content[:200]}...")
    
    return conversation_id

# è¿è¡Œç¤ºä¾‹
if __name__ == "__main__":
    create_fastapi_project()