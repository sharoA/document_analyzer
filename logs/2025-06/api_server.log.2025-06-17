2025-06-17 16:11:57 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:11:57 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:11:57 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:13:47 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x00000254EB97E450>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: 7f149099-dc64-419e-bb8f-7e9bb3389081)')
2025-06-17 16:13:47 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:13:47 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:13:47 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:13:54 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:13:55 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:13:55 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:15:42 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001DA34AF19D0>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: f5ffe0a0-6739-422e-a677-8fa85dd31434)')
2025-06-17 16:15:42 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:15:42 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:15:42 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:15:42 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200] (0.00s)
2025-06-17 16:15:42 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 16:15:42 - api_server - INFO - ❌ GET get_analysis_result [404] (0.02s)
2025-06-17 16:15:43 - api_server - INFO - ❌ GET /favicon.ico [404]
2025-06-17 16:15:43 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 16:15:43 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 16:15:43 - api_server - INFO - 任务 aec6136e-5836-49b5-9e82-f1edc39e75ac 进度更新: 0% - 分析流程启动中
2025-06-17 16:15:43 - api_server - INFO - 开始完整分析流程: aec6136e-5836-49b5-9e82-f1edc39e75ac
2025-06-17 16:15:43 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: aec6136e-5836-49b5-9e82-f1edc39e75ac, 大小: 849268 bytes
2025-06-17 16:15:43 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: aec6136e-5836-49b5-9e82-f1edc39e75ac
2025-06-17 16:15:43 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.04s)
2025-06-17 16:15:43 - api_server - INFO - 任务 aec6136e-5836-49b5-9e82-f1edc39e75ac 进度更新: 10% - 开始文档解析
2025-06-17 16:15:43 - api_server - INFO - 任务 aec6136e-5836-49b5-9e82-f1edc39e75ac 进度更新: 10% - 开始解析文件
2025-06-17 16:15:43 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\aec6136e-5836-49b5-9e82-f1edc39e75ac_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:15:43 - api_server - INFO - 检测到Word文档，使用Markdown转换: aec6136e-5836-49b5-9e82-f1edc39e75ac_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:15:43 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 16:15:43 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:15:43 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/aec6136e-5836-49b5-9e82-f1edc39e75ac_需求文档 - 一局对接链数优化V0.1_img_20250617_161543_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/aec6136e-5836-49b5-9e82-f1edc39e75ac_需求文档 - 一局对接链数优化V0.1_img_20250617_161543_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:15:43 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:15:43 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/aec6136e-5836-49b5-9e82-f1edc39e75ac_需求文档 - 一局对接链数优化V0.1_img_20250617_161543_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/aec6136e-5836-49b5-9e82-f1edc39e75ac_需求文档 - 一局对接链数优化V0.1_img_20250617_161543_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:15:43 - api_server - INFO - 任务 aec6136e-5836-49b5-9e82-f1edc39e75ac 进度更新: 40% - 使用分析服务解析文档
2025-06-17 16:15:43 - api_server - INFO - 任务 aec6136e-5836-49b5-9e82-f1edc39e75ac 进度更新: 60% - 使用传统方法解析文档
2025-06-17 16:15:43 - api_server - ERROR - 任务 aec6136e-5836-49b5-9e82-f1edc39e75ac 解析失败: name 'file_content' is not defined
2025-06-17 16:15:43 - api_server - ERROR - ❌ 任务 aec6136e-5836-49b5-9e82-f1edc39e75ac 解析失败: name 'file_content' is not defined
2025-06-17 16:15:43 - api_server - INFO - 任务 aec6136e-5836-49b5-9e82-f1edc39e75ac 进度更新: 60% - 文件解析失败: name 'file_content' is not defined
2025-06-17 16:15:43 - api_server - ERROR - 文档解析失败，停止后续流程: aec6136e-5836-49b5-9e82-f1edc39e75ac
2025-06-17 16:15:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:16:09 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 16:16:09 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 16:16:09 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 16:16:09 - api_server - INFO - 任务 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0 进度更新: 0% - 分析流程启动中
2025-06-17 16:16:09 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0, 大小: 849268 bytes
2025-06-17 16:16:09 - api_server - INFO - 开始完整分析流程: 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0
2025-06-17 16:16:09 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0
2025-06-17 16:16:09 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.03s)
2025-06-17 16:16:09 - api_server - INFO - 任务 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0 进度更新: 10% - 开始文档解析
2025-06-17 16:16:09 - api_server - INFO - 任务 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0 进度更新: 10% - 开始解析文件
2025-06-17 16:16:09 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\9656d6d8-c1ea-48cc-b934-d8c7c5d114a0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:16:09 - api_server - INFO - 检测到Word文档，使用Markdown转换: 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:16:09 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 16:16:09 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:16:09 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/9656d6d8-c1ea-48cc-b934-d8c7c5d114a0_需求文档 - 一局对接链数优化V0.1_img_20250617_161609_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/9656d6d8-c1ea-48cc-b934-d8c7c5d114a0_需求文档 - 一局对接链数优化V0.1_img_20250617_161609_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:16:09 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:16:09 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/9656d6d8-c1ea-48cc-b934-d8c7c5d114a0_需求文档 - 一局对接链数优化V0.1_img_20250617_161609_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/9656d6d8-c1ea-48cc-b934-d8c7c5d114a0_需求文档 - 一局对接链数优化V0.1_img_20250617_161609_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:16:09 - api_server - INFO - 任务 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0 进度更新: 40% - 使用分析服务解析文档
2025-06-17 16:16:09 - api_server - INFO - 任务 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0 进度更新: 60% - 使用传统方法解析文档
2025-06-17 16:16:09 - api_server - ERROR - 任务 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0 解析失败: name 'file_content' is not defined
2025-06-17 16:16:09 - api_server - ERROR - ❌ 任务 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0 解析失败: name 'file_content' is not defined
2025-06-17 16:16:09 - api_server - INFO - 任务 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0 进度更新: 60% - 文件解析失败: name 'file_content' is not defined
2025-06-17 16:16:09 - api_server - ERROR - 文档解析失败，停止后续流程: 9656d6d8-c1ea-48cc-b934-d8c7c5d114a0
2025-06-17 16:16:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:16:22 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 16:16:22 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 16:16:22 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 16:16:22 - api_server - INFO - 任务 0bb72504-b846-48ed-b512-2dcc686bbe82 进度更新: 0% - 分析流程启动中
2025-06-17 16:16:22 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 0bb72504-b846-48ed-b512-2dcc686bbe82, 大小: 849268 bytes
2025-06-17 16:16:22 - api_server - INFO - 开始完整分析流程: 0bb72504-b846-48ed-b512-2dcc686bbe82
2025-06-17 16:16:22 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 0bb72504-b846-48ed-b512-2dcc686bbe82
2025-06-17 16:16:22 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.03s)
2025-06-17 16:16:22 - api_server - INFO - 任务 0bb72504-b846-48ed-b512-2dcc686bbe82 进度更新: 10% - 开始文档解析
2025-06-17 16:16:22 - api_server - INFO - 任务 0bb72504-b846-48ed-b512-2dcc686bbe82 进度更新: 10% - 开始解析文件
2025-06-17 16:16:22 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\0bb72504-b846-48ed-b512-2dcc686bbe82_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:16:22 - api_server - INFO - 检测到Word文档，使用Markdown转换: 0bb72504-b846-48ed-b512-2dcc686bbe82_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:16:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:16:22 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 16:16:22 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:16:22 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/0bb72504-b846-48ed-b512-2dcc686bbe82_需求文档 - 一局对接链数优化V0.1_img_20250617_161622_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/0bb72504-b846-48ed-b512-2dcc686bbe82_需求文档 - 一局对接链数优化V0.1_img_20250617_161622_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:16:22 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:16:22 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/0bb72504-b846-48ed-b512-2dcc686bbe82_需求文档 - 一局对接链数优化V0.1_img_20250617_161622_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/0bb72504-b846-48ed-b512-2dcc686bbe82_需求文档 - 一局对接链数优化V0.1_img_20250617_161622_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:16:22 - api_server - INFO - 任务 0bb72504-b846-48ed-b512-2dcc686bbe82 进度更新: 40% - 使用分析服务解析文档
2025-06-17 16:16:22 - api_server - INFO - 任务 0bb72504-b846-48ed-b512-2dcc686bbe82 进度更新: 60% - 使用传统方法解析文档
2025-06-17 16:16:22 - api_server - ERROR - 任务 0bb72504-b846-48ed-b512-2dcc686bbe82 解析失败: name 'file_content' is not defined
2025-06-17 16:16:22 - api_server - ERROR - ❌ 任务 0bb72504-b846-48ed-b512-2dcc686bbe82 解析失败: name 'file_content' is not defined
2025-06-17 16:16:22 - api_server - INFO - 任务 0bb72504-b846-48ed-b512-2dcc686bbe82 进度更新: 60% - 文件解析失败: name 'file_content' is not defined
2025-06-17 16:16:22 - api_server - ERROR - 文档解析失败，停止后续流程: 0bb72504-b846-48ed-b512-2dcc686bbe82
2025-06-17 16:16:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:17:39 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:17:39 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:17:39 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:19:28 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001D277A8E550>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: 51e4fbac-a50b-4b01-8f07-7b51c7d5fcde)')
2025-06-17 16:19:28 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:19:28 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:19:28 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:19:57 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:19:57 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:19:57 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:21:44 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001817077DE50>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: 72ccb9d4-6427-4e3c-ba51-571c69f2a0f4)')
2025-06-17 16:21:44 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:21:44 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:21:44 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:21:51 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:21:52 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:21:52 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:23:39 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x00000216641E3990>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: cbc580ac-a058-4228-a12e-6b99d3b213b8)')
2025-06-17 16:23:39 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:23:39 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:23:39 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:23:40 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 16:23:40 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 16:23:40 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 16:23:40 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 0% - 分析流程启动中
2025-06-17 16:23:40 - api_server - INFO - 开始完整分析流程: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:23:40 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: ba1fb2ec-05a3-474e-94da-d854e3742200, 大小: 849268 bytes
2025-06-17 16:23:40 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:23:40 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.08s)
2025-06-17 16:23:40 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 10% - 开始文档解析
2025-06-17 16:23:40 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 10% - 开始解析文件
2025-06-17 16:23:40 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\ba1fb2ec-05a3-474e-94da-d854e3742200_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:23:40 - api_server - INFO - 检测到Word文档，使用Markdown转换: ba1fb2ec-05a3-474e-94da-d854e3742200_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:23:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-06-17 16:23:40 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 16:23:40 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:23:40 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/ba1fb2ec-05a3-474e-94da-d854e3742200_需求文档 - 一局对接链数优化V0.1_img_20250617_162340_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/ba1fb2ec-05a3-474e-94da-d854e3742200_需求文档 - 一局对接链数优化V0.1_img_20250617_162340_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:23:40 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:23:40 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/ba1fb2ec-05a3-474e-94da-d854e3742200_需求文档 - 一局对接链数优化V0.1_img_20250617_162340_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/ba1fb2ec-05a3-474e-94da-d854e3742200_需求文档 - 一局对接链数优化V0.1_img_20250617_162340_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:23:40 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 40% - 使用分析服务解析文档
2025-06-17 16:23:40 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 60% - 使用传统方法解析文档
2025-06-17 16:23:40 - api_server - ERROR - Word文档解析失败: 'EnhancedAnalyzer' object has no attribute 'analyze_file'
2025-06-17 16:23:40 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 100% - 文档解析完成
2025-06-17 16:23:40 - api_server - INFO - 文件解析完成: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:23:40 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 40% - 开始内容分析
2025-06-17 16:23:40 - api_server - INFO - 🔍 开始内容分析任务: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:23:40 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 16:23:40 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 16:23:40 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 16:23:40 - api_server - INFO - 📊 分析服务管理器可用: False
2025-06-17 16:23:40 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 10% - 开始内容分析
2025-06-17 16:23:40 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 16:23:40 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\ba1fb2ec-05a3-474e-94da-d854e3742200_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:23:40 - api_server - INFO - 检测到Word文档，使用Markdown转换: ba1fb2ec-05a3-474e-94da-d854e3742200_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:23:41 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 16:23:41 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 30% - 获取到上传文件
2025-06-17 16:23:41 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 16:23:41 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 30% - 使用传统方法进行内容分析
2025-06-17 16:23:41 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 50% - 识别CRUD操作和业务功能
2025-06-17 16:23:41 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 100% - 内容分析完成
2025-06-17 16:23:41 - api_server - INFO - ✅ 内容分析完成: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:23:41 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 70% - 开始AI智能分析
2025-06-17 16:23:41 - api_server - INFO - 🤖 开始AI分析任务: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:23:41 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 10% - 开始AI智能分析
2025-06-17 16:23:41 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 30% - 使用传统方法进行AI分析
2025-06-17 16:23:41 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 50% - 调用AI进行接口设计分析
2025-06-17 16:23:41 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 70% - AI模型分析中
2025-06-17 16:23:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:23:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:23:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:23:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:23:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:23:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:23:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:23:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:24:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:29 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 100% - AI分析完成
2025-06-17 16:24:29 - api_server - INFO - AI分析完成: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:24:29 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 90% - 开始生成文档
2025-06-17 16:24:29 - api_server - INFO - 开始生成文档: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:24:29 - api_server - INFO - 📄 开始文档生成任务: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:24:29 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 10% - 准备生成文档
2025-06-17 16:24:29 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 30% - 获取分析结果数据
2025-06-17 16:24:29 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 16:24:29 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 60% - 转换为Markdown格式
2025-06-17 16:24:29 - api_server - INFO - 开始生成Markdown报告，数据键: ['analysis_type', 'ai_insights', 'ai_response', 'confidence_score', 'analysis_timestamp', 'analysis_duration', 'method']
2025-06-17 16:24:29 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 16:24:29 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 90% - 保存文档内容
2025-06-17 16:24:29 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 100% - 文档生成完成
2025-06-17 16:24:29 - api_server - INFO - 文档生成完成: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:24:29 - api_server - INFO - ✅ 文档生成完成: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:24:29 - api_server - INFO - 任务 ba1fb2ec-05a3-474e-94da-d854e3742200 进度更新: 100% - 完整分析流程完成
2025-06-17 16:24:29 - api_server - INFO - 完整分析流程成功完成: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:24:29 - api_server - INFO - 🎉 完整分析流程完成: ba1fb2ec-05a3-474e-94da-d854e3742200
2025-06-17 16:24:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:24:30 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 16:26:24 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:26:25 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:26:25 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:28:10 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001D19A315B50>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: 1f789fb7-9f63-4cbf-af64-2ddf003e2f7e)')
2025-06-17 16:28:10 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:28:10 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:28:10 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:28:16 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:28:16 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:28:16 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:29:28 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:29:28 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:29:28 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:30:03 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x0000028B00054590>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: d7dca2bd-4e97-42b0-aa5b-b1513f91b9ef)')
2025-06-17 16:30:03 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:30:03 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:30:03 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:30:04 - api_server - INFO - ✅ GET health_check [200] (0.00s)
2025-06-17 16:31:13 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x0000027BDF492A10>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: c8925c7f-e334-4878-a533-5331316e772c)')
2025-06-17 16:31:13 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:31:13 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:31:13 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:31:23 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:31:23 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:31:23 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:38:24 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:38:25 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:38:25 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:38:32 - api_server - INFO - 分析服务管理器初始化成功
2025-06-17 16:38:32 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-06-17 16:38:32 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:38:32 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:38:32 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:38:40 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 16:38:40 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 16:38:40 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 16:38:48 - api_server - INFO - 分析服务管理器初始化成功
2025-06-17 16:38:48 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-06-17 16:38:48 - api_server - INFO - 增强分析器初始化成功
2025-06-17 16:38:48 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 16:38:48 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 16:39:27 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 16:39:28 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 16:39:28 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 16:39:28 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 0% - 分析流程启动中
2025-06-17 16:39:28 - api_server - INFO - 开始完整分析流程: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:39:28 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 283abf50-4340-47c3-b0e1-8e5b369d96f0, 大小: 849268 bytes
2025-06-17 16:39:28 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:39:28 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.10s)
2025-06-17 16:39:28 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 10% - 开始文档解析
2025-06-17 16:39:28 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 10% - 开始解析文件
2025-06-17 16:39:28 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\283abf50-4340-47c3-b0e1-8e5b369d96f0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:39:28 - api_server - INFO - 检测到Word文档，使用Markdown转换: 283abf50-4340-47c3-b0e1-8e5b369d96f0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:39:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:39:28 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 16:39:28 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:39:28 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/283abf50-4340-47c3-b0e1-8e5b369d96f0_需求文档 - 一局对接链数优化V0.1_img_20250617_163928_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/283abf50-4340-47c3-b0e1-8e5b369d96f0_需求文档 - 一局对接链数优化V0.1_img_20250617_163928_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:39:28 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 16:39:28 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/283abf50-4340-47c3-b0e1-8e5b369d96f0_需求文档 - 一局对接链数优化V0.1_img_20250617_163928_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/283abf50-4340-47c3-b0e1-8e5b369d96f0_需求文档 - 一局对接链数优化V0.1_img_20250617_163928_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 16:39:28 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 40% - 使用分析服务解析文档
2025-06-17 16:39:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:39:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:39:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:39:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:39:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:39:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:39:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:39:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:39:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:39:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:39:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:39:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:39:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:39:57 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 100% - 文档解析完成
2025-06-17 16:39:57 - api_server - INFO - ✅ 文件解析完成: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:39:57 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 40% - 开始内容分析
2025-06-17 16:39:57 - api_server - INFO - 🔍 开始内容分析任务: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:39:57 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 16:39:57 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 16:39:57 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 16:39:57 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 16:39:57 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 10% - 开始内容分析
2025-06-17 16:39:57 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 16:39:57 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\283abf50-4340-47c3-b0e1-8e5b369d96f0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:39:57 - api_server - INFO - 检测到Word文档，使用Markdown转换: 283abf50-4340-47c3-b0e1-8e5b369d96f0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 16:39:57 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 16:39:57 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 30% - 获取到上传文件
2025-06-17 16:39:57 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 16:39:57 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 16:39:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:40:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:40:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:14 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 100% - 内容分析完成
2025-06-17 16:41:14 - api_server - INFO - ✅ 内容分析完成: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:41:14 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 70% - 开始AI智能分析
2025-06-17 16:41:14 - api_server - INFO - 🤖 开始AI分析任务: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:41:14 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 10% - 开始AI智能分析
2025-06-17 16:41:14 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 16:41:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:41:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:41:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:42:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:42:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:42:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:42:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:42:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:42:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:42:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:42:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:42:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:42:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 16:42:21 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 100% - AI分析完成
2025-06-17 16:42:21 - api_server - INFO - ✅ AI分析完成: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:42:21 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 90% - 开始生成文档
2025-06-17 16:42:21 - api_server - INFO - 开始生成文档: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:42:21 - api_server - INFO - 📄 开始文档生成任务: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:42:21 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 10% - 准备生成文档
2025-06-17 16:42:21 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 30% - 获取分析结果数据
2025-06-17 16:42:21 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 16:42:21 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 60% - 转换为Markdown格式
2025-06-17 16:42:21 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 16:42:21 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 16:42:21 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 90% - 保存文档内容
2025-06-17 16:42:21 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 100% - 文档生成完成
2025-06-17 16:42:21 - api_server - INFO - 文档生成完成: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:42:21 - api_server - INFO - ✅ 文档生成完成: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:42:21 - api_server - INFO - 任务 283abf50-4340-47c3-b0e1-8e5b369d96f0 进度更新: 100% - 完整分析流程完成
2025-06-17 16:42:21 - api_server - INFO - 完整分析流程成功完成: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:42:21 - api_server - INFO - 🎉 完整分析流程完成: 283abf50-4340-47c3-b0e1-8e5b369d96f0
2025-06-17 16:42:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 16:42:23 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 17:17:54 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 17:17:54 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 17:17:54 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 17:17:55 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 0% - 分析流程启动中
2025-06-17 17:17:55 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: f183e79b-0d3b-4329-8e51-9ecffb3749c0, 大小: 849268 bytes
2025-06-17 17:17:55 - api_server - INFO - 开始完整分析流程: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:17:55 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:17:55 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.04s)
2025-06-17 17:17:55 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 10% - 开始文档解析
2025-06-17 17:17:55 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 10% - 开始解析文件
2025-06-17 17:17:55 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\f183e79b-0d3b-4329-8e51-9ecffb3749c0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 17:17:55 - api_server - INFO - 检测到Word文档，使用Markdown转换: f183e79b-0d3b-4329-8e51-9ecffb3749c0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 17:17:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:17:55 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 17:17:55 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 17:17:55 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/f183e79b-0d3b-4329-8e51-9ecffb3749c0_需求文档 - 一局对接链数优化V0.1_img_20250617_171755_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/f183e79b-0d3b-4329-8e51-9ecffb3749c0_需求文档 - 一局对接链数优化V0.1_img_20250617_171755_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 17:17:55 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 17:17:55 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/f183e79b-0d3b-4329-8e51-9ecffb3749c0_需求文档 - 一局对接链数优化V0.1_img_20250617_171755_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/f183e79b-0d3b-4329-8e51-9ecffb3749c0_需求文档 - 一局对接链数优化V0.1_img_20250617_171755_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 17:17:55 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 40% - 使用分析服务解析文档
2025-06-17 17:17:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:17:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-06-17 17:18:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:21 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 100% - 文档解析完成
2025-06-17 17:18:21 - api_server - INFO - ✅ 文件解析完成: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:18:21 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 40% - 开始内容分析
2025-06-17 17:18:21 - api_server - INFO - 🔍 开始内容分析任务: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:18:21 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 17:18:21 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 17:18:21 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 17:18:21 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 17:18:21 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 10% - 开始内容分析
2025-06-17 17:18:21 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 17:18:21 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\f183e79b-0d3b-4329-8e51-9ecffb3749c0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 17:18:21 - api_server - INFO - 检测到Word文档，使用Markdown转换: f183e79b-0d3b-4329-8e51-9ecffb3749c0_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 17:18:21 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 17:18:21 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 30% - 获取到上传文件
2025-06-17 17:18:21 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 17:18:21 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 17:18:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:18:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:18:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:19:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:19:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:19:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:19:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:19:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:34 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 100% - 内容分析完成
2025-06-17 17:19:34 - api_server - INFO - ✅ 内容分析完成: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:19:34 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 70% - 开始AI智能分析
2025-06-17 17:19:34 - api_server - INFO - 🤖 开始AI分析任务: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:19:34 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 10% - 开始AI智能分析
2025-06-17 17:19:34 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 17:19:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:19:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:19:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:19:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:19:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:20:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:27 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 100% - AI分析完成
2025-06-17 17:20:27 - api_server - INFO - ✅ AI分析完成: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:20:27 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 90% - 开始生成文档
2025-06-17 17:20:27 - api_server - INFO - 开始生成文档: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:20:27 - api_server - INFO - 📄 开始文档生成任务: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:20:27 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 10% - 准备生成文档
2025-06-17 17:20:27 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 30% - 获取分析结果数据
2025-06-17 17:20:27 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 17:20:27 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 60% - 转换为Markdown格式
2025-06-17 17:20:27 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 17:20:27 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 17:20:27 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 90% - 保存文档内容
2025-06-17 17:20:27 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 100% - 文档生成完成
2025-06-17 17:20:27 - api_server - INFO - 文档生成完成: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:20:27 - api_server - INFO - ✅ 文档生成完成: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:20:27 - api_server - INFO - 任务 f183e79b-0d3b-4329-8e51-9ecffb3749c0 进度更新: 100% - 完整分析流程完成
2025-06-17 17:20:27 - api_server - INFO - 完整分析流程成功完成: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:20:27 - api_server - INFO - 🎉 完整分析流程完成: f183e79b-0d3b-4329-8e51-9ecffb3749c0
2025-06-17 17:20:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:20:30 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 17:44:48 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200] (0.00s)
2025-06-17 17:44:48 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 17:44:48 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 17:44:48 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 0% - 分析流程启动中
2025-06-17 17:44:48 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 8c496df0-6525-4d9d-82b1-77160f5052cc, 大小: 849268 bytes
2025-06-17 17:44:48 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:44:48 - api_server - INFO - 开始完整分析流程: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:44:48 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.05s)
2025-06-17 17:44:48 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 10% - 开始文档解析
2025-06-17 17:44:48 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 10% - 开始解析文件
2025-06-17 17:44:48 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\8c496df0-6525-4d9d-82b1-77160f5052cc_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 17:44:48 - api_server - INFO - 检测到Word文档，使用Markdown转换: 8c496df0-6525-4d9d-82b1-77160f5052cc_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 17:44:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-06-17 17:44:48 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 17:44:48 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 17:44:48 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/8c496df0-6525-4d9d-82b1-77160f5052cc_需求文档 - 一局对接链数优化V0.1_img_20250617_174448_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/8c496df0-6525-4d9d-82b1-77160f5052cc_需求文档 - 一局对接链数优化V0.1_img_20250617_174448_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 17:44:48 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 17:44:48 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/8c496df0-6525-4d9d-82b1-77160f5052cc_需求文档 - 一局对接链数优化V0.1_img_20250617_174448_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/8c496df0-6525-4d9d-82b1-77160f5052cc_需求文档 - 一局对接链数优化V0.1_img_20250617_174448_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 17:44:48 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 40% - 使用分析服务解析文档
2025-06-17 17:44:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:44:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:44:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:44:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:44:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:17 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 100% - 文档解析完成
2025-06-17 17:45:17 - api_server - INFO - ✅ 文件解析完成: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:45:17 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 40% - 开始内容分析
2025-06-17 17:45:17 - api_server - INFO - 🔍 开始内容分析任务: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:45:17 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 17:45:17 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 17:45:17 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 17:45:17 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 17:45:17 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 10% - 开始内容分析
2025-06-17 17:45:17 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 17:45:17 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\8c496df0-6525-4d9d-82b1-77160f5052cc_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 17:45:17 - api_server - INFO - 检测到Word文档，使用Markdown转换: 8c496df0-6525-4d9d-82b1-77160f5052cc_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 17:45:17 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 17:45:17 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 30% - 获取到上传文件
2025-06-17 17:45:17 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 17:45:17 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 17:45:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:45:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:45:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:46:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:46:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:46:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:46:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:31 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 100% - 内容分析完成
2025-06-17 17:46:31 - api_server - INFO - ✅ 内容分析完成: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:46:31 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 70% - 开始AI智能分析
2025-06-17 17:46:31 - api_server - INFO - 🤖 开始AI分析任务: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:46:31 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 10% - 开始AI智能分析
2025-06-17 17:46:31 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 17:46:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:46:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:46:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:46:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:46:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:46:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:46:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:47:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:47:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:47:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:47:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:47:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:47:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:47:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:47:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:47:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:47:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:47:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:47:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:47:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:47:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:47:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:47:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 17:47:34 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 100% - AI分析完成
2025-06-17 17:47:34 - api_server - INFO - ✅ AI分析完成: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:47:34 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 90% - 开始生成文档
2025-06-17 17:47:34 - api_server - INFO - 开始生成文档: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:47:34 - api_server - INFO - 📄 开始文档生成任务: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:47:34 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 10% - 准备生成文档
2025-06-17 17:47:34 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 30% - 获取分析结果数据
2025-06-17 17:47:34 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 17:47:34 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 60% - 转换为Markdown格式
2025-06-17 17:47:34 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 17:47:34 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 17:47:34 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 90% - 保存文档内容
2025-06-17 17:47:34 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 100% - 文档生成完成
2025-06-17 17:47:34 - api_server - INFO - 文档生成完成: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:47:34 - api_server - INFO - ✅ 文档生成完成: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:47:34 - api_server - INFO - 任务 8c496df0-6525-4d9d-82b1-77160f5052cc 进度更新: 100% - 完整分析流程完成
2025-06-17 17:47:34 - api_server - INFO - 完整分析流程成功完成: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:47:34 - api_server - INFO - 🎉 完整分析流程完成: 8c496df0-6525-4d9d-82b1-77160f5052cc
2025-06-17 17:47:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 17:47:36 - api_server - INFO - ✅ GET get_analysis_result [200] (0.02s)
2025-06-17 18:33:03 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 18:33:03 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 18:33:03 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 18:33:03 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 0% - 分析流程启动中
2025-06-17 18:33:03 - api_server - INFO - 开始完整分析流程: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:33:04 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4, 大小: 849268 bytes
2025-06-17 18:33:04 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:33:04 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.05s)
2025-06-17 18:33:04 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 10% - 开始文档解析
2025-06-17 18:33:04 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 10% - 开始解析文件
2025-06-17 18:33:04 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\09dfe921-18dd-4ffd-ab74-9f6a2e55ace4_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 18:33:04 - api_server - INFO - 检测到Word文档，使用Markdown转换: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 18:33:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:33:04 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 18:33:04 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 18:33:04 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/09dfe921-18dd-4ffd-ab74-9f6a2e55ace4_需求文档 - 一局对接链数优化V0.1_img_20250617_183304_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/09dfe921-18dd-4ffd-ab74-9f6a2e55ace4_需求文档 - 一局对接链数优化V0.1_img_20250617_183304_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 18:33:04 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 18:33:04 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/09dfe921-18dd-4ffd-ab74-9f6a2e55ace4_需求文档 - 一局对接链数优化V0.1_img_20250617_183304_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/09dfe921-18dd-4ffd-ab74-9f6a2e55ace4_需求文档 - 一局对接链数优化V0.1_img_20250617_183304_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 18:33:04 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 40% - 使用分析服务解析文档
2025-06-17 18:33:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:33:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-06-17 18:33:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:33:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:25 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 100% - 文档解析完成
2025-06-17 18:33:25 - api_server - INFO - ✅ 文件解析完成: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:33:25 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 40% - 开始内容分析
2025-06-17 18:33:25 - api_server - INFO - 🔍 开始内容分析任务: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:33:25 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 18:33:25 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 18:33:25 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 18:33:25 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 18:33:25 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 10% - 开始内容分析
2025-06-17 18:33:25 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 18:33:25 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\09dfe921-18dd-4ffd-ab74-9f6a2e55ace4_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 18:33:25 - api_server - INFO - 检测到Word文档，使用Markdown转换: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 18:33:25 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 18:33:25 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 30% - 获取到上传文件
2025-06-17 18:33:25 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 18:33:25 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 18:33:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:33:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:33:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:33:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:33:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:33:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:33:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:34:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:34:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:34:22 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 100% - 内容分析完成
2025-06-17 18:34:22 - api_server - INFO - ✅ 内容分析完成: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:34:22 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 70% - 开始AI智能分析
2025-06-17 18:34:22 - api_server - INFO - 🤖 开始AI分析任务: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:34:22 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 10% - 开始AI智能分析
2025-06-17 18:34:22 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 18:34:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:34:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:34:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:34:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:34:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:34:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:34:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-06-17 18:34:55 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 100% - AI分析完成
2025-06-17 18:34:55 - api_server - INFO - ✅ AI分析完成: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:34:55 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 90% - 开始生成文档
2025-06-17 18:34:55 - api_server - INFO - 开始生成文档: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:34:55 - api_server - INFO - 📄 开始文档生成任务: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:34:55 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 10% - 准备生成文档
2025-06-17 18:34:55 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 30% - 获取分析结果数据
2025-06-17 18:34:55 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 18:34:55 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 60% - 转换为Markdown格式
2025-06-17 18:34:55 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 18:34:55 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 18:34:55 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 90% - 保存文档内容
2025-06-17 18:34:55 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 100% - 文档生成完成
2025-06-17 18:34:55 - api_server - INFO - 文档生成完成: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:34:55 - api_server - INFO - ✅ 文档生成完成: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:34:55 - api_server - INFO - 任务 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4 进度更新: 100% - 完整分析流程完成
2025-06-17 18:34:55 - api_server - INFO - 完整分析流程成功完成: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:34:55 - api_server - INFO - 🎉 完整分析流程完成: 09dfe921-18dd-4ffd-ab74-9f6a2e55ace4
2025-06-17 18:34:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:34:56 - api_server - INFO - ✅ GET get_analysis_result [200] (0.02s)
2025-06-17 18:47:01 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 18:47:01 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 18:47:01 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 18:47:01 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 0% - 分析流程启动中
2025-06-17 18:47:01 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 82e1e407-ca59-42d2-8be5-590e1ab70133, 大小: 849268 bytes
2025-06-17 18:47:01 - api_server - INFO - 开始完整分析流程: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:47:01 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:47:01 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.03s)
2025-06-17 18:47:01 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 10% - 开始文档解析
2025-06-17 18:47:01 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 10% - 开始解析文件
2025-06-17 18:47:01 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\82e1e407-ca59-42d2-8be5-590e1ab70133_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 18:47:01 - api_server - INFO - 检测到Word文档，使用Markdown转换: 82e1e407-ca59-42d2-8be5-590e1ab70133_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 18:47:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:01 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 18:47:01 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 18:47:01 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/82e1e407-ca59-42d2-8be5-590e1ab70133_需求文档 - 一局对接链数优化V0.1_img_20250617_184701_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/82e1e407-ca59-42d2-8be5-590e1ab70133_需求文档 - 一局对接链数优化V0.1_img_20250617_184701_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 18:47:01 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 18:47:01 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/82e1e407-ca59-42d2-8be5-590e1ab70133_需求文档 - 一局对接链数优化V0.1_img_20250617_184701_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/82e1e407-ca59-42d2-8be5-590e1ab70133_需求文档 - 一局对接链数优化V0.1_img_20250617_184701_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 18:47:01 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 40% - 使用分析服务解析文档
2025-06-17 18:47:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:47:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:47:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:47:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:47:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:47:22 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 100% - 文档解析完成
2025-06-17 18:47:22 - api_server - INFO - ✅ 文件解析完成: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:47:22 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 40% - 开始内容分析
2025-06-17 18:47:22 - api_server - INFO - 🔍 开始内容分析任务: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:47:22 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 18:47:22 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 18:47:22 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 18:47:22 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 18:47:22 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 10% - 开始内容分析
2025-06-17 18:47:22 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 18:47:22 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\82e1e407-ca59-42d2-8be5-590e1ab70133_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 18:47:22 - api_server - INFO - 检测到Word文档，使用Markdown转换: 82e1e407-ca59-42d2-8be5-590e1ab70133_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 18:47:22 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 18:47:22 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 30% - 获取到上传文件
2025-06-17 18:47:22 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 18:47:22 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 18:47:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:47:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:47:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:47:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:47:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:13 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 100% - 内容分析完成
2025-06-17 18:48:13 - api_server - INFO - ✅ 内容分析完成: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:48:13 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 70% - 开始AI智能分析
2025-06-17 18:48:13 - api_server - INFO - 🤖 开始AI分析任务: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:48:13 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 10% - 开始AI智能分析
2025-06-17 18:48:13 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 18:48:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:48:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:48:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 18:48:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:47 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 100% - AI分析完成
2025-06-17 18:48:47 - api_server - INFO - ✅ AI分析完成: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:48:47 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 90% - 开始生成文档
2025-06-17 18:48:47 - api_server - INFO - 开始生成文档: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:48:47 - api_server - INFO - 📄 开始文档生成任务: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:48:47 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 10% - 准备生成文档
2025-06-17 18:48:47 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 30% - 获取分析结果数据
2025-06-17 18:48:47 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 18:48:47 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 60% - 转换为Markdown格式
2025-06-17 18:48:47 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 18:48:47 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 18:48:47 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 90% - 保存文档内容
2025-06-17 18:48:47 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 100% - 文档生成完成
2025-06-17 18:48:47 - api_server - INFO - 文档生成完成: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:48:47 - api_server - INFO - ✅ 文档生成完成: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:48:47 - api_server - INFO - 任务 82e1e407-ca59-42d2-8be5-590e1ab70133 进度更新: 100% - 完整分析流程完成
2025-06-17 18:48:47 - api_server - INFO - 完整分析流程成功完成: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:48:47 - api_server - INFO - 🎉 完整分析流程完成: 82e1e407-ca59-42d2-8be5-590e1ab70133
2025-06-17 18:48:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 18:48:49 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 19:03:32 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 19:03:32 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 19:03:32 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 19:03:32 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 0% - 分析流程启动中
2025-06-17 19:03:32 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: efefc7ca-38a3-4ad4-80ae-a74652fec4ef, 大小: 849268 bytes
2025-06-17 19:03:32 - api_server - INFO - 开始完整分析流程: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:03:32 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:03:32 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.11s)
2025-06-17 19:03:32 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 10% - 开始文档解析
2025-06-17 19:03:32 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 10% - 开始解析文件
2025-06-17 19:03:32 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\efefc7ca-38a3-4ad4-80ae-a74652fec4ef_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:03:32 - api_server - INFO - 检测到Word文档，使用Markdown转换: efefc7ca-38a3-4ad4-80ae-a74652fec4ef_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:03:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:33 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 19:03:33 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 19:03:33 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/efefc7ca-38a3-4ad4-80ae-a74652fec4ef_需求文档 - 一局对接链数优化V0.1_img_20250617_190332_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/efefc7ca-38a3-4ad4-80ae-a74652fec4ef_需求文档 - 一局对接链数优化V0.1_img_20250617_190332_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 19:03:33 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 19:03:33 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/efefc7ca-38a3-4ad4-80ae-a74652fec4ef_需求文档 - 一局对接链数优化V0.1_img_20250617_190332_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/efefc7ca-38a3-4ad4-80ae-a74652fec4ef_需求文档 - 一局对接链数优化V0.1_img_20250617_190332_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 19:03:33 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 40% - 使用分析服务解析文档
2025-06-17 19:03:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:03:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:03:55 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 100% - 文档解析完成
2025-06-17 19:03:55 - api_server - INFO - ✅ 文件解析完成: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:03:55 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 40% - 开始内容分析
2025-06-17 19:03:55 - api_server - INFO - 🔍 开始内容分析任务: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:03:55 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 19:03:55 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 19:03:55 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 19:03:55 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 19:03:55 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 10% - 开始内容分析
2025-06-17 19:03:55 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 19:03:55 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\efefc7ca-38a3-4ad4-80ae-a74652fec4ef_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:03:55 - api_server - INFO - 检测到Word文档，使用Markdown转换: efefc7ca-38a3-4ad4-80ae-a74652fec4ef_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:03:55 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 19:03:55 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 30% - 获取到上传文件
2025-06-17 19:03:55 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 19:03:55 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 19:03:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:03:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:04:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:04:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:04:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-06-17 19:04:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:04:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:04:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:04:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:04:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:04:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:04:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:04:58 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 100% - 内容分析完成
2025-06-17 19:04:58 - api_server - INFO - ✅ 内容分析完成: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:04:58 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 70% - 开始AI智能分析
2025-06-17 19:04:58 - api_server - INFO - 🤖 开始AI分析任务: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:04:58 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 10% - 开始AI智能分析
2025-06-17 19:04:58 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 19:05:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:05:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:05:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-06-17 19:05:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:05:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:05:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:05:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:05:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:05:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:05:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:05:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:05:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:06:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:06:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:06:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:06:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:06:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:06:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:06:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:06:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:06:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:06:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:06:21 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 100% - AI分析完成
2025-06-17 19:06:21 - api_server - INFO - ✅ AI分析完成: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:06:21 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 90% - 开始生成文档
2025-06-17 19:06:21 - api_server - INFO - 开始生成文档: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:06:21 - api_server - INFO - 📄 开始文档生成任务: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:06:21 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 10% - 准备生成文档
2025-06-17 19:06:21 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 30% - 获取分析结果数据
2025-06-17 19:06:21 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 19:06:21 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 60% - 转换为Markdown格式
2025-06-17 19:06:21 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 19:06:21 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 19:06:21 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 90% - 保存文档内容
2025-06-17 19:06:21 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 100% - 文档生成完成
2025-06-17 19:06:21 - api_server - INFO - 文档生成完成: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:06:21 - api_server - INFO - ✅ 文档生成完成: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:06:21 - api_server - INFO - 任务 efefc7ca-38a3-4ad4-80ae-a74652fec4ef 进度更新: 100% - 完整分析流程完成
2025-06-17 19:06:21 - api_server - INFO - 完整分析流程成功完成: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:06:21 - api_server - INFO - 🎉 完整分析流程完成: efefc7ca-38a3-4ad4-80ae-a74652fec4ef
2025-06-17 19:06:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:06:23 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 19:14:45 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 19:14:45 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 19:14:45 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 19:14:45 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 0% - 分析流程启动中
2025-06-17 19:14:45 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 4ba58b62-89b6-4384-84c3-488ba39c1fe9, 大小: 849268 bytes
2025-06-17 19:14:45 - api_server - INFO - 开始完整分析流程: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:14:45 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:14:45 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.03s)
2025-06-17 19:14:45 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 10% - 开始文档解析
2025-06-17 19:14:45 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 10% - 开始解析文件
2025-06-17 19:14:45 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\4ba58b62-89b6-4384-84c3-488ba39c1fe9_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:14:45 - api_server - INFO - 检测到Word文档，使用Markdown转换: 4ba58b62-89b6-4384-84c3-488ba39c1fe9_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:14:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-06-17 19:14:45 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 19:14:45 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 19:14:45 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/4ba58b62-89b6-4384-84c3-488ba39c1fe9_需求文档 - 一局对接链数优化V0.1_img_20250617_191445_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/4ba58b62-89b6-4384-84c3-488ba39c1fe9_需求文档 - 一局对接链数优化V0.1_img_20250617_191445_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 19:14:45 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 19:14:45 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/4ba58b62-89b6-4384-84c3-488ba39c1fe9_需求文档 - 一局对接链数优化V0.1_img_20250617_191445_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/4ba58b62-89b6-4384-84c3-488ba39c1fe9_需求文档 - 一局对接链数优化V0.1_img_20250617_191445_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 19:14:45 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 40% - 使用分析服务解析文档
2025-06-17 19:14:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:14:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:14:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:14:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:06 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 100% - 文档解析完成
2025-06-17 19:15:06 - api_server - INFO - ✅ 文件解析完成: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:15:06 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 40% - 开始内容分析
2025-06-17 19:15:06 - api_server - INFO - 🔍 开始内容分析任务: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:15:06 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 19:15:06 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 19:15:06 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 19:15:06 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 19:15:06 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 10% - 开始内容分析
2025-06-17 19:15:06 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 19:15:06 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\4ba58b62-89b6-4384-84c3-488ba39c1fe9_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:15:06 - api_server - INFO - 检测到Word文档，使用Markdown转换: 4ba58b62-89b6-4384-84c3-488ba39c1fe9_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:15:06 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 19:15:06 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 30% - 获取到上传文件
2025-06-17 19:15:06 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 19:15:06 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 19:15:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:15:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:15:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:16:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:02 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 100% - 内容分析完成
2025-06-17 19:16:02 - api_server - INFO - ✅ 内容分析完成: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:16:02 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 70% - 开始AI智能分析
2025-06-17 19:16:02 - api_server - INFO - 🤖 开始AI分析任务: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:16:02 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 10% - 开始AI智能分析
2025-06-17 19:16:02 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 19:16:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:16:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:16:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:16:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:16:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:16:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:16:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:16:53 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 100% - AI分析完成
2025-06-17 19:16:53 - api_server - INFO - ✅ AI分析完成: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:16:53 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 90% - 开始生成文档
2025-06-17 19:16:53 - api_server - INFO - 开始生成文档: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:16:53 - api_server - INFO - 📄 开始文档生成任务: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:16:53 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 10% - 准备生成文档
2025-06-17 19:16:53 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 30% - 获取分析结果数据
2025-06-17 19:16:53 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 19:16:53 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 60% - 转换为Markdown格式
2025-06-17 19:16:53 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 19:16:53 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 19:16:53 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 90% - 保存文档内容
2025-06-17 19:16:53 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 100% - 文档生成完成
2025-06-17 19:16:53 - api_server - INFO - 文档生成完成: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:16:53 - api_server - INFO - ✅ 文档生成完成: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:16:53 - api_server - INFO - 任务 4ba58b62-89b6-4384-84c3-488ba39c1fe9 进度更新: 100% - 完整分析流程完成
2025-06-17 19:16:53 - api_server - INFO - 完整分析流程成功完成: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:16:53 - api_server - INFO - 🎉 完整分析流程完成: 4ba58b62-89b6-4384-84c3-488ba39c1fe9
2025-06-17 19:16:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:16:54 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 19:19:23 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 19:19:23 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 19:19:23 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 19:19:23 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 0% - 分析流程启动中
2025-06-17 19:19:23 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: f856aa7d-3384-44f4-8502-5a1685621541, 大小: 849268 bytes
2025-06-17 19:19:23 - api_server - INFO - 开始完整分析流程: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:19:23 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:19:23 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.04s)
2025-06-17 19:19:23 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 10% - 开始文档解析
2025-06-17 19:19:23 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 10% - 开始解析文件
2025-06-17 19:19:23 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\f856aa7d-3384-44f4-8502-5a1685621541_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:19:23 - api_server - INFO - 检测到Word文档，使用Markdown转换: f856aa7d-3384-44f4-8502-5a1685621541_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:19:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:19:23 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 19:19:23 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 19:19:23 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/f856aa7d-3384-44f4-8502-5a1685621541_需求文档 - 一局对接链数优化V0.1_img_20250617_191923_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/f856aa7d-3384-44f4-8502-5a1685621541_需求文档 - 一局对接链数优化V0.1_img_20250617_191923_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 19:19:23 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 19:19:23 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/f856aa7d-3384-44f4-8502-5a1685621541_需求文档 - 一局对接链数优化V0.1_img_20250617_191923_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/f856aa7d-3384-44f4-8502-5a1685621541_需求文档 - 一局对接链数优化V0.1_img_20250617_191923_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 19:19:23 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 40% - 使用分析服务解析文档
2025-06-17 19:19:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:19:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:19:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:19:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:19:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:19:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:19:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:19:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:19:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:19:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:19:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:19:58 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 100% - 文档解析完成
2025-06-17 19:19:58 - api_server - INFO - ✅ 文件解析完成: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:19:58 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 40% - 开始内容分析
2025-06-17 19:19:58 - api_server - INFO - 🔍 开始内容分析任务: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:19:58 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 19:19:58 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 19:19:58 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 19:19:58 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 19:19:58 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 10% - 开始内容分析
2025-06-17 19:19:58 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 19:19:58 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\f856aa7d-3384-44f4-8502-5a1685621541_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:19:58 - api_server - INFO - 检测到Word文档，使用Markdown转换: f856aa7d-3384-44f4-8502-5a1685621541_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 19:19:58 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 19:19:58 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 30% - 获取到上传文件
2025-06-17 19:19:58 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 19:19:58 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 19:19:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:20:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:20:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:20:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:20:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:20:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-06-17 19:20:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:20:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:20:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:20:51 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 100% - 内容分析完成
2025-06-17 19:20:51 - api_server - INFO - ✅ 内容分析完成: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:20:51 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 70% - 开始AI智能分析
2025-06-17 19:20:51 - api_server - INFO - 🤖 开始AI分析任务: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:20:51 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 10% - 开始AI智能分析
2025-06-17 19:20:51 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 19:20:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:20:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:20:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:21:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:21:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:21:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:21:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:21:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:21:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:21:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:21:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 19:21:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:21:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:21:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:21:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:21:33 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 100% - AI分析完成
2025-06-17 19:21:33 - api_server - INFO - ✅ AI分析完成: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:21:33 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 90% - 开始生成文档
2025-06-17 19:21:33 - api_server - INFO - 开始生成文档: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:21:33 - api_server - INFO - 📄 开始文档生成任务: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:21:33 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 10% - 准备生成文档
2025-06-17 19:21:33 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 30% - 获取分析结果数据
2025-06-17 19:21:33 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 19:21:33 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 60% - 转换为Markdown格式
2025-06-17 19:21:33 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 19:21:33 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 19:21:33 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 90% - 保存文档内容
2025-06-17 19:21:33 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 100% - 文档生成完成
2025-06-17 19:21:33 - api_server - INFO - 文档生成完成: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:21:33 - api_server - INFO - ✅ 文档生成完成: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:21:33 - api_server - INFO - 任务 f856aa7d-3384-44f4-8502-5a1685621541 进度更新: 100% - 完整分析流程完成
2025-06-17 19:21:33 - api_server - INFO - 完整分析流程成功完成: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:21:33 - api_server - INFO - 🎉 完整分析流程完成: f856aa7d-3384-44f4-8502-5a1685621541
2025-06-17 19:21:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 19:21:36 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 19:50:41 - api_server - INFO - ✅ GET get_analysis_result [200] (0.02s)
2025-06-17 19:51:00 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 20:07:42 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 20:07:43 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 20:07:43 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 20:07:52 - api_server - INFO - 分析服务管理器初始化成功
2025-06-17 20:07:52 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-06-17 20:07:52 - api_server - INFO - 增强分析器初始化成功
2025-06-17 20:07:52 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 20:07:52 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 20:08:06 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 20:08:06 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 20:08:06 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 20:08:14 - api_server - INFO - 分析服务管理器初始化成功
2025-06-17 20:08:14 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-06-17 20:08:14 - api_server - INFO - 增强分析器初始化成功
2025-06-17 20:08:14 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 20:08:14 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 20:08:33 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 20:08:33 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 20:08:33 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 20:08:42 - api_server - INFO - 分析服务管理器初始化成功
2025-06-17 20:08:42 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-06-17 20:08:42 - api_server - INFO - 增强分析器初始化成功
2025-06-17 20:08:42 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 20:08:42 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 20:09:05 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 20:09:06 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 20:09:06 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 20:09:31 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 20:09:31 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 20:09:31 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 20:09:39 - api_server - INFO - 分析服务管理器初始化成功
2025-06-17 20:09:39 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-06-17 20:09:39 - api_server - INFO - 增强分析器初始化成功
2025-06-17 20:09:39 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 20:09:39 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 20:09:50 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 20:09:50 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 20:09:50 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 20:09:58 - api_server - INFO - 分析服务管理器初始化成功
2025-06-17 20:09:58 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-06-17 20:09:58 - api_server - INFO - 增强分析器初始化成功
2025-06-17 20:09:58 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 20:09:58 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 20:10:29 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 20:10:30 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 20:10:30 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 20:10:30 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 0% - 分析流程启动中
2025-06-17 20:10:30 - api_server - INFO - 开始完整分析流程: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:10:30 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: fe649442-3d7c-4ace-8a30-44f3f90cdb19, 大小: 849268 bytes
2025-06-17 20:10:30 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:10:30 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.07s)
2025-06-17 20:10:30 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 10% - 开始文档解析
2025-06-17 20:10:30 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 10% - 开始解析文件
2025-06-17 20:10:30 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\fe649442-3d7c-4ace-8a30-44f3f90cdb19_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 20:10:30 - api_server - INFO - 检测到Word文档，使用Markdown转换: fe649442-3d7c-4ace-8a30-44f3f90cdb19_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 20:10:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:30 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 20:10:30 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 20:10:30 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/fe649442-3d7c-4ace-8a30-44f3f90cdb19_需求文档 - 一局对接链数优化V0.1_img_20250617_201030_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/fe649442-3d7c-4ace-8a30-44f3f90cdb19_需求文档 - 一局对接链数优化V0.1_img_20250617_201030_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 20:10:30 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 20:10:30 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/fe649442-3d7c-4ace-8a30-44f3f90cdb19_需求文档 - 一局对接链数优化V0.1_img_20250617_201030_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/fe649442-3d7c-4ace-8a30-44f3f90cdb19_需求文档 - 一局对接链数优化V0.1_img_20250617_201030_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 20:10:30 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 40% - 使用分析服务解析文档
2025-06-17 20:10:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:10:58 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 100% - 文档解析完成
2025-06-17 20:10:58 - api_server - INFO - ✅ 文件解析完成: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:10:58 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 40% - 开始内容分析
2025-06-17 20:10:58 - api_server - INFO - 🔍 开始内容分析任务: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:10:58 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 20:10:58 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 20:10:58 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 20:10:58 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 20:10:58 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 10% - 开始内容分析
2025-06-17 20:10:58 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 20:10:58 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\fe649442-3d7c-4ace-8a30-44f3f90cdb19_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 20:10:58 - api_server - INFO - 检测到Word文档，使用Markdown转换: fe649442-3d7c-4ace-8a30-44f3f90cdb19_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 20:10:58 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 20:10:58 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 30% - 获取到上传文件
2025-06-17 20:10:58 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 20:10:58 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 20:10:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:11:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:11:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:12:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:43 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 100% - 内容分析完成
2025-06-17 20:12:43 - api_server - INFO - ✅ 内容分析完成: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:12:43 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 70% - 开始AI智能分析
2025-06-17 20:12:43 - api_server - INFO - 🤖 开始AI分析任务: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:12:43 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 10% - 开始AI智能分析
2025-06-17 20:12:43 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 20:12:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:12:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:13:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:13:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:26 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 100% - AI分析完成
2025-06-17 20:13:26 - api_server - INFO - ✅ AI分析完成: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:13:26 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 90% - 开始生成文档
2025-06-17 20:13:26 - api_server - INFO - 开始生成文档: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:13:26 - api_server - INFO - 📄 开始文档生成任务: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:13:26 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 10% - 准备生成文档
2025-06-17 20:13:26 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 30% - 获取分析结果数据
2025-06-17 20:13:26 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 20:13:26 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 60% - 转换为Markdown格式
2025-06-17 20:13:26 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 20:13:26 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 20:13:26 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 90% - 保存文档内容
2025-06-17 20:13:26 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 100% - 文档生成完成
2025-06-17 20:13:26 - api_server - INFO - 文档生成完成: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:13:26 - api_server - INFO - ✅ 文档生成完成: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:13:26 - api_server - INFO - 任务 fe649442-3d7c-4ace-8a30-44f3f90cdb19 进度更新: 100% - 完整分析流程完成
2025-06-17 20:13:26 - api_server - INFO - 完整分析流程成功完成: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:13:26 - api_server - INFO - 🎉 完整分析流程完成: fe649442-3d7c-4ace-8a30-44f3f90cdb19
2025-06-17 20:13:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:13:28 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 20:15:50 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-06-17 20:31:01 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 20:31:01 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 20:31:01 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 20:31:10 - api_server - INFO - 分析服务管理器初始化成功
2025-06-17 20:31:10 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-06-17 20:31:10 - api_server - INFO - 增强分析器初始化成功
2025-06-17 20:31:10 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 20:31:10 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 20:31:23 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 4000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-06-17 20:31:23 - api_server - INFO - 火山引擎客户端初始化成功
2025-06-17 20:31:23 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-06-17 20:31:34 - api_server - INFO - 分析服务管理器初始化成功
2025-06-17 20:31:34 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-06-17 20:31:34 - api_server - INFO - 增强分析器初始化成功
2025-06-17 20:31:34 - api_server - INFO - 初始化任务存储数据库...
2025-06-17 20:31:34 - api_server - INFO - 任务存储数据库初始化成功
2025-06-17 20:31:35 - api_server - INFO - ✅ OPTIONS start_analysis_v2 [200]
2025-06-17 20:31:35 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-06-17 20:31:35 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-06-17 20:31:35 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 0% - 分析流程启动中
2025-06-17 20:31:35 - api_server - INFO - 开始完整分析流程: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:31:35 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 6006f66e-3abb-458f-a99a-cad24e4ae326, 大小: 849268 bytes
2025-06-17 20:31:35 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:31:35 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.07s)
2025-06-17 20:31:35 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 10% - 开始文档解析
2025-06-17 20:31:35 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 10% - 开始解析文件
2025-06-17 20:31:35 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\6006f66e-3abb-458f-a99a-cad24e4ae326_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 20:31:35 - api_server - INFO - 检测到Word文档，使用Markdown转换: 6006f66e-3abb-458f-a99a-cad24e4ae326_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 20:31:35 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 20:31:35 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 20:31:35 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/6006f66e-3abb-458f-a99a-cad24e4ae326_需求文档 - 一局对接链数优化V0.1_img_20250617_203135_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/6006f66e-3abb-458f-a99a-cad24e4ae326_需求文档 - 一局对接链数优化V0.1_img_20250617_203135_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 20:31:35 - api_server - INFO - 提取的文本内容已准备完毕
2025-06-17 20:31:35 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](uploads/temp/6006f66e-3abb-458f-a99a-cad24e4ae326_需求文档 - 一局对接链数优化V0.1_img_20250617_203135_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](uploads/temp/6006f66e-3abb-458f-a99a-cad24e4ae326_需求文档 - 一局对接链数优化V0.1_img_20250617_203135_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-06-17 20:31:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:31:35 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 40% - 使用分析服务解析文档
2025-06-17 20:31:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:31:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:31:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:31:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:31:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:31:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:31:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:31:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:02 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 100% - 文档解析完成
2025-06-17 20:32:02 - api_server - INFO - ✅ 文件解析完成: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:32:02 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 40% - 开始内容分析
2025-06-17 20:32:02 - api_server - INFO - 🔍 开始内容分析任务: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:32:02 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-06-17 20:32:02 - api_server - INFO - 📊 任务当前进度: 40%
2025-06-17 20:32:02 - api_server - INFO - 📊 解析结果存在: True
2025-06-17 20:32:02 - api_server - INFO - 📊 分析服务管理器可用: True
2025-06-17 20:32:02 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 10% - 开始内容分析
2025-06-17 20:32:02 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-06-17 20:32:02 - api_server - INFO - 从文件路径读取: D:\ai_project\document_analyzer\uploads\temp\6006f66e-3abb-458f-a99a-cad24e4ae326_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 20:32:02 - api_server - INFO - 检测到Word文档，使用Markdown转换: 6006f66e-3abb-458f-a99a-cad24e4ae326_需求文档 - 一局对接链数优化V0.1.docx
2025-06-17 20:32:02 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2543 字符
2025-06-17 20:32:02 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 30% - 获取到上传文件
2025-06-17 20:32:02 - api_server - INFO - 📄 提取到文档内容，长度: 2543 字符
2025-06-17 20:32:02 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 35% - 内容分析管理器开始分析
2025-06-17 20:32:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:32:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:32:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:32:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:33:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:47 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 100% - 内容分析完成
2025-06-17 20:33:47 - api_server - INFO - ✅ 内容分析完成: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:33:47 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 70% - 开始AI智能分析
2025-06-17 20:33:47 - api_server - INFO - 🤖 开始AI分析任务: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:33:47 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 10% - 开始AI智能分析
2025-06-17 20:33:47 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 30% - 使用分析服务进行AI分析
2025-06-17 20:33:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:33:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:33:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:34:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:34:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200]
2025-06-17 20:35:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:35:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:35:04 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 100% - AI分析完成
2025-06-17 20:35:04 - api_server - INFO - ✅ AI分析完成: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:35:04 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 90% - 开始生成文档
2025-06-17 20:35:04 - api_server - INFO - 开始生成文档: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:35:04 - api_server - INFO - 📄 开始文档生成任务: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:35:04 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 10% - 准备生成文档
2025-06-17 20:35:04 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 30% - 获取分析结果数据
2025-06-17 20:35:04 - api_server - INFO - 生成文档数据结构: basic_info=True, document_parsing=True, content_analysis=True, ai_analysis=True
2025-06-17 20:35:04 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 60% - 转换为Markdown格式
2025-06-17 20:35:04 - api_server - INFO - 开始生成Markdown报告，数据键: ['success', 'timestamp', 'service', 'data', 'metadata']
2025-06-17 20:35:04 - api_server - INFO - Markdown报告生成完成，长度: 121 字符
2025-06-17 20:35:04 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 90% - 保存文档内容
2025-06-17 20:35:04 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 100% - 文档生成完成
2025-06-17 20:35:04 - api_server - INFO - 文档生成完成: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:35:04 - api_server - INFO - ✅ 文档生成完成: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:35:04 - api_server - INFO - 任务 6006f66e-3abb-458f-a99a-cad24e4ae326 进度更新: 100% - 完整分析流程完成
2025-06-17 20:35:04 - api_server - INFO - 完整分析流程成功完成: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:35:04 - api_server - INFO - 🎉 完整分析流程完成: 6006f66e-3abb-458f-a99a-cad24e4ae326
2025-06-17 20:35:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-06-17 20:35:06 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
