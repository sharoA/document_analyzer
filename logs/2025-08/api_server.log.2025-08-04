2025-08-04 10:35:25 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 10:35:25 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 10:35:25 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 10:38:13 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x30bf83890>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: 34b9dc6e-1095-4f6d-afb3-07336c9d0fdc)')
2025-08-04 10:38:13 - api_server - INFO - 增强分析器初始化成功
2025-08-04 10:38:16 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 10:38:17 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 10:38:17 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 10:41:03 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x16ccc17d0>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: 2c7651d5-e814-485b-9394-628f7618c8e5)')
2025-08-04 10:41:03 - api_server - INFO - 增强分析器初始化成功
2025-08-04 10:41:03 - api_server - ERROR - V2 分析启动失败: 400 Bad Request: The browser (or proxy) sent a request that this server could not understand.
2025-08-04 10:41:03 - api_server - ERROR - ❌ V2 分析启动失败: 400 Bad Request: The browser (or proxy) sent a request that this server could not understand.
2025-08-04 10:41:03 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 10:41:03 - api_server - INFO - ❌ POST start_analysis_v2 [500] (0.00s)
2025-08-04 10:41:03 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 10:41:03 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 10:41:03 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 0% - 分析流程启动中
2025-08-04 10:41:03 - api_server - INFO - 开始完整分析流程: 83a149f1-2d61-4663-bf06-20e2c959d307
2025-08-04 10:41:03 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 83a149f1-2d61-4663-bf06-20e2c959d307, 大小: 849268 bytes
2025-08-04 10:41:03 - api_server - INFO - 🚀 完整分析流程启动: 83a149f1-2d61-4663-bf06-20e2c959d307
2025-08-04 10:41:03 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 83a149f1-2d61-4663-bf06-20e2c959d307
2025-08-04 10:41:03 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 0% - 分析流程启动中
2025-08-04 10:41:03 - api_server - INFO - 开始完整分析流程: 13809f91-0ee7-4a58-9364-d0e714f8d075
2025-08-04 10:41:03 - api_server - INFO - 🚀 完整分析流程启动: 13809f91-0ee7-4a58-9364-d0e714f8d075
2025-08-04 10:41:03 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 13809f91-0ee7-4a58-9364-d0e714f8d075, 大小: 849268 bytes
2025-08-04 10:41:03 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 13809f91-0ee7-4a58-9364-d0e714f8d075
2025-08-04 10:41:03 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 10% - 开始文档解析
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 10% - 开始解析文件
2025-08-04 10:41:03 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/83a149f1-2d61-4663-bf06-20e2c959d307_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 使用通用文件分析方法: 83a149f1-2d61-4663-bf06-20e2c959d307_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 检测到Word文档，使用Markdown转换: 83a149f1-2d61-4663-bf06-20e2c959d307_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 10% - 开始文档解析
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 10% - 开始解析文件
2025-08-04 10:41:03 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/13809f91-0ee7-4a58-9364-d0e714f8d075_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 使用通用文件分析方法: 13809f91-0ee7-4a58-9364-d0e714f8d075_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 检测到Word文档，使用Markdown转换: 13809f91-0ee7-4a58-9364-d0e714f8d075_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 10:41:03 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 10:41:03 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 10:41:03 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 10:41:03 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/83a149f1-2d61-4663-bf06-20e2c959d307_img_20250804_104103_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/83a149f1-2d61-4663-bf06-20e2c959d307_img_20250804_104103_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 10:41:03 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 10:41:03 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/83a149f1-2d61-4663-bf06-20e2c959d307_img_20250804_104103_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/83a149f1-2d61-4663-bf06-20e2c959d307_img_20250804_104103_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 10:41:03 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 10:41:03 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 10:41:03 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 10:41:03 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/13809f91-0ee7-4a58-9364-d0e714f8d075_img_20250804_104103_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/13809f91-0ee7-4a58-9364-d0e714f8d075_img_20250804_104103_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 10:41:03 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 10:41:03 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/13809f91-0ee7-4a58-9364-d0e714f8d075_img_20250804_104103_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/13809f91-0ee7-4a58-9364-d0e714f8d075_img_20250804_104103_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 40% - 使用分析服务解析文档
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 60% - 使用传统方法解析文档
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 40% - 使用分析服务解析文档
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 60% - 使用传统方法解析文档
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 100% - 文档解析完成
2025-08-04 10:41:03 - api_server - INFO - 文件解析完成: 13809f91-0ee7-4a58-9364-d0e714f8d075
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 100% - 文档解析完成
2025-08-04 10:41:03 - api_server - INFO - 文件解析完成: 83a149f1-2d61-4663-bf06-20e2c959d307
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 40% - 开始内容分析
2025-08-04 10:41:03 - api_server - INFO - 🔍 开始内容分析任务: 83a149f1-2d61-4663-bf06-20e2c959d307
2025-08-04 10:41:03 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 10:41:03 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 10:41:03 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 10:41:03 - api_server - INFO - 📊 分析服务管理器可用: False
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 10% - 开始内容分析
2025-08-04 10:41:03 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 10:41:03 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/83a149f1-2d61-4663-bf06-20e2c959d307_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 使用通用文件分析方法: 83a149f1-2d61-4663-bf06-20e2c959d307_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 检测到Word文档，使用Markdown转换: 83a149f1-2d61-4663-bf06-20e2c959d307_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 40% - 开始内容分析
2025-08-04 10:41:03 - api_server - INFO - 🔍 开始内容分析任务: 13809f91-0ee7-4a58-9364-d0e714f8d075
2025-08-04 10:41:03 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 10:41:03 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 10:41:03 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 10:41:03 - api_server - INFO - 📊 分析服务管理器可用: False
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 10% - 开始内容分析
2025-08-04 10:41:03 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 10:41:03 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/13809f91-0ee7-4a58-9364-d0e714f8d075_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 使用通用文件分析方法: 13809f91-0ee7-4a58-9364-d0e714f8d075_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - 检测到Word文档，使用Markdown转换: 13809f91-0ee7-4a58-9364-d0e714f8d075_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 10:41:03 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 10:41:03 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 30% - 获取到上传文件
2025-08-04 10:41:03 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 30% - 使用传统方法进行内容分析
2025-08-04 10:41:03 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 10:41:03 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 50% - 识别CRUD操作和业务功能
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 30% - 获取到上传文件
2025-08-04 10:41:03 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 30% - 使用传统方法进行内容分析
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 50% - 识别CRUD操作和业务功能
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 100% - 内容分析完成
2025-08-04 10:41:03 - api_server - INFO - ✅ 内容分析完成: 13809f91-0ee7-4a58-9364-d0e714f8d075
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 100% - 内容分析完成
2025-08-04 10:41:03 - api_server - INFO - ✅ 内容分析完成: 83a149f1-2d61-4663-bf06-20e2c959d307
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 70% - 开始AI设计方案
2025-08-04 10:41:03 - api_server - INFO - 🤖 开始AI分析任务: 13809f91-0ee7-4a58-9364-d0e714f8d075
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 10% - 开始AI设计方案
2025-08-04 10:41:03 - api_server - ERROR - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 AI分析失败: AI客户端不可用
2025-08-04 10:41:03 - api_server - ERROR - ❌ 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 AI分析失败: AI客户端不可用
2025-08-04 10:41:03 - api_server - INFO - 任务 13809f91-0ee7-4a58-9364-d0e714f8d075 进度更新: 10% - AI分析失败: AI客户端不可用
2025-08-04 10:41:03 - api_server - ERROR - AI分析失败: 13809f91-0ee7-4a58-9364-d0e714f8d075, 当前状态: failed, 错误信息: AI分析失败: AI客户端不可用
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 70% - 开始AI设计方案
2025-08-04 10:41:03 - api_server - INFO - 🤖 开始AI分析任务: 83a149f1-2d61-4663-bf06-20e2c959d307
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 10% - 开始AI设计方案
2025-08-04 10:41:03 - api_server - ERROR - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 AI分析失败: AI客户端不可用
2025-08-04 10:41:03 - api_server - ERROR - ❌ 任务 83a149f1-2d61-4663-bf06-20e2c959d307 AI分析失败: AI客户端不可用
2025-08-04 10:41:03 - api_server - INFO - 任务 83a149f1-2d61-4663-bf06-20e2c959d307 进度更新: 10% - AI分析失败: AI客户端不可用
2025-08-04 10:41:03 - api_server - ERROR - AI分析失败: 83a149f1-2d61-4663-bf06-20e2c959d307, 当前状态: failed, 错误信息: AI分析失败: AI客户端不可用
2025-08-04 10:41:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 10:58:37 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 10:58:37 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 10:58:37 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 11:01:23 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x16bcf23d0>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: 01a1037c-8363-4fc0-bc37-1e7715f1a5dd)')
2025-08-04 11:01:23 - api_server - INFO - 增强分析器初始化成功
2025-08-04 11:01:26 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 11:01:26 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 11:01:26 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 11:04:13 - api_server - ERROR - 分析服务管理器初始化失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/BAAI/bge-large-zh/tree/main/additional_chat_templates?recursive=False&expand=False (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x16fe7a150>, 'Connection to huggingface.co timed out. (connect timeout=None)'))"), '(Request ID: ddf03419-e453-43c8-b38a-f41595db44a0)')
2025-08-04 11:04:13 - api_server - INFO - 增强分析器初始化成功
2025-08-04 11:04:13 - api_server - INFO - ✅ GET health_check [200] (0.00s)
2025-08-04 11:04:13 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 11:04:13 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 0% - 分析流程启动中
2025-08-04 11:04:13 - api_server - INFO - 开始完整分析流程: 3e8cb594-e48a-4532-9016-b829bb9d02d3
2025-08-04 11:04:13 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 3e8cb594-e48a-4532-9016-b829bb9d02d3, 大小: 849268 bytes
2025-08-04 11:04:13 - api_server - INFO - 🚀 完整分析流程启动: 3e8cb594-e48a-4532-9016-b829bb9d02d3
2025-08-04 11:04:13 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 3e8cb594-e48a-4532-9016-b829bb9d02d3
2025-08-04 11:04:13 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.01s)
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 10% - 开始文档解析
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 10% - 开始解析文件
2025-08-04 11:04:13 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/3e8cb594-e48a-4532-9016-b829bb9d02d3_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:04:13 - api_server - INFO - 使用通用文件分析方法: 3e8cb594-e48a-4532-9016-b829bb9d02d3_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:04:13 - api_server - INFO - 检测到Word文档，使用Markdown转换: 3e8cb594-e48a-4532-9016-b829bb9d02d3_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:04:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:04:13 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 11:04:13 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 11:04:13 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 11:04:13 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/3e8cb594-e48a-4532-9016-b829bb9d02d3_img_20250804_110413_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/3e8cb594-e48a-4532-9016-b829bb9d02d3_img_20250804_110413_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 11:04:13 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 11:04:13 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/3e8cb594-e48a-4532-9016-b829bb9d02d3_img_20250804_110413_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/3e8cb594-e48a-4532-9016-b829bb9d02d3_img_20250804_110413_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 40% - 使用分析服务解析文档
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 60% - 使用传统方法解析文档
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 100% - 文档解析完成
2025-08-04 11:04:13 - api_server - INFO - 文件解析完成: 3e8cb594-e48a-4532-9016-b829bb9d02d3
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 40% - 开始内容分析
2025-08-04 11:04:13 - api_server - INFO - 🔍 开始内容分析任务: 3e8cb594-e48a-4532-9016-b829bb9d02d3
2025-08-04 11:04:13 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 11:04:13 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 11:04:13 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 11:04:13 - api_server - INFO - 📊 分析服务管理器可用: False
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 10% - 开始内容分析
2025-08-04 11:04:13 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 11:04:13 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/3e8cb594-e48a-4532-9016-b829bb9d02d3_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:04:13 - api_server - INFO - 使用通用文件分析方法: 3e8cb594-e48a-4532-9016-b829bb9d02d3_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:04:13 - api_server - INFO - 检测到Word文档，使用Markdown转换: 3e8cb594-e48a-4532-9016-b829bb9d02d3_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:04:13 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 11:04:13 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 30% - 获取到上传文件
2025-08-04 11:04:13 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 30% - 使用传统方法进行内容分析
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 50% - 识别CRUD操作和业务功能
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 100% - 内容分析完成
2025-08-04 11:04:13 - api_server - INFO - ✅ 内容分析完成: 3e8cb594-e48a-4532-9016-b829bb9d02d3
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 70% - 开始AI设计方案
2025-08-04 11:04:13 - api_server - INFO - 🤖 开始AI分析任务: 3e8cb594-e48a-4532-9016-b829bb9d02d3
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 10% - 开始AI设计方案
2025-08-04 11:04:13 - api_server - ERROR - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 AI分析失败: AI客户端不可用
2025-08-04 11:04:13 - api_server - ERROR - ❌ 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 AI分析失败: AI客户端不可用
2025-08-04 11:04:13 - api_server - INFO - 任务 3e8cb594-e48a-4532-9016-b829bb9d02d3 进度更新: 10% - AI分析失败: AI客户端不可用
2025-08-04 11:04:13 - api_server - ERROR - AI分析失败: 3e8cb594-e48a-4532-9016-b829bb9d02d3, 当前状态: failed, 错误信息: AI分析失败: AI客户端不可用
2025-08-04 11:04:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:25:07 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 11:25:07 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 11:25:07 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 11:27:54 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 11:27:54 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 11:27:54 - api_server - INFO - 增强分析器初始化成功
2025-08-04 11:30:50 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 11:30:50 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 11:30:50 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 11:31:19 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 11:31:19 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 11:31:19 - api_server - INFO - 增强分析器初始化成功
2025-08-04 11:31:30 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 11:31:30 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 11:31:30 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 11:31:34 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 11:31:34 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 11:31:34 - api_server - INFO - 增强分析器初始化成功
2025-08-04 11:31:34 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 11:31:34 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 11:31:34 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 0% - 分析流程启动中
2025-08-04 11:31:34 - api_server - INFO - 开始完整分析流程: 399487d9-6222-4f9f-9023-ea59e6b91f21
2025-08-04 11:31:34 - api_server - INFO - 🚀 完整分析流程启动: 399487d9-6222-4f9f-9023-ea59e6b91f21
2025-08-04 11:31:34 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 399487d9-6222-4f9f-9023-ea59e6b91f21, 大小: 849268 bytes
2025-08-04 11:31:34 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 399487d9-6222-4f9f-9023-ea59e6b91f21
2025-08-04 11:31:34 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.01s)
2025-08-04 11:31:34 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 10% - 开始文档解析
2025-08-04 11:31:34 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 10% - 开始解析文件
2025-08-04 11:31:34 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/399487d9-6222-4f9f-9023-ea59e6b91f21_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:31:34 - api_server - INFO - 使用通用文件分析方法: 399487d9-6222-4f9f-9023-ea59e6b91f21_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:31:34 - api_server - INFO - 检测到Word文档，使用Markdown转换: 399487d9-6222-4f9f-9023-ea59e6b91f21_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:31:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:34 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 11:31:34 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 11:31:34 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 11:31:34 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/399487d9-6222-4f9f-9023-ea59e6b91f21_img_20250804_113134_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/399487d9-6222-4f9f-9023-ea59e6b91f21_img_20250804_113134_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 11:31:34 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 11:31:34 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/399487d9-6222-4f9f-9023-ea59e6b91f21_img_20250804_113134_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/399487d9-6222-4f9f-9023-ea59e6b91f21_img_20250804_113134_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 11:31:34 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 40% - 使用分析服务解析文档
2025-08-04 11:31:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:31:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:02 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 100% - 文档解析完成
2025-08-04 11:32:02 - api_server - INFO - ✅ 文件解析完成: 399487d9-6222-4f9f-9023-ea59e6b91f21
2025-08-04 11:32:02 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 40% - 开始内容分析
2025-08-04 11:32:02 - api_server - INFO - 🔍 开始内容分析任务: 399487d9-6222-4f9f-9023-ea59e6b91f21
2025-08-04 11:32:02 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 11:32:02 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 11:32:02 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 11:32:02 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 11:32:02 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 10% - 开始内容分析
2025-08-04 11:32:02 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 11:32:02 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/399487d9-6222-4f9f-9023-ea59e6b91f21_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:32:02 - api_server - INFO - 使用通用文件分析方法: 399487d9-6222-4f9f-9023-ea59e6b91f21_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:32:02 - api_server - INFO - 检测到Word文档，使用Markdown转换: 399487d9-6222-4f9f-9023-ea59e6b91f21_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 11:32:03 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 11:32:03 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 11:32:03 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 30% - 获取到上传文件
2025-08-04 11:32:03 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 11:32:03 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 11:32:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:32:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 11:33:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:38:45 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 100% - 内容分析完成
2025-08-04 13:38:45 - api_server - INFO - ✅ 内容分析完成: 399487d9-6222-4f9f-9023-ea59e6b91f21
2025-08-04 13:38:45 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 70% - 开始AI设计方案
2025-08-04 13:38:45 - api_server - INFO - 🤖 开始AI分析任务: 399487d9-6222-4f9f-9023-ea59e6b91f21
2025-08-04 13:38:45 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 10% - 开始AI设计方案
2025-08-04 13:38:45 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 13:39:06 - api_server - ERROR - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:39:06 - api_server - ERROR - ❌ 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:39:06 - api_server - INFO - 任务 399487d9-6222-4f9f-9023-ea59e6b91f21 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:39:06 - api_server - ERROR - AI分析失败: 399487d9-6222-4f9f-9023-ea59e6b91f21, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:45:38 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 13:45:38 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 13:45:38 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 13:48:30 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 13:48:30 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 13:48:30 - api_server - INFO - 增强分析器初始化成功
2025-08-04 13:48:33 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 13:48:33 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 13:48:33 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 13:48:38 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 13:48:38 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 13:48:38 - api_server - INFO - 增强分析器初始化成功
2025-08-04 13:49:35 - api_server - INFO - ✅ GET health_check [200] (0.00s)
2025-08-04 13:49:35 - api_server - INFO - ❌ POST start_analysis_v2 [400] (0.00s)
2025-08-04 13:50:24 - api_server - INFO - file_info包含content字段，长度: 8
2025-08-04 13:50:24 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 4 bytes
2025-08-04 13:50:24 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 0% - 分析流程启动中
2025-08-04 13:50:24 - api_server - INFO - 开始完整分析流程: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c
2025-08-04 13:50:24 - api_server - INFO - V2 完整分析启动成功: test.txt, 任务ID: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c, 大小: 4 bytes
2025-08-04 13:50:24 - api_server - INFO - 🚀 完整分析流程启动: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c
2025-08-04 13:50:24 - api_server - INFO - 🚀 V2 完整分析启动: test.txt, 任务ID: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c
2025-08-04 13:50:24 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.01s)
2025-08-04 13:50:24 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 10% - 开始文档解析
2025-08-04 13:50:24 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 10% - 开始解析文件
2025-08-04 13:50:24 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/1d3d49ec-3446-4434-beb7-7b93bdcf3d2c_test.txt
2025-08-04 13:50:24 - api_server - INFO - 使用通用文件分析方法: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c_test.txt
2025-08-04 13:50:24 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 13:50:24 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 13:50:24 - api_server - INFO - 转换后内容预览: test
2025-08-04 13:50:24 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 13:50:24 - api_server - INFO - 转换后内容预览: test
2025-08-04 13:50:24 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 40% - 使用分析服务解析文档
2025-08-04 13:50:34 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 100% - 文档解析完成
2025-08-04 13:50:34 - api_server - INFO - ✅ 文件解析完成: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c
2025-08-04 13:50:34 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 40% - 开始内容分析
2025-08-04 13:50:34 - api_server - INFO - 🔍 开始内容分析任务: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c
2025-08-04 13:50:34 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 13:50:34 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 13:50:34 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 13:50:34 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 13:50:34 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 10% - 开始内容分析
2025-08-04 13:50:34 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 13:50:34 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/1d3d49ec-3446-4434-beb7-7b93bdcf3d2c_test.txt
2025-08-04 13:50:34 - api_server - INFO - 使用通用文件分析方法: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c_test.txt
2025-08-04 13:50:34 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 13:50:34 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 30% - 获取到上传文件
2025-08-04 13:50:34 - api_server - INFO - 📄 提取到文档内容，长度: 4 字符
2025-08-04 13:50:34 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 13:50:34 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 100% - 内容分析完成
2025-08-04 13:50:34 - api_server - INFO - ✅ 内容分析完成: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c
2025-08-04 13:50:34 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 70% - 开始AI设计方案
2025-08-04 13:50:34 - api_server - INFO - 🤖 开始AI分析任务: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c
2025-08-04 13:50:34 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 10% - 开始AI设计方案
2025-08-04 13:50:34 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 13:50:55 - api_server - ERROR - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:50:55 - api_server - ERROR - ❌ 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:50:55 - api_server - INFO - 任务 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:50:55 - api_server - ERROR - AI分析失败: 1d3d49ec-3446-4434-beb7-7b93bdcf3d2c, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:51:33 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 13:51:33 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 13:51:33 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 0% - 分析流程启动中
2025-08-04 13:51:33 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb, 大小: 849268 bytes
2025-08-04 13:51:33 - api_server - INFO - 开始完整分析流程: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb
2025-08-04 13:51:33 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb
2025-08-04 13:51:33 - api_server - INFO - 🚀 完整分析流程启动: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb
2025-08-04 13:51:33 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.01s)
2025-08-04 13:51:33 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 10% - 开始文档解析
2025-08-04 13:51:33 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 10% - 开始解析文件
2025-08-04 13:51:33 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 13:51:33 - api_server - INFO - 使用通用文件分析方法: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 13:51:33 - api_server - INFO - 检测到Word文档，使用Markdown转换: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 13:51:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:33 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 13:51:33 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 13:51:33 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 13:51:33 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_img_20250804_135133_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_img_20250804_135133_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 13:51:33 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 13:51:33 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_img_20250804_135133_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_img_20250804_135133_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 13:51:33 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 40% - 使用分析服务解析文档
2025-08-04 13:51:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:51:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:05 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 100% - 文档解析完成
2025-08-04 13:52:05 - api_server - INFO - ✅ 文件解析完成: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb
2025-08-04 13:52:05 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 40% - 开始内容分析
2025-08-04 13:52:05 - api_server - INFO - 🔍 开始内容分析任务: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb
2025-08-04 13:52:05 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 13:52:05 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 13:52:05 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 13:52:05 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 13:52:05 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 10% - 开始内容分析
2025-08-04 13:52:05 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 13:52:05 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 13:52:05 - api_server - INFO - 使用通用文件分析方法: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 13:52:05 - api_server - INFO - 检测到Word文档，使用Markdown转换: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 13:52:05 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 13:52:05 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 13:52:05 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 30% - 获取到上传文件
2025-08-04 13:52:05 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 13:52:05 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 13:52:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:52:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:53:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:54:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:28 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 100% - 内容分析完成
2025-08-04 13:55:28 - api_server - INFO - ✅ 内容分析完成: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb
2025-08-04 13:55:28 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 70% - 开始AI设计方案
2025-08-04 13:55:28 - api_server - INFO - 🤖 开始AI分析任务: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb
2025-08-04 13:55:28 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 10% - 开始AI设计方案
2025-08-04 13:55:28 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 13:55:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 13:55:49 - api_server - ERROR - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:55:49 - api_server - ERROR - ❌ 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:55:49 - api_server - INFO - 任务 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:55:49 - api_server - ERROR - AI分析失败: 32b6aa47-9f50-4f1c-a17c-57eb05bef5cb, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 13:55:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:06:50 - api_server - INFO - ✅ GET health_check [200] (0.00s)
2025-08-04 14:15:52 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:15:52 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:15:52 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:15:56 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:15:56 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:15:56 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:21:28 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:21:28 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:21:28 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:21:30 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:21:30 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:21:30 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:23:48 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:23:48 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:23:48 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:23:58 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:23:58 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:23:58 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:24:09 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:24:09 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:24:09 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:24:11 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:24:11 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:24:11 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:25:51 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:25:51 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:25:51 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:25:55 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:25:55 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:25:55 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:26:09 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:26:09 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:26:09 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:26:13 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:26:13 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:26:13 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:26:30 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:26:30 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:26:30 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:26:34 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:26:34 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:26:34 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:27:40 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:27:40 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:27:40 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:27:43 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:27:43 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:27:43 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:28:38 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 14:28:38 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 14:28:38 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 0% - 分析流程启动中
2025-08-04 14:28:38 - api_server - INFO - 开始完整分析流程: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:28:38 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: c8397eee-087b-45d0-9256-98190639381f, 大小: 849268 bytes
2025-08-04 14:28:38 - api_server - INFO - 🚀 完整分析流程启动: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:28:38 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:28:38 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 14:28:38 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 10% - 开始文档解析
2025-08-04 14:28:38 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 10% - 开始解析文件
2025-08-04 14:28:38 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/c8397eee-087b-45d0-9256-98190639381f_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:28:38 - api_server - INFO - 使用通用文件分析方法: c8397eee-087b-45d0-9256-98190639381f_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:28:38 - api_server - INFO - 检测到Word文档，使用Markdown转换: c8397eee-087b-45d0-9256-98190639381f_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:28:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:38 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 14:28:38 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 14:28:38 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 14:28:38 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/c8397eee-087b-45d0-9256-98190639381f_img_20250804_142838_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/c8397eee-087b-45d0-9256-98190639381f_img_20250804_142838_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 14:28:38 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 14:28:38 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/c8397eee-087b-45d0-9256-98190639381f_img_20250804_142838_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/c8397eee-087b-45d0-9256-98190639381f_img_20250804_142838_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 14:28:38 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 40% - 使用分析服务解析文档
2025-08-04 14:28:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:28:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:02 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 100% - 文档解析完成
2025-08-04 14:29:02 - api_server - INFO - ✅ 文件解析完成: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:29:02 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 40% - 开始内容分析
2025-08-04 14:29:02 - api_server - INFO - 🔍 开始内容分析任务: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:29:02 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 14:29:02 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 14:29:02 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 14:29:02 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 14:29:02 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 10% - 开始内容分析
2025-08-04 14:29:02 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 14:29:02 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/c8397eee-087b-45d0-9256-98190639381f_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:29:02 - api_server - INFO - 使用通用文件分析方法: c8397eee-087b-45d0-9256-98190639381f_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:29:02 - api_server - INFO - 检测到Word文档，使用Markdown转换: c8397eee-087b-45d0-9256-98190639381f_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:29:02 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 14:29:02 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 14:29:02 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 30% - 获取到上传文件
2025-08-04 14:29:02 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 14:29:02 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 14:29:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:29:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:30:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:31:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:12 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 100% - 内容分析完成
2025-08-04 14:32:12 - api_server - INFO - ✅ 内容分析完成: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:32:12 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 70% - 开始AI设计方案
2025-08-04 14:32:12 - api_server - INFO - 🤖 开始AI分析任务: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:32:12 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 10% - 开始AI设计方案
2025-08-04 14:32:12 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 14:32:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:32:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:28 - api_server - ERROR - 任务 c8397eee-087b-45d0-9256-98190639381f AI分析失败: object dict can't be used in 'await' expression
2025-08-04 14:33:28 - api_server - ERROR - ❌ 任务 c8397eee-087b-45d0-9256-98190639381f AI分析失败: object dict can't be used in 'await' expression
2025-08-04 14:33:28 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 14:33:28 - api_server - ERROR - AI分析失败: c8397eee-087b-45d0-9256-98190639381f, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 14:33:28 - api_server - INFO - 检测到form_data已生成，继续完成流程: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:33:28 - api_server - INFO - 任务 c8397eee-087b-45d0-9256-98190639381f 进度更新: 100% - 完整分析流程完成
2025-08-04 14:33:28 - api_server - INFO - 完整分析流程成功完成: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:33:28 - api_server - INFO - 🎉 完整分析流程完成: c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:33:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:33:28 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=c8397eee-087b-45d0-9256-98190639381f
2025-08-04 14:33:28 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-04 14:33:28 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-04 14:33:28 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-04 14:33:28 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=c8397eee-087b-45d0-9256-98190639381f, 表单字段数=11
2025-08-04 14:33:28 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-04 14:33:28 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-08-04 14:38:26 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:38:26 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:38:26 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:38:30 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:38:30 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:38:30 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:48:56 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:48:56 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:48:56 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:49:01 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:49:01 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:49:01 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:54:58 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:54:58 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:54:58 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:55:04 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:55:04 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:55:04 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:55:14 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 14:55:14 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 14:55:14 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 14:55:19 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 14:55:19 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 14:55:19 - api_server - INFO - 增强分析器初始化成功
2025-08-04 14:56:00 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 14:56:00 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 14:56:00 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 0% - 分析流程启动中
2025-08-04 14:56:00 - api_server - INFO - 开始完整分析流程: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 14:56:00 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 15ca7ed4-5731-42ca-a04d-1a48310b9c72, 大小: 849268 bytes
2025-08-04 14:56:00 - api_server - INFO - 🚀 完整分析流程启动: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 14:56:00 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 14:56:00 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 14:56:00 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 10% - 开始文档解析
2025-08-04 14:56:00 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 10% - 开始解析文件
2025-08-04 14:56:00 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/15ca7ed4-5731-42ca-a04d-1a48310b9c72_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:56:00 - api_server - INFO - 使用通用文件分析方法: 15ca7ed4-5731-42ca-a04d-1a48310b9c72_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:56:00 - api_server - INFO - 检测到Word文档，使用Markdown转换: 15ca7ed4-5731-42ca-a04d-1a48310b9c72_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:56:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:00 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 14:56:00 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 14:56:00 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 14:56:00 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/15ca7ed4-5731-42ca-a04d-1a48310b9c72_img_20250804_145600_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/15ca7ed4-5731-42ca-a04d-1a48310b9c72_img_20250804_145600_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 14:56:00 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 14:56:00 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/15ca7ed4-5731-42ca-a04d-1a48310b9c72_img_20250804_145600_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/15ca7ed4-5731-42ca-a04d-1a48310b9c72_img_20250804_145600_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 14:56:00 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 40% - 使用分析服务解析文档
2025-08-04 14:56:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:22 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 100% - 文档解析完成
2025-08-04 14:56:22 - api_server - INFO - ✅ 文件解析完成: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 14:56:22 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 40% - 开始内容分析
2025-08-04 14:56:22 - api_server - INFO - 🔍 开始内容分析任务: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 14:56:22 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 14:56:22 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 14:56:22 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 14:56:22 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 14:56:22 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 10% - 开始内容分析
2025-08-04 14:56:22 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 14:56:22 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/15ca7ed4-5731-42ca-a04d-1a48310b9c72_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:56:22 - api_server - INFO - 使用通用文件分析方法: 15ca7ed4-5731-42ca-a04d-1a48310b9c72_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:56:22 - api_server - INFO - 检测到Word文档，使用Markdown转换: 15ca7ed4-5731-42ca-a04d-1a48310b9c72_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 14:56:22 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 14:56:22 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 14:56:22 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 30% - 获取到上传文件
2025-08-04 14:56:22 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 14:56:22 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 14:56:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:56:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:57:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:53 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 100% - 内容分析完成
2025-08-04 14:58:53 - api_server - INFO - ✅ 内容分析完成: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 14:58:53 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 70% - 开始AI设计方案
2025-08-04 14:58:53 - api_server - INFO - 🤖 开始AI分析任务: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 14:58:53 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 10% - 开始AI设计方案
2025-08-04 14:58:53 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 14:58:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:58:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 14:59:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:00:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:00:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:00:05 - api_server - ERROR - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:00:05 - api_server - ERROR - ❌ 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:00:05 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:00:05 - api_server - ERROR - AI分析失败: 15ca7ed4-5731-42ca-a04d-1a48310b9c72, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:00:05 - api_server - INFO - 检测到form_data已生成，继续完成流程: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 15:00:05 - api_server - INFO - 任务 15ca7ed4-5731-42ca-a04d-1a48310b9c72 进度更新: 100% - 完整分析流程完成
2025-08-04 15:00:05 - api_server - INFO - 完整分析流程成功完成: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 15:00:05 - api_server - INFO - 🎉 完整分析流程完成: 15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 15:00:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:00:08 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=15ca7ed4-5731-42ca-a04d-1a48310b9c72
2025-08-04 15:00:08 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=15ca7ed4-5731-42ca-a04d-1a48310b9c72, 表单字段数=11
2025-08-04 15:00:08 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-04 15:00:08 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-04 15:00:08 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-04 15:00:08 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-04 15:00:08 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-04 15:07:42 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:07:42 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:07:42 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:07:45 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:07:45 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:07:45 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:07:56 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:07:56 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:07:56 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:07:59 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:07:59 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:07:59 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:09:46 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:09:46 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:09:46 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:09:49 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:09:49 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:09:49 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:11:26 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:11:26 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:11:26 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:11:28 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:11:28 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:11:28 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:12:26 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:12:26 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:12:26 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:12:29 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:12:29 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:12:29 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:12:34 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:12:34 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:12:34 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:12:36 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:12:36 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:12:36 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:12:48 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:12:48 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:12:48 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:12:50 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:12:50 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:12:50 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:13:07 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:13:07 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:13:07 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:13:09 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:13:09 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:13:09 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:13:25 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 15:13:25 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 15:13:25 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 0% - 分析流程启动中
2025-08-04 15:13:25 - api_server - INFO - 开始完整分析流程: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:13:25 - api_server - INFO - 🚀 完整分析流程启动: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:13:25 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 55a7446d-20b6-46c9-95fd-b93beb252d28, 大小: 849268 bytes
2025-08-04 15:13:25 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:13:25 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 15:13:25 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 10% - 开始文档解析
2025-08-04 15:13:25 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 10% - 开始解析文件
2025-08-04 15:13:25 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/55a7446d-20b6-46c9-95fd-b93beb252d28_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:13:25 - api_server - INFO - 使用通用文件分析方法: 55a7446d-20b6-46c9-95fd-b93beb252d28_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:13:25 - api_server - INFO - 检测到Word文档，使用Markdown转换: 55a7446d-20b6-46c9-95fd-b93beb252d28_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:13:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:25 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 15:13:25 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 15:13:25 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 15:13:25 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/55a7446d-20b6-46c9-95fd-b93beb252d28_img_20250804_151325_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/55a7446d-20b6-46c9-95fd-b93beb252d28_img_20250804_151325_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 15:13:25 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 15:13:25 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/55a7446d-20b6-46c9-95fd-b93beb252d28_img_20250804_151325_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/55a7446d-20b6-46c9-95fd-b93beb252d28_img_20250804_151325_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 15:13:25 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 40% - 使用分析服务解析文档
2025-08-04 15:13:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:51 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 100% - 文档解析完成
2025-08-04 15:13:51 - api_server - INFO - ✅ 文件解析完成: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:13:51 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 40% - 开始内容分析
2025-08-04 15:13:51 - api_server - INFO - 🔍 开始内容分析任务: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:13:51 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 15:13:51 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 15:13:51 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 15:13:51 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 15:13:51 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 10% - 开始内容分析
2025-08-04 15:13:51 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 15:13:51 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/55a7446d-20b6-46c9-95fd-b93beb252d28_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:13:51 - api_server - INFO - 使用通用文件分析方法: 55a7446d-20b6-46c9-95fd-b93beb252d28_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:13:51 - api_server - INFO - 检测到Word文档，使用Markdown转换: 55a7446d-20b6-46c9-95fd-b93beb252d28_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:13:51 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 15:13:51 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 15:13:51 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 30% - 获取到上传文件
2025-08-04 15:13:51 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 15:13:51 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 15:13:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:13:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:14:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-08-04 15:15:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:15:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:22 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 100% - 内容分析完成
2025-08-04 15:16:22 - api_server - INFO - ✅ 内容分析完成: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:16:22 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 70% - 开始AI设计方案
2025-08-04 15:16:22 - api_server - INFO - 🤖 开始AI分析任务: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:16:22 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 10% - 开始AI设计方案
2025-08-04 15:16:22 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 15:16:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:16:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:49 - api_server - ERROR - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:17:49 - api_server - ERROR - ❌ 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:17:49 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:17:49 - api_server - ERROR - AI分析失败: 55a7446d-20b6-46c9-95fd-b93beb252d28, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:17:49 - api_server - INFO - 检测到form_data已生成，继续完成流程: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:17:49 - api_server - INFO - 任务 55a7446d-20b6-46c9-95fd-b93beb252d28 进度更新: 100% - 完整分析流程完成
2025-08-04 15:17:49 - api_server - INFO - 完整分析流程成功完成: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:17:49 - api_server - INFO - 🎉 完整分析流程完成: 55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:17:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:17:50 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=55a7446d-20b6-46c9-95fd-b93beb252d28
2025-08-04 15:17:50 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=55a7446d-20b6-46c9-95fd-b93beb252d28, 表单字段数=11
2025-08-04 15:17:50 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-04 15:17:50 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-04 15:17:50 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-04 15:17:50 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-04 15:17:50 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-04 15:20:45 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:20:45 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:20:45 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:20:48 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:20:48 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:20:48 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:20:57 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:20:57 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:20:57 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:20:59 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:20:59 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:20:59 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:30:09 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:30:09 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:30:09 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:30:18 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:30:18 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:30:18 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:30:26 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:30:26 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:30:26 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:30:29 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:30:29 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:30:29 - api_server - INFO - 增强分析器初始化成功
2025-08-04 15:31:17 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 15:31:17 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 15:31:17 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 0% - 分析流程启动中
2025-08-04 15:31:17 - api_server - INFO - 开始完整分析流程: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:31:17 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 88140158-f989-4a02-a573-cc632b5cdcde, 大小: 849268 bytes
2025-08-04 15:31:17 - api_server - INFO - 🚀 完整分析流程启动: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:31:17 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:31:17 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 15:31:17 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 10% - 开始文档解析
2025-08-04 15:31:17 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 10% - 开始解析文件
2025-08-04 15:31:17 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/88140158-f989-4a02-a573-cc632b5cdcde_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:31:17 - api_server - INFO - 使用通用文件分析方法: 88140158-f989-4a02-a573-cc632b5cdcde_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:31:17 - api_server - INFO - 检测到Word文档，使用Markdown转换: 88140158-f989-4a02-a573-cc632b5cdcde_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:31:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:17 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 15:31:17 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 15:31:17 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 15:31:17 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/88140158-f989-4a02-a573-cc632b5cdcde_img_20250804_153117_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/88140158-f989-4a02-a573-cc632b5cdcde_img_20250804_153117_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 15:31:17 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 15:31:17 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/88140158-f989-4a02-a573-cc632b5cdcde_img_20250804_153117_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/88140158-f989-4a02-a573-cc632b5cdcde_img_20250804_153117_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 15:31:17 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 40% - 使用分析服务解析文档
2025-08-04 15:31:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:41 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 100% - 文档解析完成
2025-08-04 15:31:41 - api_server - INFO - ✅ 文件解析完成: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:31:41 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 40% - 开始内容分析
2025-08-04 15:31:41 - api_server - INFO - 🔍 开始内容分析任务: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:31:41 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 15:31:41 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 15:31:41 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 15:31:41 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 15:31:41 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 10% - 开始内容分析
2025-08-04 15:31:41 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 15:31:41 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/88140158-f989-4a02-a573-cc632b5cdcde_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:31:41 - api_server - INFO - 使用通用文件分析方法: 88140158-f989-4a02-a573-cc632b5cdcde_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:31:41 - api_server - INFO - 检测到Word文档，使用Markdown转换: 88140158-f989-4a02-a573-cc632b5cdcde_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 15:31:41 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 15:31:41 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 15:31:41 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 30% - 获取到上传文件
2025-08-04 15:31:41 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 15:31:41 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 15:31:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:31:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:32:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:33:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:38 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 100% - 内容分析完成
2025-08-04 15:34:38 - api_server - INFO - ✅ 内容分析完成: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:34:38 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 70% - 开始AI设计方案
2025-08-04 15:34:38 - api_server - INFO - 🤖 开始AI分析任务: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:34:38 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 10% - 开始AI设计方案
2025-08-04 15:34:38 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 15:34:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:34:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:48 - api_server - ERROR - 任务 88140158-f989-4a02-a573-cc632b5cdcde AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:35:48 - api_server - ERROR - ❌ 任务 88140158-f989-4a02-a573-cc632b5cdcde AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:35:48 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:35:48 - api_server - ERROR - AI分析失败: 88140158-f989-4a02-a573-cc632b5cdcde, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 15:35:48 - api_server - INFO - 检测到form_data已生成，继续完成流程: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:35:48 - api_server - INFO - 任务 88140158-f989-4a02-a573-cc632b5cdcde 进度更新: 100% - 完整分析流程完成
2025-08-04 15:35:48 - api_server - INFO - 完整分析流程成功完成: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:35:48 - api_server - INFO - 🎉 完整分析流程完成: 88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:35:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 15:35:49 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=88140158-f989-4a02-a573-cc632b5cdcde
2025-08-04 15:35:49 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=88140158-f989-4a02-a573-cc632b5cdcde, 表单字段数=11
2025-08-04 15:35:49 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-04 15:35:49 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-04 15:35:49 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-04 15:35:49 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-04 15:35:49 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-04 15:52:41 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 15:52:41 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 15:52:41 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 15:52:44 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 15:52:44 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 15:52:44 - api_server - INFO - 增强分析器初始化成功
2025-08-04 16:07:27 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 16:07:27 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 16:07:27 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 16:07:38 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 16:07:38 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 16:07:38 - api_server - INFO - 增强分析器初始化成功
2025-08-04 16:07:46 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 16:07:46 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 16:07:46 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 16:07:50 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 16:07:50 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 16:07:50 - api_server - INFO - 增强分析器初始化成功
2025-08-04 16:08:06 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 16:08:06 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 16:08:06 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 0% - 分析流程启动中
2025-08-04 16:08:06 - api_server - INFO - 开始完整分析流程: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:08:06 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: fcb5b218-22fa-49ac-8ee9-8430f2e73c88, 大小: 849268 bytes
2025-08-04 16:08:06 - api_server - INFO - 🚀 完整分析流程启动: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:08:06 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:08:06 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 16:08:06 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 10% - 开始文档解析
2025-08-04 16:08:06 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 10% - 开始解析文件
2025-08-04 16:08:06 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/fcb5b218-22fa-49ac-8ee9-8430f2e73c88_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:08:06 - api_server - INFO - 使用通用文件分析方法: fcb5b218-22fa-49ac-8ee9-8430f2e73c88_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:08:06 - api_server - INFO - 检测到Word文档，使用Markdown转换: fcb5b218-22fa-49ac-8ee9-8430f2e73c88_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:08:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:06 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 16:08:06 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 16:08:06 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 16:08:06 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/fcb5b218-22fa-49ac-8ee9-8430f2e73c88_img_20250804_160806_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/fcb5b218-22fa-49ac-8ee9-8430f2e73c88_img_20250804_160806_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 16:08:06 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 16:08:06 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/fcb5b218-22fa-49ac-8ee9-8430f2e73c88_img_20250804_160806_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/fcb5b218-22fa-49ac-8ee9-8430f2e73c88_img_20250804_160806_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 16:08:06 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 40% - 使用分析服务解析文档
2025-08-04 16:08:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:29 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 100% - 文档解析完成
2025-08-04 16:08:29 - api_server - INFO - ✅ 文件解析完成: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:08:29 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 40% - 开始内容分析
2025-08-04 16:08:29 - api_server - INFO - 🔍 开始内容分析任务: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:08:29 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 16:08:29 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 16:08:29 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 16:08:29 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 16:08:29 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 10% - 开始内容分析
2025-08-04 16:08:29 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 16:08:29 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/fcb5b218-22fa-49ac-8ee9-8430f2e73c88_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:08:29 - api_server - INFO - 使用通用文件分析方法: fcb5b218-22fa-49ac-8ee9-8430f2e73c88_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:08:29 - api_server - INFO - 检测到Word文档，使用Markdown转换: fcb5b218-22fa-49ac-8ee9-8430f2e73c88_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:08:29 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 16:08:29 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 16:08:29 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 30% - 获取到上传文件
2025-08-04 16:08:29 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 16:08:29 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 16:08:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:08:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:09:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:10:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:11:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:12:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:30 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 100% - 内容分析完成
2025-08-04 16:13:30 - api_server - INFO - ✅ 内容分析完成: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:13:30 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 70% - 开始AI设计方案
2025-08-04 16:13:30 - api_server - INFO - 🤖 开始AI分析任务: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:13:30 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 10% - 开始AI设计方案
2025-08-04 16:13:30 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 16:13:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:13:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:53 - api_server - ERROR - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 16:14:53 - api_server - ERROR - ❌ 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 16:14:53 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 16:14:53 - api_server - ERROR - AI分析失败: fcb5b218-22fa-49ac-8ee9-8430f2e73c88, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 16:14:53 - api_server - INFO - 检测到form_data已生成，继续完成流程: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:14:53 - api_server - INFO - 任务 fcb5b218-22fa-49ac-8ee9-8430f2e73c88 进度更新: 100% - 完整分析流程完成
2025-08-04 16:14:53 - api_server - INFO - 完整分析流程成功完成: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:14:53 - api_server - INFO - 🎉 完整分析流程完成: fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:14:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:14:56 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=fcb5b218-22fa-49ac-8ee9-8430f2e73c88
2025-08-04 16:14:56 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=fcb5b218-22fa-49ac-8ee9-8430f2e73c88, 表单字段数=11
2025-08-04 16:14:56 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-04 16:14:56 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-04 16:14:56 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-04 16:14:56 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-04 16:14:56 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-08-04 16:14:56 - api_server - INFO - ✅ GET uploaded_file [200] (0.01s)
2025-08-04 16:14:56 - api_server - INFO - ✅ GET uploaded_file [200] (0.01s)
2025-08-04 16:36:42 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 16:36:42 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 16:36:42 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 16:36:45 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 16:36:45 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 16:36:45 - api_server - INFO - 增强分析器初始化成功
2025-08-04 16:38:28 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 16:38:28 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 16:38:28 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 16:38:32 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 16:38:32 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 16:38:32 - api_server - INFO - 增强分析器初始化成功
2025-08-04 16:38:37 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 16:38:37 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 16:38:37 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 16:38:41 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 16:38:41 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 16:38:41 - api_server - INFO - 增强分析器初始化成功
2025-08-04 16:38:49 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 16:38:49 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 16:38:49 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 16:38:53 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 16:38:53 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 16:38:53 - api_server - INFO - 增强分析器初始化成功
2025-08-04 16:39:24 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 16:39:24 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 16:39:24 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 0% - 分析流程启动中
2025-08-04 16:39:24 - api_server - INFO - 开始完整分析流程: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:39:24 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e, 大小: 849268 bytes
2025-08-04 16:39:24 - api_server - INFO - 🚀 完整分析流程启动: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:39:24 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:39:24 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 16:39:24 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 10% - 开始文档解析
2025-08-04 16:39:24 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 10% - 开始解析文件
2025-08-04 16:39:24 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:39:24 - api_server - INFO - 使用通用文件分析方法: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:39:24 - api_server - INFO - 检测到Word文档，使用Markdown转换: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:39:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:24 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 16:39:24 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 16:39:24 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 16:39:24 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_img_20250804_163924_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_img_20250804_163924_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 16:39:24 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 16:39:24 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_img_20250804_163924_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_img_20250804_163924_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 16:39:24 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 40% - 使用分析服务解析文档
2025-08-04 16:39:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:45 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 100% - 文档解析完成
2025-08-04 16:39:45 - api_server - INFO - ✅ 文件解析完成: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:39:45 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 40% - 开始内容分析
2025-08-04 16:39:45 - api_server - INFO - 🔍 开始内容分析任务: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:39:45 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 16:39:45 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 16:39:45 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 16:39:45 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 16:39:45 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 10% - 开始内容分析
2025-08-04 16:39:45 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 16:39:45 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:39:45 - api_server - INFO - 使用通用文件分析方法: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:39:45 - api_server - INFO - 检测到Word文档，使用Markdown转换: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 16:39:45 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 16:39:45 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 16:39:45 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 30% - 获取到上传文件
2025-08-04 16:39:45 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 16:39:45 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 16:39:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:39:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:40:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-08-04 16:41:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:41:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:29 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 100% - 内容分析完成
2025-08-04 16:42:29 - api_server - INFO - ✅ 内容分析完成: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:42:29 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 70% - 开始AI设计方案
2025-08-04 16:42:29 - api_server - INFO - 🤖 开始AI分析任务: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:42:29 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 10% - 开始AI设计方案
2025-08-04 16:42:29 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 16:42:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:42:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:50 - api_server - ERROR - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e AI分析失败: object dict can't be used in 'await' expression
2025-08-04 16:43:50 - api_server - ERROR - ❌ 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e AI分析失败: object dict can't be used in 'await' expression
2025-08-04 16:43:50 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 16:43:50 - api_server - ERROR - AI分析失败: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 16:43:50 - api_server - INFO - 检测到form_data已生成，继续完成流程: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:43:50 - api_server - INFO - 任务 cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e 进度更新: 100% - 完整分析流程完成
2025-08-04 16:43:50 - api_server - INFO - 完整分析流程成功完成: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:43:50 - api_server - INFO - 🎉 完整分析流程完成: cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:43:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 16:43:51 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e
2025-08-04 16:43:51 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=cd3ef8b6-37ac-4dcd-b415-d2a5e5584a2e, 表单字段数=11
2025-08-04 16:43:51 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-04 16:43:51 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-04 16:43:51 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-04 16:43:51 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-04 16:43:51 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-04 16:45:41 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 16:45:41 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 16:45:41 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 16:45:45 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 16:45:45 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 16:45:45 - api_server - INFO - 增强分析器初始化成功
2025-08-04 16:46:46 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 16:46:46 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 16:46:46 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 16:46:50 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 16:46:50 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 16:46:50 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:03:07 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:03:07 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:03:07 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:03:20 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:03:20 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:03:20 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:03:28 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:03:28 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:03:28 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:03:32 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:03:32 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:03:32 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:03:38 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 17:03:38 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 17:03:38 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 0% - 分析流程启动中
2025-08-04 17:03:38 - api_server - INFO - 开始完整分析流程: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:03:38 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 33b7ac74-8a95-44a4-93e6-4415a4c06484, 大小: 849268 bytes
2025-08-04 17:03:38 - api_server - INFO - 🚀 完整分析流程启动: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:03:38 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:03:38 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 17:03:38 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 10% - 开始文档解析
2025-08-04 17:03:38 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 10% - 开始解析文件
2025-08-04 17:03:38 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/33b7ac74-8a95-44a4-93e6-4415a4c06484_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 17:03:38 - api_server - INFO - 使用通用文件分析方法: 33b7ac74-8a95-44a4-93e6-4415a4c06484_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 17:03:38 - api_server - INFO - 检测到Word文档，使用Markdown转换: 33b7ac74-8a95-44a4-93e6-4415a4c06484_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 17:03:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:38 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 17:03:38 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 17:03:38 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 17:03:38 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/33b7ac74-8a95-44a4-93e6-4415a4c06484_img_20250804_170338_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/33b7ac74-8a95-44a4-93e6-4415a4c06484_img_20250804_170338_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 17:03:38 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 17:03:38 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/33b7ac74-8a95-44a4-93e6-4415a4c06484_img_20250804_170338_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/33b7ac74-8a95-44a4-93e6-4415a4c06484_img_20250804_170338_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 17:03:38 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 40% - 使用分析服务解析文档
2025-08-04 17:03:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:03:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:01 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 100% - 文档解析完成
2025-08-04 17:04:01 - api_server - INFO - ✅ 文件解析完成: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:04:01 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 40% - 开始内容分析
2025-08-04 17:04:01 - api_server - INFO - 🔍 开始内容分析任务: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:04:01 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 17:04:01 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 17:04:01 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 17:04:01 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 17:04:01 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 10% - 开始内容分析
2025-08-04 17:04:01 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 17:04:01 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/33b7ac74-8a95-44a4-93e6-4415a4c06484_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 17:04:01 - api_server - INFO - 使用通用文件分析方法: 33b7ac74-8a95-44a4-93e6-4415a4c06484_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 17:04:01 - api_server - INFO - 检测到Word文档，使用Markdown转换: 33b7ac74-8a95-44a4-93e6-4415a4c06484_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 17:04:01 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 17:04:01 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 17:04:01 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 30% - 获取到上传文件
2025-08-04 17:04:01 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 17:04:01 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 17:04:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:04:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-08-04 17:05:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:05:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:06:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:03 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 100% - 内容分析完成
2025-08-04 17:07:03 - api_server - INFO - ✅ 内容分析完成: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:07:03 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 70% - 开始AI设计方案
2025-08-04 17:07:03 - api_server - INFO - 🤖 开始AI分析任务: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:07:03 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 10% - 开始AI设计方案
2025-08-04 17:07:03 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 17:07:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:07:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:17 - api_server - ERROR - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 17:08:17 - api_server - ERROR - ❌ 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 17:08:17 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 17:08:17 - api_server - ERROR - AI分析失败: 33b7ac74-8a95-44a4-93e6-4415a4c06484, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 17:08:17 - api_server - INFO - 检测到form_data已生成，继续完成流程: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:08:17 - api_server - INFO - 任务 33b7ac74-8a95-44a4-93e6-4415a4c06484 进度更新: 100% - 完整分析流程完成
2025-08-04 17:08:17 - api_server - INFO - 完整分析流程成功完成: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:08:17 - api_server - INFO - 🎉 完整分析流程完成: 33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:08:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 17:08:18 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=33b7ac74-8a95-44a4-93e6-4415a4c06484
2025-08-04 17:08:18 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=33b7ac74-8a95-44a4-93e6-4415a4c06484, 表单字段数=11
2025-08-04 17:08:18 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-04 17:08:18 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-04 17:08:18 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-04 17:08:18 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-04 17:08:18 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-04 17:16:27 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:16:27 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:16:27 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:16:30 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:16:30 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:16:30 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:16:43 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:16:43 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:16:43 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:16:46 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:16:46 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:16:46 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:17:06 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:17:06 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:17:06 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:17:10 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:17:10 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:17:10 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:17:18 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:17:18 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:17:18 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:17:21 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:17:21 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:17:21 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:17:33 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:17:33 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:17:33 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:17:36 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:17:36 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:17:36 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:18:30 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:18:30 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:18:30 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:18:33 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:18:33 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:18:33 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:18:54 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:18:54 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:18:54 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:18:58 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:18:58 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:18:58 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:19:32 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:19:32 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:19:32 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:19:37 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:19:37 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:19:37 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:19:44 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:19:44 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:19:44 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:19:48 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:19:48 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:19:48 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:34:33 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:34:33 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:34:33 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:34:39 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:34:39 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:34:39 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:36:01 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:36:01 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:36:01 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:36:06 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:36:06 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:36:06 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:52:01 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:52:01 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:52:01 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:52:04 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:52:04 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:52:04 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:52:19 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:52:19 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:52:19 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:52:24 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:52:24 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:52:24 - api_server - INFO - 增强分析器初始化成功
2025-08-04 17:54:45 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 17:54:45 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 17:54:45 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 17:54:49 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 17:54:49 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 17:54:49 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:02:07 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:02:07 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:02:07 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:02:12 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:02:12 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:02:12 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:04:56 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:04:56 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:04:56 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:04:59 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:04:59 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:04:59 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:12:28 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:12:28 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:12:28 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:12:37 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:12:37 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:12:37 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:12:47 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:12:47 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:12:47 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:12:50 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:12:50 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:12:50 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:13:34 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 18:13:34 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 18:13:34 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 0% - 分析流程启动中
2025-08-04 18:13:34 - api_server - INFO - 开始完整分析流程: bc883d57-a496-4c58-b68e-0c01d6ea6637
2025-08-04 18:13:34 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: bc883d57-a496-4c58-b68e-0c01d6ea6637, 大小: 849268 bytes
2025-08-04 18:13:34 - api_server - INFO - 🚀 完整分析流程启动: bc883d57-a496-4c58-b68e-0c01d6ea6637
2025-08-04 18:13:34 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: bc883d57-a496-4c58-b68e-0c01d6ea6637
2025-08-04 18:13:34 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 18:13:34 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 10% - 开始文档解析
2025-08-04 18:13:34 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 10% - 开始解析文件
2025-08-04 18:13:34 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/bc883d57-a496-4c58-b68e-0c01d6ea6637_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:13:34 - api_server - INFO - 使用通用文件分析方法: bc883d57-a496-4c58-b68e-0c01d6ea6637_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:13:34 - api_server - INFO - 检测到Word文档，使用Markdown转换: bc883d57-a496-4c58-b68e-0c01d6ea6637_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:13:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:34 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 18:13:34 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:13:34 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:13:34 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/bc883d57-a496-4c58-b68e-0c01d6ea6637_img_20250804_181334_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/bc883d57-a496-4c58-b68e-0c01d6ea6637_img_20250804_181334_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 18:13:34 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:13:34 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/bc883d57-a496-4c58-b68e-0c01d6ea6637_img_20250804_181334_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/bc883d57-a496-4c58-b68e-0c01d6ea6637_img_20250804_181334_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 18:13:34 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 40% - 使用分析服务解析文档
2025-08-04 18:13:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:13:58 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 100% - 文档解析完成
2025-08-04 18:13:58 - api_server - INFO - ✅ 文件解析完成: bc883d57-a496-4c58-b68e-0c01d6ea6637
2025-08-04 18:13:58 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 40% - 开始内容分析
2025-08-04 18:13:58 - api_server - INFO - 🔍 开始内容分析任务: bc883d57-a496-4c58-b68e-0c01d6ea6637
2025-08-04 18:13:58 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 18:13:58 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 18:13:58 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 18:13:58 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 18:13:58 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 10% - 开始内容分析
2025-08-04 18:13:58 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 18:13:58 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/bc883d57-a496-4c58-b68e-0c01d6ea6637_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:13:58 - api_server - INFO - 使用通用文件分析方法: bc883d57-a496-4c58-b68e-0c01d6ea6637_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:13:58 - api_server - INFO - 检测到Word文档，使用Markdown转换: bc883d57-a496-4c58-b68e-0c01d6ea6637_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:13:58 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 18:13:58 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:13:58 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 30% - 获取到上传文件
2025-08-04 18:13:58 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 18:13:58 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 18:14:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:14:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:15:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:16:30 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 100% - 内容分析完成
2025-08-04 18:16:30 - api_server - INFO - ✅ 内容分析完成: bc883d57-a496-4c58-b68e-0c01d6ea6637
2025-08-04 18:16:30 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 70% - 开始AI设计方案
2025-08-04 18:16:30 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/bc883d57-a496-4c58-b68e-0c01d6ea6637_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:16:30 - api_server - INFO - 使用通用文件分析方法: bc883d57-a496-4c58-b68e-0c01d6ea6637_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:16:30 - api_server - INFO - 检测到Word文档，使用Markdown转换: bc883d57-a496-4c58-b68e-0c01d6ea6637_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:16:30 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 18:16:30 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:16:30 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-04 18:16:30 - api_server - INFO - 🤖 开始AI分析任务: bc883d57-a496-4c58-b68e-0c01d6ea6637
2025-08-04 18:16:30 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 10% - 开始AI设计方案
2025-08-04 18:16:30 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 18:16:30 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-04 18:16:30 - api_server - ERROR - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 18:16:30 - api_server - ERROR - ❌ 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 18:16:30 - api_server - INFO - 任务 bc883d57-a496-4c58-b68e-0c01d6ea6637 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 18:16:30 - api_server - ERROR - AI分析失败: bc883d57-a496-4c58-b68e-0c01d6ea6637, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 18:16:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:21:23 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:21:23 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:21:23 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:21:27 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:21:27 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:21:27 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:22:24 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:22:24 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:22:24 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:22:32 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:22:32 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:22:32 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:22:39 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:22:39 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:22:39 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:22:42 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:22:42 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:22:42 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:24:05 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-04 18:24:05 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-04 18:24:05 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 0% - 分析流程启动中
2025-08-04 18:24:05 - api_server - INFO - 开始完整分析流程: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:24:05 - api_server - INFO - V2 完整分析启动成功: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61, 大小: 849268 bytes
2025-08-04 18:24:05 - api_server - INFO - 🚀 完整分析流程启动: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:24:05 - api_server - INFO - 🚀 V2 完整分析启动: 需求文档 - 一局对接链数优化V0.1.docx, 任务ID: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:24:05 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-04 18:24:05 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 10% - 开始文档解析
2025-08-04 18:24:05 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 10% - 开始解析文件
2025-08-04 18:24:05 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:24:05 - api_server - INFO - 使用通用文件分析方法: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:24:05 - api_server - INFO - 检测到Word文档，使用Markdown转换: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:24:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:05 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 18:24:05 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:24:05 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:24:05 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182405_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182405_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 18:24:05 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:24:05 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182405_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182405_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-04 18:24:05 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 40% - 使用分析服务解析文档
2025-08-04 18:24:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:27 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 100% - 文档解析完成
2025-08-04 18:24:27 - api_server - INFO - ✅ 文件解析完成: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:24:27 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 40% - 开始内容分析
2025-08-04 18:24:27 - api_server - INFO - 🔍 开始内容分析任务: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:24:27 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-04 18:24:27 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-04 18:24:27 - api_server - INFO - 📊 解析结果存在: True
2025-08-04 18:24:27 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-04 18:24:27 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 10% - 开始内容分析
2025-08-04 18:24:27 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-04 18:24:27 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:24:27 - api_server - INFO - 使用通用文件分析方法: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:24:27 - api_server - INFO - 检测到Word文档，使用Markdown转换: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:24:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:27 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 18:24:27 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:24:27 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 30% - 获取到上传文件
2025-08-04 18:24:27 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-04 18:24:27 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 35% - 内容分析管理器开始分析
2025-08-04 18:24:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:24:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:25:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:26:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:17 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 100% - 内容分析完成
2025-08-04 18:27:17 - api_server - INFO - ✅ 内容分析完成: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:27:17 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 70% - 开始AI设计方案
2025-08-04 18:27:17 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:27:17 - api_server - INFO - 使用通用文件分析方法: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:27:17 - api_server - INFO - 检测到Word文档，使用Markdown转换: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61_需求文档 - 一局对接链数优化V0.1.docx
2025-08-04 18:27:17 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-04 18:27:17 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-04 18:27:17 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-04 18:27:17 - api_server - INFO - 🤖 开始AI分析任务: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:27:17 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 10% - 开始AI设计方案
2025-08-04 18:27:17 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 30% - 使用分析服务进行AI分析
2025-08-04 18:27:17 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-04 18:27:17 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-04T18:27:17.332964', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [{'changeType': '新增', 'changeReason': '新增组织单元额度功能及相关页面和交互功能', 'changeItems': ['新增组织单元额度功能：支持查询当前登录企业下的具体组织单元的链数额度、云信额度明细，并提供了详细的筛选、汇总和列表字段说明', "新增了'组织单元额度'列表页，支持查询当前登录企业下的具体组织单元的链数额度、云信额度明细，并提供了筛选、导出等功能", "新增'组织单元额度'页面入口按钮，当且仅当当前登录企业为多组织企业时展示", "新增'组织单元额度'列表页的交互功能，包括返回、导出、列表筛选", "新增'组织单元额度'列表页的字段说明，包括筛选字段、汇总字段和列表字段"], 'version': ['V0.1'], 'mergedFrom': [1, 4, 9], 'changeDetails': '根据变更点"新增组织单元额度功能及相关页面和交互功能"，从需求文档中提取的详细内容如下：\n\n### 1. 功能描述\n- 新增"组织单元额度"列表页，支持查询当前登录企业下的具体组织单元的链数额度、云信额度明细\n- 页面入口：在"额度管理"列表页右上角新增"组织单元额度"按钮，仅当当前登录企业为多组织企业时显示\n- 功能切换：可切换展示链数额度、云信额度或全部额度明细\n\n### 2. 交互功能\n- **返回**：点击返回按钮返回至"额度管理"列表页\n- **导出**：点击导出按钮将筛选后的数据以xls格式导出至本地\n- **列表筛选**：\n  - 点击查询按钮按筛选条件过滤列表\n  - 点击重置按钮恢复未筛选状态\n\n### 3. 字段说明\n#### 筛选字段：\n| 序号 | 字段名 | 类型格式 | 默认值 | 规则 |\n|------|--------|----------|--------|------|\n| 1 | 组织单元名称 | 文本输入框 | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | 链数额度 | 选项：链数额度、云信额度、全部 |\n\n#### 汇总字段：\n| 序号 | 字段名 | 类型格式 | 计算规则 |\n|------|--------|----------|----------|\n| 1 | 总额度（元） | 数值 | 满足条件的"已分配额度"之和 |\n| 2 | 已用额度（元） | 数值 | 满足条件的"已用额度"之和 |\n| 3 | 可用额度（元） | 数值 | 满足条件的"可用额度"之和 |\n\n#### 列表字段：\n| 序号 | 字段名 | 类型格式 | 排序规则 |\n|------|--------|----------|----------|\n| 1 | 组织单元名称 | 字符串 | 主要排序关键字(降序) |\n| 2 | 额度名称 | 字符串 | - |\n| 3 | 额度类型 | 字符串 | 次要排序关键字(降序) |\n| 4 | 已分配额度（元） | 数值 | - |\n| 5 | 已用额度（元） | 数值 | - |\n| 6 | 可用额度（元） | 数值 | - |\n\n### 4. 权限控制\n- 仅多组织企业用户可见"组织单元额度"入口按钮\n\n### 5. 页面截图\n- 交互说明图：http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182427_0.png\n- 页面效果图：http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182427_1.png\n\n### 6. 业务规则\n- 页面载入时默认展示链数额度明细\n- 筛选条件更新后，汇总值需实时重新计算\n- 列表默认按组织单元名称和额度类型降序排列\n\n### 7. 约束条件\n- 仅支持xls格式导出\n- 仅多组织企业可使用该功能'}, {'changeType': '修改', 'changeReason': '修改额度管理功能名称并新增组织单元额度相关功能', 'changeItems': ["链数额度功能调整：功能名称从'链数额度'变更为'额度管理'，并新增'组织单元额度'按钮和列表页", "将原'链数额度'功能名称变更为'额度管理'，并新增了'组织单元额度'按钮和对应的列表页"], 'version': ['V0.1'], 'mergedFrom': [2, 5], 'changeDetails': '根据变更点"链数额度功能调整：功能名称从\'链数额度\'变更为\'额度管理\'，并新增\'组织单元额度\'按钮和列表页"，从完整需求文档中提取的详细内容如下：\n\n一、功能名称变更\n1. 原功能名称："链数额度"\n2. 变更后功能名称："额度管理"\n\n二、新增功能组件\n1. 新增按钮："组织单元额度"按钮\n   - 位置：页面右上方\n   - 显示条件：仅当当前登录企业为多组织企业时展示\n   - 交互行为：点击后跳转至"组织单元额度"列表页\n\n三、列表页调整\n1. 新增字段："额度类型"\n   - 位置：置于"额度名称"之后\n   - 取值规则：若为链数额度则取值为"链数额度"\n\n四、新增组织单元额度功能详情\n1. 页面入口：通过"额度管理"列表页右上角的"组织单元额度"按钮跳转\n2. 交互功能：\n   - 返回功能：返回至"额度管理"列表页\n   - 导出功能：将筛选后数据以xls格式导出\n   - 列表筛选：支持查询和重置操作\n\n3. 功能说明：\n   - 默认展示：分配至各组织单元的链数额度明细\n   - 切换展示：\n     * 切换为"云信额度"：展示云信额度明细\n     * 切换为"全部"：展示链数和云信额度明细\n\n4. 筛选字段定义：\n   | 字段名 | 类型 | 默认值 | 规则 |\n   |---|---|---|---|\n   | 组织单元名称 | 文本输入框 | - | 模糊搜索 |\n   | 额度名称 | 文本输入框 | - | 模糊搜索 |\n   | 额度类型 | 下拉列表 | 链数额度 | 选项：链数额度、云信额度、全部 |\n\n5. 汇总字段：\n   | 字段名 | 计算规则 |\n   |---|---|\n   | 总额度（元） | 满足筛选条件的"已分配额度"之和 |\n   | 已用额度（元） | 满足筛选条件的"已用额度"之和 |\n   | 可用额度（元） | 满足筛选条件的"可用额度"之和 |\n\n6. 列表字段：\n   | 字段名 | 类型 | 排序规则 |\n   |---|---|---|\n   | 组织单元名称 | 字符串 | 主要关键字(降序) |\n   | 额度名称 | 字符串 | - |\n   | 额度类型 | 字符串 | 次要关键字(降序) |\n   | 已分配额度（元） | 数值 | - |\n   | 已用额度（元） | 数值 | - |\n   | 可用额度（元） | 数值 | - |\n\n五、相关截图路径\n1. 额度管理页面截图：http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182427_1.png\n2. 组织单元额度交互说明截图：http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182427_0.png\n\n六、约束条件\n1. 权限限制："组织单元额度"按钮仅对多组织企业用户可见\n2. 数据限制：汇总值需实时响应筛选条件变化'}, {'changeType': '修改', 'changeReason': '调整确权业务申请接口的校验规则并新增状态校验逻辑', 'changeItems': ['调整了【确权业务申请】接口中关于bizSerialNo的校验规则，允许相同业务编号的数据在核心企业内部系统修改后再次推送', '修改了错误提示信息，明确提示用户需要先登录平台进行作废/删除操作', "新增了对非'已作废'、'已删除'状态的链数业务数据的校验逻辑"], 'version': ['V0.1'], 'mergedFrom': ['变更项1', '变更项2', '变更项3'], 'changeDetails': '根据变更点"调整确权业务申请接口的校验规则"，从需求文档中提取的相关详细内容如下：\n\n1. 变更背景：\n- 核心企业反馈需求：希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台\n- 原接口校验逻辑不允许相同业务编号的业务数据重复推送\n\n2. 具体调整内容：\n- 接口名称：确权业务申请\n- 隶属服务：zqyl-data-open\n- 校验点：bizSerialNo（业务编号）的校验规则调整\n\n3. 调整后的业务规则：\n- 原规则：完全不允许相同bizSerialNo重复推送\n- 新规则：bizSerialNo不可与已成功推送的非"已作废"、"已删除"状态的链数业务数据对应的bizSerialNo成功记录重复\n- 允许条件：当原业务数据状态为"已作废"或"已删除"时，允许使用相同bizSerialNo重新推送\n\n4. 错误提示：\n- 当校验不通过时，返回错误提示："bizSerialNo已存在，请先登录平台进行作废/删除。"\n\n5. 新增校验逻辑：\n- 新增对非"已作废"、"已删除"状态的链数业务数据的校验逻辑\n\n6. 约束条件：\n- 仅适用于核心企业内部系统修改后再次推送的场景\n- 需要先对原业务数据进行作废/删除操作才能重新推送相同bizSerialNo的数据\n- 仅对非"已作废"、"已删除"状态的业务数据进行校验\n- 允许重复推送已作废或已删除状态的业务数据', 'mergeReason': '这三个变更项都是关于确权业务申请接口中bizSerialNo校验规则的调整，核心内容相同但表述略有差异', 'mergeMethod': 'llm_intelligent', 'mergedCount': 3}], 'deletion_analyses': [], 'summary': {'total_changes': 5, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序', 'merge_info': {'original_count': 4, 'merged_count': 5, 'reduction_ratio': -25.0, 'strategy': 'llm_smart'}}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754303237.332327}}, 'metadata': {'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并', 'analysis_time': 169.50380301475525, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 169.5040681362152}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-04T18:24:27.765068', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '需求文档 - 一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '该文档描述了对中建一局对接链数项目的优化需求，主要涉及接口校验逻辑调整和链数额度功能优化。', 'functionCount': '3', 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': '1', 'apiName': ['确权业务申请'], 'dbChangeCount': '0', 'dbChangeName': [], 'mqCount': '0', 'mqName': [], 'timerCount': '0', 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '中建一局', '接口校验', '额度管理', '组织单元额度'], 'primaryKeywords': [{'keyword': '链数', 'frequency': '5', 'importance': '0.9', 'positions': ['文档标题', '需求背景', '功能需求说明'], 'context': ['一局对接链数的项目上线后', '链数额度功能调整']}, {'keyword': '接口校验', 'frequency': '3', 'importance': '0.8', 'positions': ['需求背景', '功能需求说明'], 'context': ['对接口的校验逻辑进行调整', '接口校验规则调整']}], 'phrases': [{'phrase': '组织单元额度', 'frequency': '4', 'significance': '0.7'}, {'phrase': '额度管理', 'frequency': '2', 'significance': '0.6'}], 'semanticClusters': [{'clusterName': '接口优化', 'keywords': ['接口校验', 'bizSerialNo', '确权业务申请'], 'coherenceScore': '0.85'}, {'clusterName': '额度管理', 'keywords': ['链数额度', '组织单元额度', '额度管理'], 'coherenceScore': '0.75'}]}, 'metadata': {'userRole': ['金融服务部', '系统对接人员'], 'targetAudience': ['开发人员', '需求分析人员']}}, 'notes': {'model': 'ep-20250605091804-wmw6w'}}, 'metadata': {'analysis_duration': 22.474853038787842}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182717_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/5d30cf4a-af1c-4106-b38e-5d12d0f57b61_img_20250804_182717_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-04 18:27:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:27:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:27 - api_server - ERROR - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 18:28:27 - api_server - ERROR - ❌ 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 AI分析失败: object dict can't be used in 'await' expression
2025-08-04 18:28:27 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-04 18:28:27 - api_server - ERROR - AI分析失败: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-04 18:28:27 - api_server - INFO - 检测到form_data已生成，继续完成流程: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:28:27 - api_server - INFO - 任务 5d30cf4a-af1c-4106-b38e-5d12d0f57b61 进度更新: 100% - 完整分析流程完成
2025-08-04 18:28:27 - api_server - INFO - 完整分析流程成功完成: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:28:27 - api_server - INFO - 🎉 完整分析流程完成: 5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:28:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-04 18:28:27 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=5d30cf4a-af1c-4106-b38e-5d12d0f57b61
2025-08-04 18:28:27 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=5d30cf4a-af1c-4106-b38e-5d12d0f57b61, 表单字段数=11
2025-08-04 18:28:27 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-04 18:28:27 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-04 18:28:27 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-04 18:28:27 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-04 18:28:27 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-04 18:32:12 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:32:12 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:32:12 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:32:16 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:32:16 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:32:16 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:32:24 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:32:24 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:32:24 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:32:27 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:32:27 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:32:27 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:35:45 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:35:45 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:35:45 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:35:48 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:35:48 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:35:48 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:36:20 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:36:20 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:36:20 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:36:25 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:36:25 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:36:25 - api_server - INFO - 增强分析器初始化成功
2025-08-04 18:37:48 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-04 18:37:48 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-04 18:37:48 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-04 18:37:54 - api_server - INFO - 分析服务管理器初始化成功
2025-08-04 18:37:54 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-04 18:37:54 - api_server - INFO - 增强分析器初始化成功
