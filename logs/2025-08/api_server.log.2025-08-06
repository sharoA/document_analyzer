2025-08-06 11:08:40 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:08:40 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:08:40 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:08:46 - api_server - ERROR - 分析服务管理器初始化失败: Could not connect to Weaviate:Connection to Weaviate failed. Details: .
2025-08-06 11:08:46 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:08:54 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:08:54 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:08:54 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:08:55 - api_server - ERROR - 分析服务管理器初始化失败: Could not connect to Weaviate:Connection to Weaviate failed. Details: .
2025-08-06 11:08:55 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:14:15 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 11:14:15 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 11:14:15 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 0% - 分析流程启动中
2025-08-06 11:14:15 - api_server - INFO - 开始完整分析流程: b32c06d3-f544-49d3-998a-b08e5d3dbc50
2025-08-06 11:14:15 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: b32c06d3-f544-49d3-998a-b08e5d3dbc50, 大小: 849268 bytes
2025-08-06 11:14:15 - api_server - INFO - 🚀 完整分析流程启动: b32c06d3-f544-49d3-998a-b08e5d3dbc50
2025-08-06 11:14:15 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: b32c06d3-f544-49d3-998a-b08e5d3dbc50
2025-08-06 11:14:15 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-06 11:14:15 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 10% - 开始文档解析
2025-08-06 11:14:15 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 10% - 开始解析文件
2025-08-06 11:14:15 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/b32c06d3-f544-49d3-998a-b08e5d3dbc50_一局对接链数优化V0.1.docx
2025-08-06 11:14:15 - api_server - INFO - 使用通用文件分析方法: b32c06d3-f544-49d3-998a-b08e5d3dbc50_一局对接链数优化V0.1.docx
2025-08-06 11:14:15 - api_server - INFO - 检测到Word文档，使用Markdown转换: b32c06d3-f544-49d3-998a-b08e5d3dbc50_一局对接链数优化V0.1.docx
2025-08-06 11:14:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:14:15 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 11:14:15 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:14:15 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:14:15 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/b32c06d3-f544-49d3-998a-b08e5d3dbc50_img_20250806_111415_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/b32c06d3-f544-49d3-998a-b08e5d3dbc50_img_20250806_111415_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 11:14:15 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:14:15 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/b32c06d3-f544-49d3-998a-b08e5d3dbc50_img_20250806_111415_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/b32c06d3-f544-49d3-998a-b08e5d3dbc50_img_20250806_111415_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 11:14:15 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 40% - 使用分析服务解析文档
2025-08-06 11:14:15 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 60% - 使用传统方法解析文档
2025-08-06 11:14:15 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 100% - 文档解析完成
2025-08-06 11:14:15 - api_server - INFO - 文件解析完成: b32c06d3-f544-49d3-998a-b08e5d3dbc50
2025-08-06 11:14:15 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 40% - 开始内容分析
2025-08-06 11:14:15 - api_server - INFO - 🔍 开始内容分析任务: b32c06d3-f544-49d3-998a-b08e5d3dbc50
2025-08-06 11:14:15 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 11:14:15 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 11:14:15 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 11:14:15 - api_server - INFO - 📊 分析服务管理器可用: False
2025-08-06 11:14:15 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 10% - 开始内容分析
2025-08-06 11:14:15 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 11:14:15 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/b32c06d3-f544-49d3-998a-b08e5d3dbc50_一局对接链数优化V0.1.docx
2025-08-06 11:14:15 - api_server - INFO - 使用通用文件分析方法: b32c06d3-f544-49d3-998a-b08e5d3dbc50_一局对接链数优化V0.1.docx
2025-08-06 11:14:15 - api_server - INFO - 检测到Word文档，使用Markdown转换: b32c06d3-f544-49d3-998a-b08e5d3dbc50_一局对接链数优化V0.1.docx
2025-08-06 11:14:16 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 11:14:16 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:14:16 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 30% - 获取到上传文件
2025-08-06 11:14:16 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 11:14:16 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 30% - 使用传统方法进行内容分析
2025-08-06 11:14:16 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 50% - 识别CRUD操作和业务功能
2025-08-06 11:14:16 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 100% - 内容分析完成
2025-08-06 11:14:16 - api_server - INFO - ✅ 内容分析完成: b32c06d3-f544-49d3-998a-b08e5d3dbc50
2025-08-06 11:14:16 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 70% - 开始AI设计方案
2025-08-06 11:14:16 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/b32c06d3-f544-49d3-998a-b08e5d3dbc50_一局对接链数优化V0.1.docx
2025-08-06 11:14:16 - api_server - INFO - 使用通用文件分析方法: b32c06d3-f544-49d3-998a-b08e5d3dbc50_一局对接链数优化V0.1.docx
2025-08-06 11:14:16 - api_server - INFO - 检测到Word文档，使用Markdown转换: b32c06d3-f544-49d3-998a-b08e5d3dbc50_一局对接链数优化V0.1.docx
2025-08-06 11:14:16 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 11:14:16 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:14:16 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 11:14:16 - api_server - INFO - 🤖 开始AI分析任务: b32c06d3-f544-49d3-998a-b08e5d3dbc50
2025-08-06 11:14:16 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 10% - 开始AI设计方案
2025-08-06 11:14:16 - api_server - ERROR - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 AI分析失败: AI客户端不可用
2025-08-06 11:14:16 - api_server - ERROR - ❌ 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 AI分析失败: AI客户端不可用
2025-08-06 11:14:16 - api_server - INFO - 任务 b32c06d3-f544-49d3-998a-b08e5d3dbc50 进度更新: 10% - AI分析失败: AI客户端不可用
2025-08-06 11:14:16 - api_server - ERROR - AI分析失败: b32c06d3-f544-49d3-998a-b08e5d3dbc50, 当前状态: failed, 错误信息: AI分析失败: AI客户端不可用
2025-08-06 11:14:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:19:45 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:19:45 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:19:45 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:19:47 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:19:47 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:19:47 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:20:58 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:20:58 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:20:58 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:21:00 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:21:00 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:21:00 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:22:11 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:22:11 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:22:11 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:22:12 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:22:12 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:22:12 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:23:14 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:23:14 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:23:14 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:23:16 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:23:16 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:23:16 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:25:28 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:25:28 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:25:28 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:25:30 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:25:30 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:25:30 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:26:42 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:26:42 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:26:42 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:26:44 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:26:44 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:26:44 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:31:54 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:31:54 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:31:54 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:31:56 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:31:56 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:31:56 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:32:41 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:32:41 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:32:41 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:32:43 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:32:43 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:32:43 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:36:06 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:36:06 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:36:06 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:36:12 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:36:12 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:36:12 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:36:21 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 11:36:21 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 11:36:21 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 11:36:22 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 11:36:22 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 11:36:22 - api_server - INFO - 增强分析器初始化成功
2025-08-06 11:36:23 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 11:36:23 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 11:36:23 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 0% - 分析流程启动中
2025-08-06 11:36:23 - api_server - INFO - 开始完整分析流程: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:36:23 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: 377072e8-cfba-4d25-9383-d360694bf5ff, 大小: 849268 bytes
2025-08-06 11:36:23 - api_server - INFO - 🚀 完整分析流程启动: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:36:23 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:36:23 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.03s)
2025-08-06 11:36:23 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 10% - 开始文档解析
2025-08-06 11:36:23 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 10% - 开始解析文件
2025-08-06 11:36:23 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/377072e8-cfba-4d25-9383-d360694bf5ff_一局对接链数优化V0.1.docx
2025-08-06 11:36:23 - api_server - INFO - 使用通用文件分析方法: 377072e8-cfba-4d25-9383-d360694bf5ff_一局对接链数优化V0.1.docx
2025-08-06 11:36:23 - api_server - INFO - 检测到Word文档，使用Markdown转换: 377072e8-cfba-4d25-9383-d360694bf5ff_一局对接链数优化V0.1.docx
2025-08-06 11:36:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:23 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 11:36:23 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:36:23 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:36:23 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/377072e8-cfba-4d25-9383-d360694bf5ff_img_20250806_113623_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/377072e8-cfba-4d25-9383-d360694bf5ff_img_20250806_113623_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 11:36:23 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:36:23 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/377072e8-cfba-4d25-9383-d360694bf5ff_img_20250806_113623_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/377072e8-cfba-4d25-9383-d360694bf5ff_img_20250806_113623_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 11:36:23 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 40% - 使用分析服务解析文档
2025-08-06 11:36:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:48 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 100% - 文档解析完成
2025-08-06 11:36:48 - api_server - INFO - ✅ 文件解析完成: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:36:48 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 40% - 开始内容分析
2025-08-06 11:36:48 - api_server - INFO - 🔍 开始内容分析任务: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:36:48 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 11:36:48 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 11:36:48 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 11:36:48 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 11:36:48 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 10% - 开始内容分析
2025-08-06 11:36:48 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 11:36:48 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/377072e8-cfba-4d25-9383-d360694bf5ff_一局对接链数优化V0.1.docx
2025-08-06 11:36:48 - api_server - INFO - 使用通用文件分析方法: 377072e8-cfba-4d25-9383-d360694bf5ff_一局对接链数优化V0.1.docx
2025-08-06 11:36:48 - api_server - INFO - 检测到Word文档，使用Markdown转换: 377072e8-cfba-4d25-9383-d360694bf5ff_一局对接链数优化V0.1.docx
2025-08-06 11:36:48 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 11:36:48 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:36:48 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 30% - 获取到上传文件
2025-08-06 11:36:48 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 11:36:48 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 11:36:49 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 100% - 内容分析完成
2025-08-06 11:36:49 - api_server - INFO - ✅ 内容分析完成: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:36:49 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 70% - 开始AI设计方案
2025-08-06 11:36:49 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/377072e8-cfba-4d25-9383-d360694bf5ff_一局对接链数优化V0.1.docx
2025-08-06 11:36:49 - api_server - INFO - 使用通用文件分析方法: 377072e8-cfba-4d25-9383-d360694bf5ff_一局对接链数优化V0.1.docx
2025-08-06 11:36:49 - api_server - INFO - 检测到Word文档，使用Markdown转换: 377072e8-cfba-4d25-9383-d360694bf5ff_一局对接链数优化V0.1.docx
2025-08-06 11:36:49 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 11:36:49 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 11:36:49 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 11:36:49 - api_server - INFO - 🤖 开始AI分析任务: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:36:49 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 10% - 开始AI设计方案
2025-08-06 11:36:49 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 11:36:49 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 11:36:49 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T11:36:49.009457', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754451409.0093749}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.6196742057800293, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.6197009086608887}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T11:36:48.342506', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '文档描述了一局对接链数优化项目，主要涉及接口校验逻辑调整和链数额度功能优化，以满足核心企业重推数据的需求。', 'functionCount': '3', 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': '1', 'apiName': ['确权业务申请'], 'dbChangeCount': '0', 'dbChangeName': [], 'mqCount': '0', 'mqName': [], 'timerCount': '0', 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '中建一局', '接口校验', '额度管理', '组织单元额度'], 'primaryKeywords': [{'keyword': '链数', 'frequency': '5', 'importance': '0.9', 'positions': ['标题', '标签', '需求背景', '功能需求说明'], 'context': ['一局对接链数的项目上线后', '链数额度功能调整']}, {'keyword': '接口校验', 'frequency': '3', 'importance': '0.8', 'positions': ['需求背景', '功能需求说明'], 'context': ['调整接口校验逻辑', '接口校验规则调整']}, {'keyword': '额度管理', 'frequency': '2', 'importance': '0.7', 'positions': ['功能需求说明'], 'context': ['功能名称由“链数额度”变更为“额度管理”']}], 'phrases': [{'phrase': '组织单元额度', 'frequency': '4', 'significance': '0.8'}, {'phrase': '确权业务申请', 'frequency': '2', 'significance': '0.7'}], 'semanticClusters': [{'clusterName': '接口优化', 'keywords': ['接口校验', '确权业务申请', 'bizSerialNo'], 'coherenceScore': '0.85'}, {'clusterName': '额度管理', 'keywords': ['额度管理', '组织单元额度', '链数额度'], 'coherenceScore': '0.8'}]}, 'metadata': {'userRole': ['金融服务部', '系统对接人员'], 'targetAudience': ['核心企业', '开发团队']}}, 'notes': {'model': 'ep-20250605091804-wmw6w'}}, 'metadata': {'analysis_duration': 24.633863925933838}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/377072e8-cfba-4d25-9383-d360694bf5ff_img_20250806_113649_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/377072e8-cfba-4d25-9383-d360694bf5ff_img_20250806_113649_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 11:36:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:36:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:56 - api_server - ERROR - 任务 377072e8-cfba-4d25-9383-d360694bf5ff AI分析失败: object dict can't be used in 'await' expression
2025-08-06 11:37:56 - api_server - ERROR - ❌ 任务 377072e8-cfba-4d25-9383-d360694bf5ff AI分析失败: object dict can't be used in 'await' expression
2025-08-06 11:37:56 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 11:37:56 - api_server - ERROR - AI分析失败: 377072e8-cfba-4d25-9383-d360694bf5ff, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 11:37:56 - api_server - INFO - 检测到form_data已生成，继续完成流程: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:37:56 - api_server - INFO - 任务 377072e8-cfba-4d25-9383-d360694bf5ff 进度更新: 100% - 完整分析流程完成
2025-08-06 11:37:56 - api_server - INFO - 完整分析流程成功完成: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:37:56 - api_server - INFO - 🎉 完整分析流程完成: 377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:37:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 11:37:56 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=377072e8-cfba-4d25-9383-d360694bf5ff
2025-08-06 11:37:56 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=377072e8-cfba-4d25-9383-d360694bf5ff, 表单字段数=11
2025-08-06 11:37:56 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 11:37:56 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 11:37:56 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 11:37:56 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 11:37:56 - api_server - INFO - ✅ GET get_analysis_result [200] (0.01s)
2025-08-06 14:02:28 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:02:28 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:02:28 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:02:30 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:02:30 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:02:30 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:15:41 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:15:41 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:15:41 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:15:48 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:15:48 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:15:48 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:15:56 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:15:56 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:15:56 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:15:57 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:15:57 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:15:57 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:17:32 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 14:17:32 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 14:17:32 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 0% - 分析流程启动中
2025-08-06 14:17:32 - api_server - INFO - 开始完整分析流程: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:17:32 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: 7c2c07b0-ab28-4956-b36b-e68d810e4b45, 大小: 849268 bytes
2025-08-06 14:17:32 - api_server - INFO - 🚀 完整分析流程启动: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:17:32 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:17:32 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.01s)
2025-08-06 14:17:32 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 10% - 开始文档解析
2025-08-06 14:17:32 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 10% - 开始解析文件
2025-08-06 14:17:32 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/7c2c07b0-ab28-4956-b36b-e68d810e4b45_一局对接链数优化V0.1.docx
2025-08-06 14:17:32 - api_server - INFO - 使用通用文件分析方法: 7c2c07b0-ab28-4956-b36b-e68d810e4b45_一局对接链数优化V0.1.docx
2025-08-06 14:17:32 - api_server - INFO - 检测到Word文档，使用Markdown转换: 7c2c07b0-ab28-4956-b36b-e68d810e4b45_一局对接链数优化V0.1.docx
2025-08-06 14:17:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:32 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 14:17:32 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:17:32 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:17:32 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/7c2c07b0-ab28-4956-b36b-e68d810e4b45_img_20250806_141732_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/7c2c07b0-ab28-4956-b36b-e68d810e4b45_img_20250806_141732_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 14:17:32 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:17:32 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/7c2c07b0-ab28-4956-b36b-e68d810e4b45_img_20250806_141732_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/7c2c07b0-ab28-4956-b36b-e68d810e4b45_img_20250806_141732_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 14:17:32 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 40% - 使用分析服务解析文档
2025-08-06 14:17:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:56 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 100% - 文档解析完成
2025-08-06 14:17:56 - api_server - INFO - ✅ 文件解析完成: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:17:56 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 40% - 开始内容分析
2025-08-06 14:17:56 - api_server - INFO - 🔍 开始内容分析任务: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:17:56 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 14:17:56 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 14:17:56 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 14:17:56 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 14:17:56 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 10% - 开始内容分析
2025-08-06 14:17:56 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 14:17:56 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/7c2c07b0-ab28-4956-b36b-e68d810e4b45_一局对接链数优化V0.1.docx
2025-08-06 14:17:56 - api_server - INFO - 使用通用文件分析方法: 7c2c07b0-ab28-4956-b36b-e68d810e4b45_一局对接链数优化V0.1.docx
2025-08-06 14:17:56 - api_server - INFO - 检测到Word文档，使用Markdown转换: 7c2c07b0-ab28-4956-b36b-e68d810e4b45_一局对接链数优化V0.1.docx
2025-08-06 14:17:56 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 14:17:56 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:17:56 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 30% - 获取到上传文件
2025-08-06 14:17:56 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 14:17:56 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 14:17:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:17:57 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 100% - 内容分析完成
2025-08-06 14:17:57 - api_server - INFO - ✅ 内容分析完成: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:17:57 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 70% - 开始AI设计方案
2025-08-06 14:17:57 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/7c2c07b0-ab28-4956-b36b-e68d810e4b45_一局对接链数优化V0.1.docx
2025-08-06 14:17:57 - api_server - INFO - 使用通用文件分析方法: 7c2c07b0-ab28-4956-b36b-e68d810e4b45_一局对接链数优化V0.1.docx
2025-08-06 14:17:57 - api_server - INFO - 检测到Word文档，使用Markdown转换: 7c2c07b0-ab28-4956-b36b-e68d810e4b45_一局对接链数优化V0.1.docx
2025-08-06 14:17:57 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 14:17:57 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:17:57 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 14:17:57 - api_server - INFO - 🤖 开始AI分析任务: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:17:57 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 10% - 开始AI设计方案
2025-08-06 14:17:57 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 14:17:57 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 14:17:57 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T14:17:57.203681', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754461077.203583}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.9395160675048828, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.9395480155944824}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T14:17:56.206891', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '该文档是关于一局对接链数优化的需求文档，主要描述了接口校验逻辑的调整、链数额度功能的变更以及新增组织单元额度功能的需求。', 'functionCount': '3', 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': '1', 'apiName': ['确权业务申请'], 'dbChangeCount': '0', 'dbChangeName': [], 'mqCount': '0', 'mqName': [], 'timerCount': '0', 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '中建一局', '接口校验', '额度管理', '组织单元额度'], 'primaryKeywords': [{'keyword': '接口校验', 'frequency': '5', 'importance': '0.9', 'positions': ['需求背景', '调整说明'], 'context': ['调整接口校验逻辑，兼容核心企业重推数据的场景']}, {'keyword': '额度管理', 'frequency': '3', 'importance': '0.8', 'positions': ['链数额度功能调整'], 'context': ['功能名称由“链数额度”变更为“额度管理”']}, {'keyword': '组织单元额度', 'frequency': '4', 'importance': '0.85', 'positions': ['新增组织单元额度功能'], 'context': ['新增“组织单元额度”列表页']}], 'phrases': [{'phrase': '接口校验逻辑', 'frequency': '3', 'significance': '高'}, {'phrase': '额度管理', 'frequency': '2', 'significance': '高'}, {'phrase': '组织单元额度', 'frequency': '3', 'significance': '高'}], 'semanticClusters': [{'clusterName': '接口调整', 'keywords': ['接口校验', 'bizSerialNo', '确权业务申请'], 'coherenceScore': '0.9'}, {'clusterName': '额度管理', 'keywords': ['额度管理', '链数额度', '组织单元额度'], 'coherenceScore': '0.85'}]}, 'metadata': {'userRole': ['金融服务部', '系统对接人员'], 'targetAudience': ['核心企业IT部门', '金融服务部相关人员']}}, 'notes': {'model': 'ep-20250605091804-wmw6w'}}, 'metadata': {'analysis_duration': 23.483115911483765}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/7c2c07b0-ab28-4956-b36b-e68d810e4b45_img_20250806_141757_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/7c2c07b0-ab28-4956-b36b-e68d810e4b45_img_20250806_141757_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 14:17:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:18:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:25 - api_server - ERROR - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 14:19:25 - api_server - ERROR - ❌ 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 14:19:25 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 14:19:25 - api_server - ERROR - AI分析失败: 7c2c07b0-ab28-4956-b36b-e68d810e4b45, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 14:19:25 - api_server - INFO - 检测到form_data已生成，继续完成流程: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:19:25 - api_server - INFO - 任务 7c2c07b0-ab28-4956-b36b-e68d810e4b45 进度更新: 100% - 完整分析流程完成
2025-08-06 14:19:25 - api_server - INFO - 完整分析流程成功完成: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:19:25 - api_server - INFO - 🎉 完整分析流程完成: 7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:19:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:19:27 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=7c2c07b0-ab28-4956-b36b-e68d810e4b45
2025-08-06 14:19:27 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=7c2c07b0-ab28-4956-b36b-e68d810e4b45, 表单字段数=11
2025-08-06 14:19:27 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 14:19:27 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 14:19:27 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 14:19:27 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 14:19:27 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-06 14:23:14 - api_server - INFO - ✅ POST coder_agent_api.process_design_document [200] (104.53s)
2025-08-06 14:23:59 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:23:59 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:23:59 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:24:01 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:24:01 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:24:01 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:24:50 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:24:50 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:24:50 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:24:56 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:24:56 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:24:56 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:25:04 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:25:04 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:25:04 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:25:06 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:25:06 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:25:06 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:31:00 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:31:00 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:31:00 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:31:06 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:31:06 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:31:06 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:31:14 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:31:14 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:31:14 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:31:15 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:31:15 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:31:15 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:41:12 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:41:12 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:41:12 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:41:24 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:41:24 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:41:24 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:43:51 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:43:51 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:43:51 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:43:59 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:43:59 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:43:59 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:44:34 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:44:34 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:44:34 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:44:40 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:44:40 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:44:41 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:46:17 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:46:17 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:46:17 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:46:24 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:46:24 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:46:24 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:46:32 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 14:46:32 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 14:46:32 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 14:46:33 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 14:46:33 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 14:46:33 - api_server - INFO - 增强分析器初始化成功
2025-08-06 14:46:48 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 14:46:48 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 14:46:48 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 0% - 分析流程启动中
2025-08-06 14:46:48 - api_server - INFO - 开始完整分析流程: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:46:48 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: 6d6bbf62-599b-4f82-9229-4e6918951c7f, 大小: 849268 bytes
2025-08-06 14:46:48 - api_server - INFO - 🚀 完整分析流程启动: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:46:48 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:46:48 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-06 14:46:48 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 10% - 开始文档解析
2025-08-06 14:46:48 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 10% - 开始解析文件
2025-08-06 14:46:48 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/6d6bbf62-599b-4f82-9229-4e6918951c7f_一局对接链数优化V0.1.docx
2025-08-06 14:46:48 - api_server - INFO - 使用通用文件分析方法: 6d6bbf62-599b-4f82-9229-4e6918951c7f_一局对接链数优化V0.1.docx
2025-08-06 14:46:48 - api_server - INFO - 检测到Word文档，使用Markdown转换: 6d6bbf62-599b-4f82-9229-4e6918951c7f_一局对接链数优化V0.1.docx
2025-08-06 14:46:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:46:48 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 14:46:48 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:46:48 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:46:48 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/6d6bbf62-599b-4f82-9229-4e6918951c7f_img_20250806_144648_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/6d6bbf62-599b-4f82-9229-4e6918951c7f_img_20250806_144648_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 14:46:48 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:46:48 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/6d6bbf62-599b-4f82-9229-4e6918951c7f_img_20250806_144648_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/6d6bbf62-599b-4f82-9229-4e6918951c7f_img_20250806_144648_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 14:46:48 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 40% - 使用分析服务解析文档
2025-08-06 14:46:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:46:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:46:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:46:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:46:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:11 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 100% - 文档解析完成
2025-08-06 14:47:11 - api_server - INFO - ✅ 文件解析完成: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:47:11 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 40% - 开始内容分析
2025-08-06 14:47:11 - api_server - INFO - 🔍 开始内容分析任务: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:47:11 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 14:47:11 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 14:47:11 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 14:47:11 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 14:47:11 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 10% - 开始内容分析
2025-08-06 14:47:11 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 14:47:11 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/6d6bbf62-599b-4f82-9229-4e6918951c7f_一局对接链数优化V0.1.docx
2025-08-06 14:47:11 - api_server - INFO - 使用通用文件分析方法: 6d6bbf62-599b-4f82-9229-4e6918951c7f_一局对接链数优化V0.1.docx
2025-08-06 14:47:11 - api_server - INFO - 检测到Word文档，使用Markdown转换: 6d6bbf62-599b-4f82-9229-4e6918951c7f_一局对接链数优化V0.1.docx
2025-08-06 14:47:11 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 14:47:11 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:47:11 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 30% - 获取到上传文件
2025-08-06 14:47:11 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 14:47:11 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 14:47:12 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 100% - 内容分析完成
2025-08-06 14:47:12 - api_server - INFO - ✅ 内容分析完成: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:47:12 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 70% - 开始AI设计方案
2025-08-06 14:47:12 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/6d6bbf62-599b-4f82-9229-4e6918951c7f_一局对接链数优化V0.1.docx
2025-08-06 14:47:12 - api_server - INFO - 使用通用文件分析方法: 6d6bbf62-599b-4f82-9229-4e6918951c7f_一局对接链数优化V0.1.docx
2025-08-06 14:47:12 - api_server - INFO - 检测到Word文档，使用Markdown转换: 6d6bbf62-599b-4f82-9229-4e6918951c7f_一局对接链数优化V0.1.docx
2025-08-06 14:47:12 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 14:47:12 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 14:47:12 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 14:47:12 - api_server - INFO - 🤖 开始AI分析任务: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:47:12 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 10% - 开始AI设计方案
2025-08-06 14:47:12 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 14:47:12 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 14:47:12 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T14:47:12.562708', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754462832.562638}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.6732161045074463, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.6732380390167236}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T14:47:11.830938', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '文档描述了对一局对接链数项目的优化需求，主要涉及接口校验逻辑调整和链数额度功能改进。', 'functionCount': 3, 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': 1, 'apiName': ['确权业务申请'], 'dbChangeCount': 0, 'dbChangeName': [], 'mqCount': 0, 'mqName': [], 'timerCount': 0, 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '中建一局', '接口校验', '额度管理', '组织单元额度'], 'primaryKeywords': [{'keyword': '链数', 'frequency': 5, 'importance': 0.9, 'positions': ['文档标题', '标签', '需求背景', '功能需求说明'], 'context': ['一局对接链数的项目上线后', '链数额度功能调整']}, {'keyword': '接口校验', 'frequency': 4, 'importance': 0.8, 'positions': ['需求背景', '功能需求说明'], 'context': ['对接口的校验逻辑进行调整', '接口校验规则调整']}], 'phrases': [{'phrase': '额度管理', 'frequency': 3, 'significance': 0.7}, {'phrase': '组织单元额度', 'frequency': 5, 'significance': 0.8}], 'semanticClusters': [{'clusterName': '接口优化', 'keywords': ['接口校验', 'bizSerialNo', '确权业务申请'], 'coherenceScore': 0.85}, {'clusterName': '额度管理', 'keywords': ['链数额度', '额度管理', '组织单元额度'], 'coherenceScore': 0.9}]}, 'metadata': {'userRole': ['所有人'], 'targetAudience': ['金融服务部', '系统对接人员']}}, 'notes': {'model': 'ep-20250605091804-wmw6w'}}, 'metadata': {'analysis_duration': 22.933454275131226}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/6d6bbf62-599b-4f82-9229-4e6918951c7f_img_20250806_144712_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/6d6bbf62-599b-4f82-9229-4e6918951c7f_img_20250806_144712_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 14:47:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:47:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:36 - api_server - ERROR - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f AI分析失败: object dict can't be used in 'await' expression
2025-08-06 14:48:36 - api_server - ERROR - ❌ 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f AI分析失败: object dict can't be used in 'await' expression
2025-08-06 14:48:36 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 14:48:36 - api_server - ERROR - AI分析失败: 6d6bbf62-599b-4f82-9229-4e6918951c7f, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 14:48:36 - api_server - INFO - 检测到form_data已生成，继续完成流程: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:48:36 - api_server - INFO - 任务 6d6bbf62-599b-4f82-9229-4e6918951c7f 进度更新: 100% - 完整分析流程完成
2025-08-06 14:48:36 - api_server - INFO - 完整分析流程成功完成: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:48:36 - api_server - INFO - 🎉 完整分析流程完成: 6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:48:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 14:48:37 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=6d6bbf62-599b-4f82-9229-4e6918951c7f
2025-08-06 14:48:37 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 14:48:37 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 14:48:37 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 14:48:37 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=6d6bbf62-599b-4f82-9229-4e6918951c7f, 表单字段数=11
2025-08-06 14:48:37 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-06 14:48:37 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 15:43:01 - api_server - INFO - ✅ POST coder_agent_api.process_design_document [200] (3175.66s)
2025-08-06 15:46:36 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 15:46:36 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 15:46:36 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 15:46:44 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 15:46:44 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 15:46:44 - api_server - INFO - 增强分析器初始化成功
2025-08-06 15:46:52 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 15:46:52 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 15:46:52 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 15:46:53 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 15:46:53 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 15:46:53 - api_server - INFO - 增强分析器初始化成功
2025-08-06 15:47:04 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 15:47:04 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 15:47:04 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 0% - 分析流程启动中
2025-08-06 15:47:04 - api_server - INFO - 开始完整分析流程: 57766ead-6768-40bb-b240-b283aaa79fd2
2025-08-06 15:47:04 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: 57766ead-6768-40bb-b240-b283aaa79fd2, 大小: 849268 bytes
2025-08-06 15:47:04 - api_server - INFO - 🚀 完整分析流程启动: 57766ead-6768-40bb-b240-b283aaa79fd2
2025-08-06 15:47:04 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: 57766ead-6768-40bb-b240-b283aaa79fd2
2025-08-06 15:47:04 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-06 15:47:04 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 10% - 开始文档解析
2025-08-06 15:47:04 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 10% - 开始解析文件
2025-08-06 15:47:04 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/57766ead-6768-40bb-b240-b283aaa79fd2_一局对接链数优化V0.1.docx
2025-08-06 15:47:04 - api_server - INFO - 使用通用文件分析方法: 57766ead-6768-40bb-b240-b283aaa79fd2_一局对接链数优化V0.1.docx
2025-08-06 15:47:04 - api_server - INFO - 检测到Word文档，使用Markdown转换: 57766ead-6768-40bb-b240-b283aaa79fd2_一局对接链数优化V0.1.docx
2025-08-06 15:47:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:04 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 15:47:04 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:47:04 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:47:04 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/57766ead-6768-40bb-b240-b283aaa79fd2_img_20250806_154704_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/57766ead-6768-40bb-b240-b283aaa79fd2_img_20250806_154704_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 15:47:04 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:47:04 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/57766ead-6768-40bb-b240-b283aaa79fd2_img_20250806_154704_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/57766ead-6768-40bb-b240-b283aaa79fd2_img_20250806_154704_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 15:47:04 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 40% - 使用分析服务解析文档
2025-08-06 15:47:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:26 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 100% - 文档解析完成
2025-08-06 15:47:26 - api_server - INFO - ✅ 文件解析完成: 57766ead-6768-40bb-b240-b283aaa79fd2
2025-08-06 15:47:26 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 40% - 开始内容分析
2025-08-06 15:47:26 - api_server - INFO - 🔍 开始内容分析任务: 57766ead-6768-40bb-b240-b283aaa79fd2
2025-08-06 15:47:26 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 15:47:26 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 15:47:26 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 15:47:26 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 15:47:26 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 10% - 开始内容分析
2025-08-06 15:47:26 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 15:47:26 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/57766ead-6768-40bb-b240-b283aaa79fd2_一局对接链数优化V0.1.docx
2025-08-06 15:47:26 - api_server - INFO - 使用通用文件分析方法: 57766ead-6768-40bb-b240-b283aaa79fd2_一局对接链数优化V0.1.docx
2025-08-06 15:47:26 - api_server - INFO - 检测到Word文档，使用Markdown转换: 57766ead-6768-40bb-b240-b283aaa79fd2_一局对接链数优化V0.1.docx
2025-08-06 15:47:26 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 15:47:26 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:47:26 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 30% - 获取到上传文件
2025-08-06 15:47:26 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 15:47:26 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 15:47:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:27 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 100% - 内容分析完成
2025-08-06 15:47:27 - api_server - INFO - ✅ 内容分析完成: 57766ead-6768-40bb-b240-b283aaa79fd2
2025-08-06 15:47:27 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 70% - 开始AI设计方案
2025-08-06 15:47:27 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/57766ead-6768-40bb-b240-b283aaa79fd2_一局对接链数优化V0.1.docx
2025-08-06 15:47:27 - api_server - INFO - 使用通用文件分析方法: 57766ead-6768-40bb-b240-b283aaa79fd2_一局对接链数优化V0.1.docx
2025-08-06 15:47:27 - api_server - INFO - 检测到Word文档，使用Markdown转换: 57766ead-6768-40bb-b240-b283aaa79fd2_一局对接链数优化V0.1.docx
2025-08-06 15:47:27 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 15:47:27 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:47:27 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 15:47:27 - api_server - INFO - 🤖 开始AI分析任务: 57766ead-6768-40bb-b240-b283aaa79fd2
2025-08-06 15:47:27 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 10% - 开始AI设计方案
2025-08-06 15:47:27 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 15:47:27 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 15:47:27 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T15:47:27.703742', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754466447.7036579}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.8508479595184326, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.850877046585083}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T15:47:26.790600', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '文档描述了一局对接链数优化项目，主要涉及接口校验逻辑调整和链数额度功能优化，以满足核心企业重推数据的需求。', 'functionCount': 3, 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': 1, 'apiName': ['确权业务申请'], 'dbChangeCount': 0, 'dbChangeName': [], 'mqCount': 0, 'mqName': [], 'timerCount': 0, 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '中建一局', '接口校验', '额度管理', '组织单元额度', 'bizSerialNo', '确权业务申请'], 'primaryKeywords': [{'keyword': '链数', 'frequency': 5, 'importance': 0.9, 'positions': ['标题', '需求背景', '功能需求说明'], 'context': ['一局对接链数的项目上线后', '链数额度功能调整']}, {'keyword': '接口校验', 'frequency': 3, 'importance': 0.8, 'positions': ['需求背景', '功能需求说明'], 'context': ['调整接口校验逻辑', '确权业务申请接口中关于bizSerialNo的校验规则']}, {'keyword': '额度管理', 'frequency': 2, 'importance': 0.7, 'positions': ['功能需求说明'], 'context': ['功能名称由“链数额度”变更为“额度管理”']}], 'phrases': [{'phrase': '组织单元额度', 'frequency': 4, 'significance': '高'}, {'phrase': '确权业务申请', 'frequency': 2, 'significance': '高'}], 'semanticClusters': [{'clusterName': '接口优化', 'keywords': ['接口校验', 'bizSerialNo', '确权业务申请'], 'coherenceScore': 0.85}, {'clusterName': '额度管理', 'keywords': ['额度管理', '组织单元额度', '链数额度'], 'coherenceScore': 0.8}]}, 'metadata': {'userRole': ['金融服务部', '系统对接人员'], 'targetAudience': ['核心企业', '开发团队']}}, 'notes': {'model': 'ep-20250605091804-wmw6w'}}, 'metadata': {'analysis_duration': 22.006394147872925}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/57766ead-6768-40bb-b240-b283aaa79fd2_img_20250806_154727_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/57766ead-6768-40bb-b240-b283aaa79fd2_img_20250806_154727_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 15:47:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:47:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:48:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:48:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:48:03 - api_server - ERROR - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 15:48:03 - api_server - ERROR - ❌ 任务 57766ead-6768-40bb-b240-b283aaa79fd2 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 15:48:03 - api_server - INFO - 任务 57766ead-6768-40bb-b240-b283aaa79fd2 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 15:48:03 - api_server - ERROR - AI分析失败: 57766ead-6768-40bb-b240-b283aaa79fd2, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 15:48:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:57:42 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 15:57:42 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 15:57:42 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 15:57:50 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 15:57:50 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 15:57:50 - api_server - INFO - 增强分析器初始化成功
2025-08-06 15:57:57 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 15:57:58 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 15:57:58 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 15:57:59 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 15:57:59 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 15:57:59 - api_server - INFO - 增强分析器初始化成功
2025-08-06 15:59:01 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 15:59:01 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 15:59:01 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 0% - 分析流程启动中
2025-08-06 15:59:01 - api_server - INFO - 开始完整分析流程: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 15:59:01 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a, 大小: 849268 bytes
2025-08-06 15:59:01 - api_server - INFO - 🚀 完整分析流程启动: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 15:59:01 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 15:59:01 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.01s)
2025-08-06 15:59:01 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 10% - 开始文档解析
2025-08-06 15:59:01 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 10% - 开始解析文件
2025-08-06 15:59:01 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/1c8399c9-2064-482c-8d9f-3d8a6b8d597a_一局对接链数优化V0.1.docx
2025-08-06 15:59:01 - api_server - INFO - 使用通用文件分析方法: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a_一局对接链数优化V0.1.docx
2025-08-06 15:59:01 - api_server - INFO - 检测到Word文档，使用Markdown转换: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a_一局对接链数优化V0.1.docx
2025-08-06 15:59:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:01 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 15:59:01 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:59:01 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:59:01 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/1c8399c9-2064-482c-8d9f-3d8a6b8d597a_img_20250806_155901_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/1c8399c9-2064-482c-8d9f-3d8a6b8d597a_img_20250806_155901_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 15:59:01 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:59:01 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/1c8399c9-2064-482c-8d9f-3d8a6b8d597a_img_20250806_155901_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/1c8399c9-2064-482c-8d9f-3d8a6b8d597a_img_20250806_155901_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 15:59:01 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 40% - 使用分析服务解析文档
2025-08-06 15:59:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:22 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 100% - 文档解析完成
2025-08-06 15:59:22 - api_server - INFO - ✅ 文件解析完成: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 15:59:22 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 40% - 开始内容分析
2025-08-06 15:59:22 - api_server - INFO - 🔍 开始内容分析任务: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 15:59:22 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 15:59:22 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 15:59:22 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 15:59:22 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 15:59:22 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 10% - 开始内容分析
2025-08-06 15:59:22 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 15:59:22 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/1c8399c9-2064-482c-8d9f-3d8a6b8d597a_一局对接链数优化V0.1.docx
2025-08-06 15:59:22 - api_server - INFO - 使用通用文件分析方法: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a_一局对接链数优化V0.1.docx
2025-08-06 15:59:22 - api_server - INFO - 检测到Word文档，使用Markdown转换: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a_一局对接链数优化V0.1.docx
2025-08-06 15:59:22 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 15:59:22 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:59:22 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 30% - 获取到上传文件
2025-08-06 15:59:22 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 15:59:22 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 15:59:23 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 100% - 内容分析完成
2025-08-06 15:59:23 - api_server - INFO - ✅ 内容分析完成: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 15:59:23 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 70% - 开始AI设计方案
2025-08-06 15:59:23 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/1c8399c9-2064-482c-8d9f-3d8a6b8d597a_一局对接链数优化V0.1.docx
2025-08-06 15:59:23 - api_server - INFO - 使用通用文件分析方法: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a_一局对接链数优化V0.1.docx
2025-08-06 15:59:23 - api_server - INFO - 检测到Word文档，使用Markdown转换: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a_一局对接链数优化V0.1.docx
2025-08-06 15:59:23 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 15:59:23 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 15:59:23 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 15:59:23 - api_server - INFO - 🤖 开始AI分析任务: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 15:59:23 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 10% - 开始AI设计方案
2025-08-06 15:59:23 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 15:59:23 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 15:59:23 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T15:59:23.333728', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754467163.3336608}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.8826758861541748, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.8826990127563477}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T15:59:22.389014', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '该文档描述了对一局对接链数项目的优化需求，主要涉及接口校验逻辑调整和链数额度功能改进。', 'functionCount': 3, 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': 1, 'apiName': ['确权业务申请'], 'dbChangeCount': 0, 'dbChangeName': [], 'mqCount': 0, 'mqName': [], 'timerCount': 0, 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '中建一局', '接口校验', '额度管理', '组织单元额度'], 'primaryKeywords': [{'keyword': '链数', 'frequency': 5, 'importance': 0.9, 'positions': ['标题', '标签', '需求背景', '功能需求说明'], 'context': ['一局对接链数优化', '链数额度功能调整']}, {'keyword': '接口校验', 'frequency': 4, 'importance': 0.8, 'positions': ['需求背景', '功能需求说明'], 'context': ['调整接口校验逻辑', '确权业务申请接口校验规则']}, {'keyword': '额度管理', 'frequency': 3, 'importance': 0.7, 'positions': ['功能需求说明'], 'context': ['功能名称由“链数额度”变更为“额度管理”']}], 'phrases': [{'phrase': '组织单元额度', 'frequency': 6, 'significance': '高'}, {'phrase': '确权业务申请', 'frequency': 2, 'significance': '中'}], 'semanticClusters': [{'clusterName': '接口优化', 'keywords': ['接口校验', '确权业务申请', 'bizSerialNo'], 'coherenceScore': 0.85}, {'clusterName': '额度管理', 'keywords': ['额度管理', '组织单元额度', '链数额度'], 'coherenceScore': 0.9}]}, 'metadata': {'userRole': ['系统开发人员', '金融服务部'], 'targetAudience': ['技术团队', '需求方']}}, 'notes': {'model': 'ep-20250605091804-wmw6w'}}, 'metadata': {'analysis_duration': 20.502938985824585}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/1c8399c9-2064-482c-8d9f-3d8a6b8d597a_img_20250806_155923_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/1c8399c9-2064-482c-8d9f-3d8a6b8d597a_img_20250806_155923_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 15:59:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 15:59:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:44 - api_server - ERROR - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:00:44 - api_server - ERROR - ❌ 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:00:44 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:00:44 - api_server - ERROR - AI分析失败: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:00:44 - api_server - INFO - 检测到form_data已生成，继续完成流程: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 16:00:44 - api_server - INFO - 任务 1c8399c9-2064-482c-8d9f-3d8a6b8d597a 进度更新: 100% - 完整分析流程完成
2025-08-06 16:00:44 - api_server - INFO - 完整分析流程成功完成: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 16:00:44 - api_server - INFO - 🎉 完整分析流程完成: 1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 16:00:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:00:46 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=1c8399c9-2064-482c-8d9f-3d8a6b8d597a
2025-08-06 16:00:46 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=1c8399c9-2064-482c-8d9f-3d8a6b8d597a, 表单字段数=11
2025-08-06 16:00:46 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 16:00:46 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 16:00:46 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 16:00:46 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 16:00:46 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-06 16:18:56 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 16:18:56 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:18:56 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:19:04 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:19:04 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:19:04 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:19:11 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 16:19:11 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:19:11 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:19:13 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:19:13 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:19:13 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:19:30 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 16:19:30 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 16:19:30 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 0% - 分析流程启动中
2025-08-06 16:19:30 - api_server - INFO - 开始完整分析流程: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:19:30 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: ae4732b1-3687-43fa-8f66-90b8410b0568, 大小: 849268 bytes
2025-08-06 16:19:30 - api_server - INFO - 🚀 完整分析流程启动: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:19:30 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:19:30 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-06 16:19:30 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 10% - 开始文档解析
2025-08-06 16:19:30 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 10% - 开始解析文件
2025-08-06 16:19:30 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/ae4732b1-3687-43fa-8f66-90b8410b0568_一局对接链数优化V0.1.docx
2025-08-06 16:19:30 - api_server - INFO - 使用通用文件分析方法: ae4732b1-3687-43fa-8f66-90b8410b0568_一局对接链数优化V0.1.docx
2025-08-06 16:19:30 - api_server - INFO - 检测到Word文档，使用Markdown转换: ae4732b1-3687-43fa-8f66-90b8410b0568_一局对接链数优化V0.1.docx
2025-08-06 16:19:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:30 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 16:19:30 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:19:30 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:19:30 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/ae4732b1-3687-43fa-8f66-90b8410b0568_img_20250806_161930_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/ae4732b1-3687-43fa-8f66-90b8410b0568_img_20250806_161930_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 16:19:30 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:19:30 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/ae4732b1-3687-43fa-8f66-90b8410b0568_img_20250806_161930_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/ae4732b1-3687-43fa-8f66-90b8410b0568_img_20250806_161930_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 16:19:30 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 40% - 使用分析服务解析文档
2025-08-06 16:19:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:49 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 100% - 文档解析完成
2025-08-06 16:19:49 - api_server - INFO - ✅ 文件解析完成: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:19:49 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 40% - 开始内容分析
2025-08-06 16:19:49 - api_server - INFO - 🔍 开始内容分析任务: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:19:49 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 16:19:49 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 16:19:49 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 16:19:49 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 16:19:49 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 10% - 开始内容分析
2025-08-06 16:19:49 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 16:19:49 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/ae4732b1-3687-43fa-8f66-90b8410b0568_一局对接链数优化V0.1.docx
2025-08-06 16:19:49 - api_server - INFO - 使用通用文件分析方法: ae4732b1-3687-43fa-8f66-90b8410b0568_一局对接链数优化V0.1.docx
2025-08-06 16:19:49 - api_server - INFO - 检测到Word文档，使用Markdown转换: ae4732b1-3687-43fa-8f66-90b8410b0568_一局对接链数优化V0.1.docx
2025-08-06 16:19:49 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 16:19:49 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:19:49 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 30% - 获取到上传文件
2025-08-06 16:19:49 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 16:19:49 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 16:19:50 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 100% - 内容分析完成
2025-08-06 16:19:50 - api_server - INFO - ✅ 内容分析完成: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:19:50 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 70% - 开始AI设计方案
2025-08-06 16:19:50 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/ae4732b1-3687-43fa-8f66-90b8410b0568_一局对接链数优化V0.1.docx
2025-08-06 16:19:50 - api_server - INFO - 使用通用文件分析方法: ae4732b1-3687-43fa-8f66-90b8410b0568_一局对接链数优化V0.1.docx
2025-08-06 16:19:50 - api_server - INFO - 检测到Word文档，使用Markdown转换: ae4732b1-3687-43fa-8f66-90b8410b0568_一局对接链数优化V0.1.docx
2025-08-06 16:19:50 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 16:19:50 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:19:50 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 16:19:50 - api_server - INFO - 🤖 开始AI分析任务: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:19:50 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 10% - 开始AI设计方案
2025-08-06 16:19:50 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 16:19:50 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 16:19:50 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T16:19:50.650881', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754468390.650749}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.8495578765869141, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.8496158123016357}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T16:19:49.754270', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '文档描述了一局对接链数优化项目，主要涉及接口校验规则调整、链数额度功能调整以及新增组织单元额度功能。', 'functionCount': '3', 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': '1', 'apiName': ['确权业务申请'], 'dbChangeCount': '0', 'dbChangeName': [], 'mqCount': '0', 'mqName': [], 'timerCount': '0', 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '中建一局', '接口校验', '额度管理', '组织单元额度'], 'primaryKeywords': [{'keyword': '链数', 'frequency': '5', 'importance': '0.9', 'positions': ['需求背景', '建设目标及路线', '功能需求说明'], 'context': ['一局对接链数的项目上线后', '链数额度功能调整']}, {'keyword': '接口校验', 'frequency': '3', 'importance': '0.8', 'positions': ['需求背景', '功能需求说明'], 'context': ['接口的校验逻辑进行调整', '确权业务申请接口中关于bizSerialNo的校验规则进行调整']}], 'phrases': [{'phrase': '组织单元额度', 'frequency': '4', 'significance': '0.7'}, {'phrase': '额度管理', 'frequency': '3', 'significance': '0.6'}], 'semanticClusters': [{'clusterName': '接口调整', 'keywords': ['接口校验', 'bizSerialNo', '确权业务申请'], 'coherenceScore': '0.85'}, {'clusterName': '额度功能', 'keywords': ['链数额度', '额度管理', '组织单元额度'], 'coherenceScore': '0.75'}]}, 'metadata': {'userRole': ['金融服务部', '核心企业'], 'targetAudience': ['开发团队', '需求方', '测试团队']}}, 'notes': {'model': 'ep-20250605091804-wmw6w'}}, 'metadata': {'analysis_duration': 18.823051929473877}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/ae4732b1-3687-43fa-8f66-90b8410b0568_img_20250806_161950_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/ae4732b1-3687-43fa-8f66-90b8410b0568_img_20250806_161950_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 16:19:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:19:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:20:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:58 - api_server - ERROR - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:21:58 - api_server - ERROR - ❌ 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:21:58 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:21:58 - api_server - ERROR - AI分析失败: ae4732b1-3687-43fa-8f66-90b8410b0568, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:21:58 - api_server - INFO - 检测到form_data已生成，继续完成流程: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:21:58 - api_server - INFO - 任务 ae4732b1-3687-43fa-8f66-90b8410b0568 进度更新: 100% - 完整分析流程完成
2025-08-06 16:21:58 - api_server - INFO - 完整分析流程成功完成: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:21:58 - api_server - INFO - 🎉 完整分析流程完成: ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:21:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:21:59 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=ae4732b1-3687-43fa-8f66-90b8410b0568
2025-08-06 16:21:59 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=ae4732b1-3687-43fa-8f66-90b8410b0568, 表单字段数=11
2025-08-06 16:21:59 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 16:21:59 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 16:21:59 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 16:21:59 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 16:21:59 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-06 16:29:04 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 16:29:04 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:29:04 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:29:14 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:29:14 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:29:14 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:29:22 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 16:29:22 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:29:22 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:29:24 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:29:24 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:29:24 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:30:15 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 16:30:15 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:30:15 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:30:17 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:30:17 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:30:17 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:30:31 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250605091804-wmw6w', 'temperature': 0.7}
2025-08-06 16:30:31 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:30:31 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:30:33 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:30:33 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:30:33 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:30:57 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 16:30:57 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:30:57 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:30:58 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:30:58 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:30:58 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:33:10 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 16:33:10 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:33:10 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:33:12 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:33:12 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:33:12 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:33:50 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 16:33:50 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:33:50 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:33:52 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:33:52 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:33:52 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:39:16 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 16:39:16 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:39:16 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:39:18 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:39:18 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:39:18 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:39:30 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 16:39:30 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:39:30 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:39:37 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:39:37 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:39:37 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:39:45 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 16:39:45 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 16:39:45 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 16:39:46 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 16:39:46 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 16:39:46 - api_server - INFO - 增强分析器初始化成功
2025-08-06 16:40:21 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 16:40:21 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 16:40:21 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 0% - 分析流程启动中
2025-08-06 16:40:21 - api_server - INFO - 开始完整分析流程: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:40:21 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: 7d138dde-6170-491d-a95f-69ecfe00afd6, 大小: 849268 bytes
2025-08-06 16:40:21 - api_server - INFO - 🚀 完整分析流程启动: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:40:21 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:40:21 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-06 16:40:21 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 10% - 开始文档解析
2025-08-06 16:40:21 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 10% - 开始解析文件
2025-08-06 16:40:21 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/7d138dde-6170-491d-a95f-69ecfe00afd6_一局对接链数优化V0.1.docx
2025-08-06 16:40:21 - api_server - INFO - 使用通用文件分析方法: 7d138dde-6170-491d-a95f-69ecfe00afd6_一局对接链数优化V0.1.docx
2025-08-06 16:40:21 - api_server - INFO - 检测到Word文档，使用Markdown转换: 7d138dde-6170-491d-a95f-69ecfe00afd6_一局对接链数优化V0.1.docx
2025-08-06 16:40:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:21 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 16:40:21 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:40:21 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:40:21 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/7d138dde-6170-491d-a95f-69ecfe00afd6_img_20250806_164021_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/7d138dde-6170-491d-a95f-69ecfe00afd6_img_20250806_164021_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 16:40:21 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:40:21 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/7d138dde-6170-491d-a95f-69ecfe00afd6_img_20250806_164021_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/7d138dde-6170-491d-a95f-69ecfe00afd6_img_20250806_164021_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 16:40:21 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 40% - 使用分析服务解析文档
2025-08-06 16:40:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:42 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 100% - 文档解析完成
2025-08-06 16:40:42 - api_server - INFO - ✅ 文件解析完成: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:40:42 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 40% - 开始内容分析
2025-08-06 16:40:42 - api_server - INFO - 🔍 开始内容分析任务: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:40:42 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 16:40:42 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 16:40:42 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 16:40:42 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 16:40:42 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 10% - 开始内容分析
2025-08-06 16:40:42 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 16:40:42 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/7d138dde-6170-491d-a95f-69ecfe00afd6_一局对接链数优化V0.1.docx
2025-08-06 16:40:42 - api_server - INFO - 使用通用文件分析方法: 7d138dde-6170-491d-a95f-69ecfe00afd6_一局对接链数优化V0.1.docx
2025-08-06 16:40:42 - api_server - INFO - 检测到Word文档，使用Markdown转换: 7d138dde-6170-491d-a95f-69ecfe00afd6_一局对接链数优化V0.1.docx
2025-08-06 16:40:42 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 16:40:42 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:40:42 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 30% - 获取到上传文件
2025-08-06 16:40:42 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 16:40:42 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 16:40:43 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 100% - 内容分析完成
2025-08-06 16:40:43 - api_server - INFO - ✅ 内容分析完成: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:40:43 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 70% - 开始AI设计方案
2025-08-06 16:40:43 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/7d138dde-6170-491d-a95f-69ecfe00afd6_一局对接链数优化V0.1.docx
2025-08-06 16:40:43 - api_server - INFO - 使用通用文件分析方法: 7d138dde-6170-491d-a95f-69ecfe00afd6_一局对接链数优化V0.1.docx
2025-08-06 16:40:43 - api_server - INFO - 检测到Word文档，使用Markdown转换: 7d138dde-6170-491d-a95f-69ecfe00afd6_一局对接链数优化V0.1.docx
2025-08-06 16:40:43 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 16:40:43 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 16:40:43 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 16:40:43 - api_server - INFO - 🤖 开始AI分析任务: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:40:43 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 10% - 开始AI设计方案
2025-08-06 16:40:43 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 16:40:43 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 16:40:43 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T16:40:43.585011', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754469643.584901}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.8330130577087402, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.833050012588501}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T16:40:42.692806', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '文档描述“一局对接链数优化”项目的需求：在核心企业希望重复推送相同业务编号数据时，调整接口校验逻辑；同时优化链数额度功能，更名为“额度管理”，并新增“组织单元额度”列表页，支持查询与导出链数/云信额度明细。', 'functionCount': 3, 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': 1, 'apiName': ['确权业务申请'], 'dbChangeCount': 0, 'dbChangeName': [], 'mqCount': 0, 'mqName': [], 'timerCount': 0, 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '额度管理', '组织单元额度', 'bizSerialNo', '接口校验', '云信额度', '导出', '筛选', '已分配额度', '已用额度', '可用额度'], 'primaryKeywords': [{'keyword': '链数', 'frequency': 12, 'importance': 0.9, 'positions': ['需求背景', '链数额度', '链数业务数据', '组织单元额度'], 'context': ['链数额度功能调整', '链数业务数据对应的bizSerialNo', '链数额度明细']}, {'keyword': '额度管理', 'frequency': 5, 'importance': 0.85, 'positions': ['链数额度功能调整', '组织单元额度'], 'context': ['功能名称由链数额度变更为额度管理', '额度管理列表页']}, {'keyword': 'bizSerialNo', 'frequency': 4, 'importance': 0.8, 'positions': ['接口校验规则调整'], 'context': ['bizSerialNo不可与已成功推送的非已作废、已删除状态的链数业务数据重复']}], 'phrases': [{'phrase': '组织单元额度', 'frequency': 8, 'significance': 0.9}, {'phrase': '接口校验逻辑', 'frequency': 3, 'significance': 0.8}, {'phrase': '额度类型', 'frequency': 5, 'significance': 0.75}], 'semanticClusters': [{'clusterName': '额度管理', 'keywords': ['额度管理', '链数额度', '云信额度', '组织单元额度', '已分配额度', '已用额度', '可用额度'], 'coherenceScore': 0.92}, {'clusterName': '接口校验', 'keywords': ['接口校验', 'bizSerialNo', '确权业务申请', '重复推送'], 'coherenceScore': 0.88}]}, 'metadata': {'userRole': ['核心企业用户', '金融服务部'], 'targetAudience': ['系统开发团队', '产品团队', '测试团队', '核心企业业务人员']}}, 'notes': {'model': 'ep-20250724094351-pnjf4'}}, 'metadata': {'analysis_duration': 20.9099018573761}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/7d138dde-6170-491d-a95f-69ecfe00afd6_img_20250806_164043_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/7d138dde-6170-491d-a95f-69ecfe00afd6_img_20250806_164043_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 16:40:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-08-06 16:40:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:40:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:41:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-08-06 16:41:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:42:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:42:04 - api_server - ERROR - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:42:04 - api_server - ERROR - ❌ 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:42:04 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:42:04 - api_server - ERROR - AI分析失败: 7d138dde-6170-491d-a95f-69ecfe00afd6, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 16:42:04 - api_server - INFO - 检测到form_data已生成，继续完成流程: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:42:04 - api_server - INFO - 任务 7d138dde-6170-491d-a95f-69ecfe00afd6 进度更新: 100% - 完整分析流程完成
2025-08-06 16:42:04 - api_server - INFO - 完整分析流程成功完成: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:42:04 - api_server - INFO - 🎉 完整分析流程完成: 7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:42:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 16:42:05 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=7d138dde-6170-491d-a95f-69ecfe00afd6
2025-08-06 16:42:05 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=7d138dde-6170-491d-a95f-69ecfe00afd6, 表单字段数=11
2025-08-06 16:42:05 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 16:42:05 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 16:42:05 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 16:42:05 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 16:42:05 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-06 17:06:40 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 17:06:40 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 17:06:40 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 17:06:47 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 17:06:47 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 17:06:47 - api_server - INFO - 增强分析器初始化成功
2025-08-06 17:06:55 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 17:06:55 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 17:06:55 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 17:06:56 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 17:06:56 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 17:06:56 - api_server - INFO - 增强分析器初始化成功
2025-08-06 17:07:08 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 17:07:08 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 17:07:08 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 0% - 分析流程启动中
2025-08-06 17:07:08 - api_server - INFO - 开始完整分析流程: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:07:08 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: 4df01f77-3920-4cb3-9b9e-cdbe7567256f, 大小: 849268 bytes
2025-08-06 17:07:08 - api_server - INFO - 🚀 完整分析流程启动: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:07:08 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:07:08 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-06 17:07:08 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 10% - 开始文档解析
2025-08-06 17:07:08 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 10% - 开始解析文件
2025-08-06 17:07:08 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/4df01f77-3920-4cb3-9b9e-cdbe7567256f_一局对接链数优化V0.1.docx
2025-08-06 17:07:08 - api_server - INFO - 使用通用文件分析方法: 4df01f77-3920-4cb3-9b9e-cdbe7567256f_一局对接链数优化V0.1.docx
2025-08-06 17:07:08 - api_server - INFO - 检测到Word文档，使用Markdown转换: 4df01f77-3920-4cb3-9b9e-cdbe7567256f_一局对接链数优化V0.1.docx
2025-08-06 17:07:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:08 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 17:07:08 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:07:08 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:07:08 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/4df01f77-3920-4cb3-9b9e-cdbe7567256f_img_20250806_170708_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/4df01f77-3920-4cb3-9b9e-cdbe7567256f_img_20250806_170708_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 17:07:08 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:07:08 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/4df01f77-3920-4cb3-9b9e-cdbe7567256f_img_20250806_170708_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/4df01f77-3920-4cb3-9b9e-cdbe7567256f_img_20250806_170708_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 17:07:08 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 40% - 使用分析服务解析文档
2025-08-06 17:07:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-08-06 17:07:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:40 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 100% - 文档解析完成
2025-08-06 17:07:40 - api_server - INFO - ✅ 文件解析完成: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:07:40 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 40% - 开始内容分析
2025-08-06 17:07:40 - api_server - INFO - 🔍 开始内容分析任务: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:07:40 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 17:07:40 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 17:07:40 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 17:07:40 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 17:07:40 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 10% - 开始内容分析
2025-08-06 17:07:40 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 17:07:40 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/4df01f77-3920-4cb3-9b9e-cdbe7567256f_一局对接链数优化V0.1.docx
2025-08-06 17:07:40 - api_server - INFO - 使用通用文件分析方法: 4df01f77-3920-4cb3-9b9e-cdbe7567256f_一局对接链数优化V0.1.docx
2025-08-06 17:07:40 - api_server - INFO - 检测到Word文档，使用Markdown转换: 4df01f77-3920-4cb3-9b9e-cdbe7567256f_一局对接链数优化V0.1.docx
2025-08-06 17:07:40 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 17:07:40 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:07:40 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 30% - 获取到上传文件
2025-08-06 17:07:40 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 17:07:40 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 17:07:41 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 100% - 内容分析完成
2025-08-06 17:07:41 - api_server - INFO - ✅ 内容分析完成: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:07:41 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 70% - 开始AI设计方案
2025-08-06 17:07:41 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/4df01f77-3920-4cb3-9b9e-cdbe7567256f_一局对接链数优化V0.1.docx
2025-08-06 17:07:41 - api_server - INFO - 使用通用文件分析方法: 4df01f77-3920-4cb3-9b9e-cdbe7567256f_一局对接链数优化V0.1.docx
2025-08-06 17:07:41 - api_server - INFO - 检测到Word文档，使用Markdown转换: 4df01f77-3920-4cb3-9b9e-cdbe7567256f_一局对接链数优化V0.1.docx
2025-08-06 17:07:41 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 17:07:41 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:07:41 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 17:07:41 - api_server - INFO - 🤖 开始AI分析任务: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:07:41 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 10% - 开始AI设计方案
2025-08-06 17:07:41 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 17:07:41 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 17:07:41 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T17:07:41.457755', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754471261.457645}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.6318728923797607, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.6319057941436768}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T17:07:40.764830', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '本文档围绕“一局对接链数优化”项目，提出两项主要需求：1. 调整确权业务申请接口的校验规则，允许核心企业以相同业务编号重新推送已修改的数据；2. 在额度管理模块中，新增“组织单元额度”功能，支持核心企业查询并导出各组织单元的链数额度及云信额度明细，同时对原有“链数额度”功能进行名称与交互优化。', 'functionCount': 3, 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': 1, 'apiName': ['确权业务申请'], 'dbChangeCount': 0, 'dbChangeName': [], 'mqCount': 0, 'mqName': [], 'timerCount': 0, 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '额度', '组织单元', '接口', '校验', 'bizSerialNo', '云信', '导出', '筛选', '额度管理'], 'primaryKeywords': [{'keyword': '链数', 'frequency': 12, 'importance': 0.9, 'positions': ['标题', '需求背景', '链数额度功能调整', '组织单元额度功能'], 'context': ['一局对接链数优化', '链数额度', '链数业务数据', '链数额度明细']}, {'keyword': '额度', 'frequency': 25, 'importance': 0.95, 'positions': ['链数额度功能调整', '组织单元额度功能', '额度管理', '额度类型', '额度名称'], 'context': ['额度管理', '链数额度', '云信额度', '已分配额度', '已用额度', '可用额度']}, {'keyword': 'bizSerialNo', 'frequency': 3, 'importance': 0.85, 'positions': ['接口校验规则调整'], 'context': ['bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复']}], 'phrases': [{'phrase': '额度管理', 'frequency': 6, 'significance': '高'}, {'phrase': '组织单元额度', 'frequency': 8, 'significance': '高'}, {'phrase': '接口校验规则', 'frequency': 3, 'significance': '中'}], 'semanticClusters': [{'clusterName': '额度管理', 'keywords': ['额度', '链数额度', '云信额度', '额度类型', '额度名称', '已分配额度', '已用额度', '可用额度'], 'coherenceScore': 0.92}, {'clusterName': '接口校验', 'keywords': ['接口', '校验', 'bizSerialNo', '确权业务申请', '推送'], 'coherenceScore': 0.88}, {'clusterName': '组织单元', 'keywords': ['组织单元', '组织单元名称', '组织单元额度', '多组织企业'], 'coherenceScore': 0.85}]}, 'metadata': {'userRole': ['核心企业用户', '金融服务部'], 'targetAudience': ['中企云链（北京）金融信息服务有限公司技术团队', '中建一局业务方', '金融服务部需求方']}}, 'notes': {'model': 'ep-20250724094351-pnjf4'}}, 'metadata': {'analysis_duration': 31.8110191822052}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/4df01f77-3920-4cb3-9b9e-cdbe7567256f_img_20250806_170741_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/4df01f77-3920-4cb3-9b9e-cdbe7567256f_img_20250806_170741_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 17:07:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:07:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:08:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:54 - api_server - ERROR - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:09:54 - api_server - ERROR - ❌ 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:09:54 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:09:54 - api_server - ERROR - AI分析失败: 4df01f77-3920-4cb3-9b9e-cdbe7567256f, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:09:54 - api_server - INFO - 检测到form_data已生成，继续完成流程: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:09:54 - api_server - INFO - 任务 4df01f77-3920-4cb3-9b9e-cdbe7567256f 进度更新: 100% - 完整分析流程完成
2025-08-06 17:09:54 - api_server - INFO - 完整分析流程成功完成: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:09:54 - api_server - INFO - 🎉 完整分析流程完成: 4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:09:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:09:56 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=4df01f77-3920-4cb3-9b9e-cdbe7567256f
2025-08-06 17:09:56 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=4df01f77-3920-4cb3-9b9e-cdbe7567256f, 表单字段数=11
2025-08-06 17:09:56 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 17:09:56 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 17:09:56 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 17:09:56 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 17:09:56 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-06 17:15:09 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 17:15:09 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 17:15:09 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 17:15:15 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 17:15:15 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 17:15:15 - api_server - INFO - 增强分析器初始化成功
2025-08-06 17:15:22 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 17:15:22 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 17:15:22 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 17:15:24 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 17:15:24 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 17:15:24 - api_server - INFO - 增强分析器初始化成功
2025-08-06 17:15:56 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 17:15:56 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 17:15:56 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 0% - 分析流程启动中
2025-08-06 17:15:56 - api_server - INFO - 开始完整分析流程: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:15:56 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: d3aac7b9-7fa0-4450-b257-2814d88685e5, 大小: 849268 bytes
2025-08-06 17:15:56 - api_server - INFO - 🚀 完整分析流程启动: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:15:56 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:15:56 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.01s)
2025-08-06 17:15:56 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 10% - 开始文档解析
2025-08-06 17:15:56 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 10% - 开始解析文件
2025-08-06 17:15:56 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/d3aac7b9-7fa0-4450-b257-2814d88685e5_一局对接链数优化V0.1.docx
2025-08-06 17:15:56 - api_server - INFO - 使用通用文件分析方法: d3aac7b9-7fa0-4450-b257-2814d88685e5_一局对接链数优化V0.1.docx
2025-08-06 17:15:56 - api_server - INFO - 检测到Word文档，使用Markdown转换: d3aac7b9-7fa0-4450-b257-2814d88685e5_一局对接链数优化V0.1.docx
2025-08-06 17:15:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:15:56 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 17:15:56 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:15:56 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:15:56 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/d3aac7b9-7fa0-4450-b257-2814d88685e5_img_20250806_171556_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/d3aac7b9-7fa0-4450-b257-2814d88685e5_img_20250806_171556_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 17:15:56 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:15:56 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/d3aac7b9-7fa0-4450-b257-2814d88685e5_img_20250806_171556_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/d3aac7b9-7fa0-4450-b257-2814d88685e5_img_20250806_171556_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 17:15:56 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 40% - 使用分析服务解析文档
2025-08-06 17:15:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:15 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 100% - 文档解析完成
2025-08-06 17:16:15 - api_server - INFO - ✅ 文件解析完成: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:16:15 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 40% - 开始内容分析
2025-08-06 17:16:15 - api_server - INFO - 🔍 开始内容分析任务: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:16:15 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 17:16:15 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 17:16:15 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 17:16:15 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 17:16:15 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 10% - 开始内容分析
2025-08-06 17:16:15 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 17:16:15 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/d3aac7b9-7fa0-4450-b257-2814d88685e5_一局对接链数优化V0.1.docx
2025-08-06 17:16:15 - api_server - INFO - 使用通用文件分析方法: d3aac7b9-7fa0-4450-b257-2814d88685e5_一局对接链数优化V0.1.docx
2025-08-06 17:16:15 - api_server - INFO - 检测到Word文档，使用Markdown转换: d3aac7b9-7fa0-4450-b257-2814d88685e5_一局对接链数优化V0.1.docx
2025-08-06 17:16:15 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 17:16:15 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:16:15 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 30% - 获取到上传文件
2025-08-06 17:16:15 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 17:16:15 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 17:16:16 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 100% - 内容分析完成
2025-08-06 17:16:16 - api_server - INFO - ✅ 内容分析完成: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:16:16 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 70% - 开始AI设计方案
2025-08-06 17:16:16 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/d3aac7b9-7fa0-4450-b257-2814d88685e5_一局对接链数优化V0.1.docx
2025-08-06 17:16:16 - api_server - INFO - 使用通用文件分析方法: d3aac7b9-7fa0-4450-b257-2814d88685e5_一局对接链数优化V0.1.docx
2025-08-06 17:16:16 - api_server - INFO - 检测到Word文档，使用Markdown转换: d3aac7b9-7fa0-4450-b257-2814d88685e5_一局对接链数优化V0.1.docx
2025-08-06 17:16:16 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 17:16:16 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:16:16 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 17:16:16 - api_server - INFO - 🤖 开始AI分析任务: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:16:16 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 10% - 开始AI设计方案
2025-08-06 17:16:16 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 17:16:16 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 17:16:16 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T17:16:16.634417', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754471776.634309}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.6827912330627441, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.6828253269195557}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T17:16:15.891446', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '该文档为中企云链（北京）金融信息服务有限公司针对“一局对接链数优化”项目的需求文档（V0.1）。主要目标是通过调整接口校验逻辑，支持核心企业在内部修改已推送数据后，使用原业务编号再次推送至平台。同时，对“链数额度”功能进行更名与扩展，新增“组织单元额度”列表页，支持查询和导出链数及云信额度明细。', 'functionCount': 3, 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': 1, 'apiName': ['确权业务申请'], 'dbChangeCount': 0, 'dbChangeName': [], 'mqCount': 0, 'mqName': [], 'timerCount': 0, 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '额度管理', '组织单元额度', '接口校验', 'bizSerialNo', '云信额度', '确权业务申请', '重推数据', '核心企业', '平台'], 'primaryKeywords': [{'keyword': '链数', 'frequency': 15, 'importance': 0.95, 'positions': ['标题', '需求背景', '功能名称', '额度类型', '列表字段'], 'context': ['链数额度', '链数业务数据', '链数额度明细']}, {'keyword': 'bizSerialNo', 'frequency': 4, 'importance': 0.9, 'positions': ['接口校验规则调整', '调整说明'], 'context': ['bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复']}, {'keyword': '额度管理', 'frequency': 6, 'importance': 0.85, 'positions': ['链数额度功能调整', '新增组织单元额度功能'], 'context': ['功能名称由“链数额度”变更为“额度管理”', '返回至“额度管理”列表页']}], 'phrases': [{'phrase': '接口校验逻辑', 'frequency': 2, 'significance': '高'}, {'phrase': '组织单元额度', 'frequency': 8, 'significance': '高'}, {'phrase': '确权业务申请', 'frequency': 2, 'significance': '中'}], 'semanticClusters': [{'clusterName': '额度管理', 'keywords': ['链数额度', '云信额度', '组织单元额度', '额度类型', '额度名称', '已分配额度', '已用额度', '可用额度'], 'coherenceScore': 0.92}, {'clusterName': '接口校验', 'keywords': ['bizSerialNo', '确权业务申请', '重推数据', '接口校验逻辑', '业务编号'], 'coherenceScore': 0.88}]}, 'metadata': {'userRole': ['核心企业用户', '金融服务部', '系统开发人员'], 'targetAudience': ['核心企业系统管理员', '金融服务部业务人员', '中企云链平台开发人员']}}, 'notes': {'model': 'ep-20250724094351-pnjf4'}}, 'metadata': {'analysis_duration': 19.459319829940796}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/d3aac7b9-7fa0-4450-b257-2814d88685e5_img_20250806_171616_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/d3aac7b9-7fa0-4450-b257-2814d88685e5_img_20250806_171616_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 17:16:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:16:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:17 - api_server - ERROR - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:17:17 - api_server - ERROR - ❌ 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:17:17 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:17:17 - api_server - ERROR - AI分析失败: d3aac7b9-7fa0-4450-b257-2814d88685e5, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:17:17 - api_server - INFO - 检测到form_data已生成，继续完成流程: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:17:17 - api_server - INFO - 任务 d3aac7b9-7fa0-4450-b257-2814d88685e5 进度更新: 100% - 完整分析流程完成
2025-08-06 17:17:17 - api_server - INFO - 完整分析流程成功完成: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:17:17 - api_server - INFO - 🎉 完整分析流程完成: d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:17:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:17:18 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=d3aac7b9-7fa0-4450-b257-2814d88685e5
2025-08-06 17:17:18 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 17:17:18 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 17:17:18 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 17:17:18 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-06 17:17:18 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=d3aac7b9-7fa0-4450-b257-2814d88685e5, 表单字段数=11
2025-08-06 17:17:18 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 17:43:18 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 17:43:18 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 17:43:18 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 0% - 分析流程启动中
2025-08-06 17:43:18 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: 5f401036-bcdd-4143-8e32-a62fea50825b, 大小: 849268 bytes
2025-08-06 17:43:18 - api_server - INFO - 开始完整分析流程: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:43:18 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:43:18 - api_server - INFO - 🚀 完整分析流程启动: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:43:18 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.01s)
2025-08-06 17:43:18 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 10% - 开始文档解析
2025-08-06 17:43:18 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 10% - 开始解析文件
2025-08-06 17:43:18 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/5f401036-bcdd-4143-8e32-a62fea50825b_一局对接链数优化V0.1.docx
2025-08-06 17:43:18 - api_server - INFO - 使用通用文件分析方法: 5f401036-bcdd-4143-8e32-a62fea50825b_一局对接链数优化V0.1.docx
2025-08-06 17:43:18 - api_server - INFO - 检测到Word文档，使用Markdown转换: 5f401036-bcdd-4143-8e32-a62fea50825b_一局对接链数优化V0.1.docx
2025-08-06 17:43:18 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:18 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 17:43:18 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:43:18 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:43:18 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/5f401036-bcdd-4143-8e32-a62fea50825b_img_20250806_174318_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/5f401036-bcdd-4143-8e32-a62fea50825b_img_20250806_174318_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 17:43:18 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:43:18 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/5f401036-bcdd-4143-8e32-a62fea50825b_img_20250806_174318_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/5f401036-bcdd-4143-8e32-a62fea50825b_img_20250806_174318_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 17:43:18 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 40% - 使用分析服务解析文档
2025-08-06 17:43:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:22 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:24 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:28 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:30 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:34 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:36 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:36 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 100% - 文档解析完成
2025-08-06 17:43:36 - api_server - INFO - ✅ 文件解析完成: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:43:36 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 40% - 开始内容分析
2025-08-06 17:43:36 - api_server - INFO - 🔍 开始内容分析任务: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:43:36 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 17:43:36 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 17:43:36 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 17:43:36 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 17:43:36 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 10% - 开始内容分析
2025-08-06 17:43:36 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 17:43:36 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/5f401036-bcdd-4143-8e32-a62fea50825b_一局对接链数优化V0.1.docx
2025-08-06 17:43:36 - api_server - INFO - 使用通用文件分析方法: 5f401036-bcdd-4143-8e32-a62fea50825b_一局对接链数优化V0.1.docx
2025-08-06 17:43:36 - api_server - INFO - 检测到Word文档，使用Markdown转换: 5f401036-bcdd-4143-8e32-a62fea50825b_一局对接链数优化V0.1.docx
2025-08-06 17:43:36 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 17:43:36 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:43:36 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 30% - 获取到上传文件
2025-08-06 17:43:36 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 17:43:36 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 17:43:37 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 100% - 内容分析完成
2025-08-06 17:43:37 - api_server - INFO - ✅ 内容分析完成: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:43:37 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 70% - 开始AI设计方案
2025-08-06 17:43:37 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/5f401036-bcdd-4143-8e32-a62fea50825b_一局对接链数优化V0.1.docx
2025-08-06 17:43:37 - api_server - INFO - 使用通用文件分析方法: 5f401036-bcdd-4143-8e32-a62fea50825b_一局对接链数优化V0.1.docx
2025-08-06 17:43:37 - api_server - INFO - 检测到Word文档，使用Markdown转换: 5f401036-bcdd-4143-8e32-a62fea50825b_一局对接链数优化V0.1.docx
2025-08-06 17:43:37 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 17:43:37 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 17:43:37 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 17:43:37 - api_server - INFO - 🤖 开始AI分析任务: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:43:37 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 10% - 开始AI设计方案
2025-08-06 17:43:37 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 17:43:37 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 17:43:37 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T17:43:37.332558', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754473417.3324769}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.5604259967803955, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.5604500770568848}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T17:43:36.699044', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '本文档针对“一局对接链数优化”项目，提出在现有接口校验逻辑中允许核心企业重推已修改业务数据的需求，并同步调整链数额度相关功能：将“链数额度”更名为“额度管理”，新增“组织单元额度”列表页，支持查询、筛选、导出链数及云信额度明细。', 'functionCount': 3, 'functionName': ['接口校验规则调整', '链数额度功能调整', '新增组织单元额度功能'], 'apiCount': 1, 'apiName': ['确权业务申请接口'], 'dbChangeCount': 0, 'dbChangeName': [], 'mqCount': 0, 'mqName': [], 'timerCount': 0, 'timerName': []}, 'contentKeyWord': {'keywords': ['链数', '额度管理', '组织单元额度', 'bizSerialNo', '接口校验', '云信额度', '确权业务申请', '重推数据', '已作废', '已删除'], 'primaryKeywords': [{'keyword': '链数', 'frequency': 14, 'importance': 0.95, 'positions': ['需求背景', '链数额度功能调整', '新增组织单元额度功能'], 'context': ['链数额度', '链数业务数据', '链数额度明细']}, {'keyword': '额度管理', 'frequency': 6, 'importance': 0.85, 'positions': ['链数额度功能调整', '新增组织单元额度功能'], 'context': ['功能名称由“链数额度”变更为“额度管理”', '返回至“额度管理”列表页']}, {'keyword': 'bizSerialNo', 'frequency': 4, 'importance': 0.9, 'positions': ['接口校验规则调整'], 'context': ['bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复']}], 'phrases': [{'phrase': '接口校验逻辑', 'frequency': 2, 'significance': 'high'}, {'phrase': '组织单元额度', 'frequency': 8, 'significance': 'high'}, {'phrase': '额度类型', 'frequency': 5, 'significance': 'medium'}], 'semanticClusters': [{'clusterName': '额度管理', 'keywords': ['额度管理', '链数额度', '云信额度', '组织单元额度', '已分配额度', '已用额度', '可用额度'], 'coherenceScore': 0.92}, {'clusterName': '接口校验', 'keywords': ['接口校验', 'bizSerialNo', '重推数据', '已作废', '已删除'], 'coherenceScore': 0.88}]}, 'metadata': {'userRole': ['核心企业用户', '金融服务部', '系统开发/测试人员'], 'targetAudience': ['中企云链内部开发、测试、产品团队', '中建一局业务及IT人员']}}, 'notes': {'model': 'ep-20250724094351-pnjf4'}}, 'metadata': {'analysis_duration': 18.088865995407104}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/5f401036-bcdd-4143-8e32-a62fea50825b_img_20250806_174337_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/5f401036-bcdd-4143-8e32-a62fea50825b_img_20250806_174337_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 17:43:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:40 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:42 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:46 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:48 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:52 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:43:58 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:04 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:12 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:16 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:39 - api_server - ERROR - 任务 5f401036-bcdd-4143-8e32-a62fea50825b AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:44:39 - api_server - ERROR - ❌ 任务 5f401036-bcdd-4143-8e32-a62fea50825b AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:44:39 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:44:39 - api_server - ERROR - AI分析失败: 5f401036-bcdd-4143-8e32-a62fea50825b, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 17:44:39 - api_server - INFO - 检测到form_data已生成，继续完成流程: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:44:39 - api_server - INFO - 任务 5f401036-bcdd-4143-8e32-a62fea50825b 进度更新: 100% - 完整分析流程完成
2025-08-06 17:44:39 - api_server - INFO - 完整分析流程成功完成: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:44:39 - api_server - INFO - 🎉 完整分析流程完成: 5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:44:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 17:44:41 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=5f401036-bcdd-4143-8e32-a62fea50825b
2025-08-06 17:44:41 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=5f401036-bcdd-4143-8e32-a62fea50825b, 表单字段数=11
2025-08-06 17:44:41 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 17:44:41 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 17:44:41 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 17:44:41 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 17:44:41 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-06 18:02:35 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 18:02:35 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 18:02:35 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 0% - 分析流程启动中
2025-08-06 18:02:35 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: afd10be1-77f2-48b6-83c0-7cdfc02221c9, 大小: 849268 bytes
2025-08-06 18:02:35 - api_server - INFO - 开始完整分析流程: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:02:35 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:02:35 - api_server - INFO - 🚀 完整分析流程启动: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:02:35 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.01s)
2025-08-06 18:02:35 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 10% - 开始文档解析
2025-08-06 18:02:35 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 10% - 开始解析文件
2025-08-06 18:02:35 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/afd10be1-77f2-48b6-83c0-7cdfc02221c9_一局对接链数优化V0.1.docx
2025-08-06 18:02:35 - api_server - INFO - 使用通用文件分析方法: afd10be1-77f2-48b6-83c0-7cdfc02221c9_一局对接链数优化V0.1.docx
2025-08-06 18:02:35 - api_server - INFO - 检测到Word文档，使用Markdown转换: afd10be1-77f2-48b6-83c0-7cdfc02221c9_一局对接链数优化V0.1.docx
2025-08-06 18:02:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:35 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 18:02:35 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 18:02:35 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 18:02:35 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/afd10be1-77f2-48b6-83c0-7cdfc02221c9_img_20250806_180235_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/afd10be1-77f2-48b6-83c0-7cdfc02221c9_img_20250806_180235_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 18:02:35 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 18:02:35 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/afd10be1-77f2-48b6-83c0-7cdfc02221c9_img_20250806_180235_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/afd10be1-77f2-48b6-83c0-7cdfc02221c9_img_20250806_180235_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 18:02:35 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 40% - 使用分析服务解析文档
2025-08-06 18:02:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:52 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 100% - 文档解析完成
2025-08-06 18:02:52 - api_server - INFO - ✅ 文件解析完成: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:02:52 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 40% - 开始内容分析
2025-08-06 18:02:52 - api_server - INFO - 🔍 开始内容分析任务: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:02:52 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 18:02:52 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 18:02:52 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 18:02:52 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 18:02:52 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 10% - 开始内容分析
2025-08-06 18:02:52 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 18:02:52 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/afd10be1-77f2-48b6-83c0-7cdfc02221c9_一局对接链数优化V0.1.docx
2025-08-06 18:02:52 - api_server - INFO - 使用通用文件分析方法: afd10be1-77f2-48b6-83c0-7cdfc02221c9_一局对接链数优化V0.1.docx
2025-08-06 18:02:52 - api_server - INFO - 检测到Word文档，使用Markdown转换: afd10be1-77f2-48b6-83c0-7cdfc02221c9_一局对接链数优化V0.1.docx
2025-08-06 18:02:52 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 18:02:52 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 18:02:52 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 30% - 获取到上传文件
2025-08-06 18:02:52 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 18:02:52 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 18:02:53 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 100% - 内容分析完成
2025-08-06 18:02:53 - api_server - INFO - ✅ 内容分析完成: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:02:53 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 70% - 开始AI设计方案
2025-08-06 18:02:53 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/afd10be1-77f2-48b6-83c0-7cdfc02221c9_一局对接链数优化V0.1.docx
2025-08-06 18:02:53 - api_server - INFO - 使用通用文件分析方法: afd10be1-77f2-48b6-83c0-7cdfc02221c9_一局对接链数优化V0.1.docx
2025-08-06 18:02:53 - api_server - INFO - 检测到Word文档，使用Markdown转换: afd10be1-77f2-48b6-83c0-7cdfc02221c9_一局对接链数优化V0.1.docx
2025-08-06 18:02:53 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 18:02:53 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 18:02:53 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 18:02:53 - api_server - INFO - 🤖 开始AI分析任务: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:02:53 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 10% - 开始AI设计方案
2025-08-06 18:02:53 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 18:02:53 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 18:02:53 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T18:02:53.102687', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754474573.102624}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.5339059829711914, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.5339260101318359}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T18:02:52.502328', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '本需求文档聚焦“一局对接链数优化”项目，核心诉求是允许核心企业在内部修改已推送业务数据后，用原业务编号再次推送至平台。为此需调整确权业务申请接口的 bizSerialNo 校验逻辑，并同步改造额度管理相关功能：将“链数额度”更名为“额度管理”，新增“组织单元额度”列表页，支持查询/导出链数及云信额度明细。', 'functionCount': '3', 'functionName': ['接口校验规则调整', '链数额度功能调整（更名为额度管理）', '新增组织单元额度功能'], 'apiCount': '1', 'apiName': ['确权业务申请接口（zqyl-data-open）'], 'dbChangeCount': '0', 'dbChangeName': [], 'mqCount': '0', 'mqName': [], 'timerCount': '0', 'timerName': []}, 'contentKeyWord': {'keywords': ['bizSerialNo', '链数', '额度管理', '组织单元额度', '云信额度', '接口校验', '确权业务申请', '已作废', '已删除', '重复推送'], 'primaryKeywords': [{'keyword': 'bizSerialNo', 'frequency': '4', 'importance': 0.95, 'positions': ['接口校验规则调整-调整说明-表格', '接口校验规则调整-调整说明-正文'], 'context': ['bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复']}, {'keyword': '额度管理', 'frequency': '6', 'importance': 0.9, 'positions': ['链数额度功能调整-调整说明', '新增组织单元额度功能-交互说明'], 'context': ['功能名称由“链数额度”变更为“额度管理”']}, {'keyword': '组织单元额度', 'frequency': '8', 'importance': 0.85, 'positions': ['链数额度功能调整-调整说明', '新增组织单元额度功能-调整说明'], 'context': ['新增“组织单元额度”按钮', '新增“组织单元额度”列表页']}], 'phrases': [{'phrase': '接口校验逻辑', 'frequency': 2, 'significance': 'high'}, {'phrase': '额度类型', 'frequency': 4, 'significance': 'medium'}, {'phrase': '已作废/已删除', 'frequency': 2, 'significance': 'high'}], 'semanticClusters': [{'clusterName': '接口与校验', 'keywords': ['bizSerialNo', '接口校验', '确权业务申请', '重复推送', '已作废', '已删除'], 'coherenceScore': 0.93}, {'clusterName': '额度功能', 'keywords': ['额度管理', '链数额度', '云信额度', '组织单元额度', '额度类型', '导出', '筛选'], 'coherenceScore': 0.91}]}, 'metadata': {'userRole': ['核心企业用户', '金融服务部', '系统开发/运维'], 'targetAudience': ['中企云链产品团队', '中建一局IT/业务部门', '开发测试人员']}}, 'notes': {'model': 'ep-20250724094351-pnjf4'}}, 'metadata': {'analysis_duration': 17.36980414390564}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/afd10be1-77f2-48b6-83c0-7cdfc02221c9_img_20250806_180253_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/afd10be1-77f2-48b6-83c0-7cdfc02221c9_img_20250806_180253_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 18:02:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:02:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:19 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:21 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:25 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:27 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:31 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:33 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:37 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:39 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-08-06 18:03:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:55 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:03:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:04:01 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:04:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:04:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:04:07 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:04:09 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:04:11 - api_server - ERROR - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 18:04:11 - api_server - ERROR - ❌ 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 18:04:11 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 18:04:11 - api_server - ERROR - AI分析失败: afd10be1-77f2-48b6-83c0-7cdfc02221c9, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 18:04:11 - api_server - INFO - 检测到form_data已生成，继续完成流程: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:04:11 - api_server - INFO - 任务 afd10be1-77f2-48b6-83c0-7cdfc02221c9 进度更新: 100% - 完整分析流程完成
2025-08-06 18:04:11 - api_server - INFO - 完整分析流程成功完成: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:04:11 - api_server - INFO - 🎉 完整分析流程完成: afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:04:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 18:04:11 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=afd10be1-77f2-48b6-83c0-7cdfc02221c9
2025-08-06 18:04:11 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 18:04:11 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=afd10be1-77f2-48b6-83c0-7cdfc02221c9, 表单字段数=11
2025-08-06 18:04:11 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 18:04:11 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 18:04:11 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 18:04:11 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
2025-08-06 19:08:40 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 19:08:40 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 19:08:40 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 19:08:50 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 19:08:50 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 19:08:50 - api_server - INFO - 增强分析器初始化成功
2025-08-06 19:08:58 - api_server - INFO - 从配置文件读取火山引擎配置: {'api_key': '7fcb3541-9363-4bfa-90aa-19e9f691bc25', 'endpoint': 'https://ark.cn-beijing.volces.com/api/v3', 'max_tokens': 16000, 'model': 'ep-20250724094351-pnjf4', 'temperature': 0.7}
2025-08-06 19:08:58 - api_server - INFO - 火山引擎客户端初始化成功
2025-08-06 19:08:58 - api_server - INFO - Weaviate配置: http://localhost:8080
2025-08-06 19:08:59 - api_server - INFO - 分析服务管理器初始化成功
2025-08-06 19:08:59 - api_server - INFO - 分析服务管理器已集成到API服务器
2025-08-06 19:08:59 - api_server - INFO - 增强分析器初始化成功
2025-08-06 19:10:43 - api_server - INFO - file_info包含content字段，长度: 1132360
2025-08-06 19:10:43 - api_server - INFO - base64解码成功，file_content类型: <class 'bytes'>, 大小: 849268 bytes
2025-08-06 19:10:43 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 0% - 分析流程启动中
2025-08-06 19:10:43 - api_server - INFO - 开始完整分析流程: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:10:43 - api_server - INFO - V2 完整分析启动成功: 一局对接链数优化V0.1.docx, 任务ID: 2ce05f14-039a-4f62-aa30-4490350b3733, 大小: 849268 bytes
2025-08-06 19:10:43 - api_server - INFO - 🚀 完整分析流程启动: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:10:43 - api_server - INFO - 🚀 V2 完整分析启动: 一局对接链数优化V0.1.docx, 任务ID: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:10:43 - api_server - INFO - ✅ POST start_analysis_v2 [200] (0.02s)
2025-08-06 19:10:43 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 10% - 开始文档解析
2025-08-06 19:10:43 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 10% - 开始解析文件
2025-08-06 19:10:43 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/2ce05f14-039a-4f62-aa30-4490350b3733_一局对接链数优化V0.1.docx
2025-08-06 19:10:43 - api_server - INFO - 使用通用文件分析方法: 2ce05f14-039a-4f62-aa30-4490350b3733_一局对接链数优化V0.1.docx
2025-08-06 19:10:43 - api_server - INFO - 检测到Word文档，使用Markdown转换: 2ce05f14-039a-4f62-aa30-4490350b3733_一局对接链数优化V0.1.docx
2025-08-06 19:10:43 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:10:43 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 19:10:43 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 19:10:43 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 19:10:43 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/2ce05f14-039a-4f62-aa30-4490350b3733_img_20250806_191043_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/2ce05f14-039a-4f62-aa30-4490350b3733_img_20250806_191043_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 19:10:43 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 19:10:43 - api_server - INFO - 转换后内容预览: 一局对接链数优化

需求文档

| 版本 | V0.1 |
| --- | --- |
| 撰写人 | 李威明 |
| 类型 | 系统对接 |
| 标签 | 链数、中建一局 |

中企云链（北京）金融信息服务有限公司

文档控制

需求方

| 日期 | 需求人 | 需求部门 | 说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 徐艺 | 金融服务部 |  |

版本记录

| 日期 | 撰写人 | 版本 | 变更说明 |
| --- | --- | --- | --- |
| 2025/4/30 | 李威明 | V0.1 | 创建文档 |

目录

第1章 项目介绍	4

1.1 需求背景	4

1.2 建设目标及路线	4

第2章 整体说明	4

2.1 需求模型	4

2.2 功能结构图	4

2.3 信息结构图	4

2.4 项目范围	4

2.4.1 新增功能	4

2.4.2 调整功能	4

第3章 功能需求说明	4

3.1 调整说明	4

# 项目介绍

## 需求背景

- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。

## 建设目标及路线

- 调整接口校验逻辑，兼容核心企业重推数据的场景。

# 整体说明

## 需求模型

## 功能结构图

## 信息结构图

## 项目范围

### 新增功能

### 调整功能

# 功能需求说明

## 接口校验规则调整

### 调整说明

本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：

| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |
| --- | --- | --- | --- | --- | --- |
| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |

## 链数额度功能调整

### 调整说明

本期，对原“链数额度”功能做如下调整：

- 功能名称由“链数额度”变更为“额度管理”；

- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。

- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。

![图片2](http://localhost:8082/uploads/temp/2ce05f14-039a-4f62-aa30-4490350b3733_img_20250806_191043_1.png)

## 新增组织单元额度功能

### 调整说明

本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。

具体如下：

- 交互说明：

![图片1](http://localhost:8082/uploads/temp/2ce05f14-039a-4f62-aa30-4490350b3733_img_20250806_191043_0.png)

（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）

- 返回：用户点击返回，返回至“额度管理”列表页。

- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。

- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。

- 功能说明：

- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。

- 字段说明：

- 筛选字段：

| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |
| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |

- 汇总字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |
| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |
| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |

- 备注：筛选条件更新后，汇总值需要同步更新计算。

- 列表字段：

| 序号 | 字段名 | 类型格式 | 规则 |
| --- | --- | --- | --- |
| 1 | 组织单元名称 | 字符串 |  |
| 2 | 额度名称 | 字符串 |  |
| 3 | 额度类型 | 字符串 |  |
| 4 | 已分配额度（元） | 数值 |  |
| 5 | 已用额度（元） | 数值 |  |
| 6 | 可用额度（元） | 数值 |  |

- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。
2025-08-06 19:10:43 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 40% - 使用分析服务解析文档
2025-08-06 19:10:45 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:10:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:10:49 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:10:51 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:10:54 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:10:57 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:00 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:01 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 100% - 文档解析完成
2025-08-06 19:11:01 - api_server - INFO - ✅ 文件解析完成: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:11:01 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 40% - 开始内容分析
2025-08-06 19:11:01 - api_server - INFO - 🔍 开始内容分析任务: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:11:01 - api_server - INFO - 📊 任务当前状态: content_analyzing
2025-08-06 19:11:01 - api_server - INFO - 📊 任务当前进度: 40%
2025-08-06 19:11:01 - api_server - INFO - 📊 解析结果存在: True
2025-08-06 19:11:01 - api_server - INFO - 📊 分析服务管理器可用: True
2025-08-06 19:11:01 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 10% - 开始内容分析
2025-08-06 19:11:01 - api_server - INFO - ✅ 任务状态已更新为: content_analyzing
2025-08-06 19:11:01 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/2ce05f14-039a-4f62-aa30-4490350b3733_一局对接链数优化V0.1.docx
2025-08-06 19:11:01 - api_server - INFO - 使用通用文件分析方法: 2ce05f14-039a-4f62-aa30-4490350b3733_一局对接链数优化V0.1.docx
2025-08-06 19:11:01 - api_server - INFO - 检测到Word文档，使用Markdown转换: 2ce05f14-039a-4f62-aa30-4490350b3733_一局对接链数优化V0.1.docx
2025-08-06 19:11:02 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 19:11:02 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 19:11:02 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 30% - 获取到上传文件
2025-08-06 19:11:02 - api_server - INFO - 📄 提取到文档内容，长度: 2547 字符
2025-08-06 19:11:02 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 35% - 内容分析管理器开始分析
2025-08-06 19:11:02 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 100% - 内容分析完成
2025-08-06 19:11:02 - api_server - INFO - ✅ 内容分析完成: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:11:02 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 70% - 开始AI设计方案
2025-08-06 19:11:02 - api_server - INFO - 从文件路径读取: /Users/renyu/Documents/ai_project/document_analyzer/uploads/temp/2ce05f14-039a-4f62-aa30-4490350b3733_一局对接链数优化V0.1.docx
2025-08-06 19:11:02 - api_server - INFO - 使用通用文件分析方法: 2ce05f14-039a-4f62-aa30-4490350b3733_一局对接链数优化V0.1.docx
2025-08-06 19:11:02 - api_server - INFO - 检测到Word文档，使用Markdown转换: 2ce05f14-039a-4f62-aa30-4490350b3733_一局对接链数优化V0.1.docx
2025-08-06 19:11:02 - api_server - INFO - Word文档已成功转换为Markdown格式，长度: 2547 字符
2025-08-06 19:11:02 - api_server - INFO - 提取的文本内容已准备完毕
2025-08-06 19:11:02 - api_server - INFO - 获取原始文档内容用于AI分析，长度: 2547
2025-08-06 19:11:02 - api_server - INFO - 🤖 开始AI分析任务: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:11:02 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 10% - 开始AI设计方案
2025-08-06 19:11:02 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 30% - 使用分析服务进行AI分析
2025-08-06 19:11:02 - api_server - INFO - 传递原始文档内容进行AI分析，长度: 2547
2025-08-06 19:11:02 - api_server - INFO - input_data: {'content_analysis': {'success': True, 'timestamp': '2025-08-06T19:11:02.887467', 'service': 'ContentAnalyzerService', 'data': {'change_analysis': {'change_analyses': [], 'deletion_analyses': [], 'summary': {'total_changes': 0, 'total_deletions': 0, 'analysis_method': 'LLM+向量数据库分析+详细内容提取+智能合并+大模型智能去重+排序'}, 'metadata': {'deduplication_applied': True, 'llm_deduplication_applied': True, 'deduplication_timestamp': 1754478662.887394}}, 'metadata': {'analysis_method': 'LLM分析+向量化分析+详细内容提取+智能合并', 'vector_enabled': False, 'embedding_enabled': True, 'analysis_time': 0.8700850009918213, 'content_length': 2547, 'chunks_count': 5}}, 'metadata': {'analysis_duration': 0.870110034942627}}, 'parsing_result': {'success': True, 'timestamp': '2025-08-06T19:11:01.958813', 'service': 'DocumentParserService', 'data': {'fileFormat': {'primaryType': 'word', 'subType': 'docx', 'encoding': 'utf-8', 'confidence': 0.95, 'fileName': '一局对接链数优化V0.1', 'basicInfo': {'fileSize': 5299, 'estimatedPages': 3, 'language': '中文', 'charset': 'utf-8'}, 'technicalDetails': {'lineCount': 158, 'wordCount': 421, 'charCount': 2547, 'emptyLines': 66}}, 'documentStructure': {'contentSummary': {'abstract': '本需求文档围绕“一局对接链数优化”展开，核心目标是调整接口校验逻辑，允许核心企业以相同业务编号重推修改后的数据；同时对“链数额度”功能进行更名、页面交互及字段扩展，并新增“组织单元额度”列表页，支持链数额度与云信额度的查询、筛选、导出。', 'functionCount': '3', 'functionName': ['接口校验规则调整', '链数额度功能调整（更名为额度管理）', '新增组织单元额度功能'], 'apiCount': '1', 'apiName': ['确权业务申请'], 'dbChangeCount': '0', 'dbChangeName': [], 'mqCount': '0', 'mqName': [], 'timerCount': '0', 'timerName': []}, 'contentKeyWord': {'keywords': ['bizSerialNo', '链数额度', '额度管理', '组织单元额度', '云信额度', '接口校验', '重推数据', '确权业务申请', '筛选', '导出'], 'primaryKeywords': [{'keyword': 'bizSerialNo', 'frequency': '4', 'importance': 0.9, 'positions': ['接口校验规则调整-调整说明-表格', '需求背景', '建设目标及路线'], 'context': ['相同业务编号的业务数据不可重复推送', 'bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复']}, {'keyword': '链数额度', 'frequency': '7', 'importance': 0.85, 'positions': ['链数额度功能调整', '新增组织单元额度功能', '额度类型下拉选项'], 'context': ['功能名称由“链数额度”变更为“额度管理”', '若为链数额度则取值为“链数额度”']}, {'keyword': '组织单元额度', 'frequency': '6', 'importance': 0.8, 'positions': ['新增组织单元额度功能', '链数额度功能调整-按钮', '交互说明'], 'context': ['新增“组织单元额度”列表页', '当且仅当当前登录企业为多组织企业时展示该按钮']}], 'phrases': [{'phrase': '接口校验逻辑调整', 'frequency': 3, 'significance': 0.9}, {'phrase': '额度管理', 'frequency': 5, 'significance': 0.85}, {'phrase': '组织单元额度', 'frequency': 6, 'significance': 0.8}], 'semanticClusters': [{'clusterName': '接口与数据推送', 'keywords': ['bizSerialNo', '接口校验', '重推数据', '确权业务申请'], 'coherenceScore': 0.92}, {'clusterName': '额度管理功能', 'keywords': ['链数额度', '额度管理', '组织单元额度', '云信额度', '筛选', '导出'], 'coherenceScore': 0.88}]}, 'metadata': {'userRole': ['核心企业用户', '金融服务部', '系统开发/运维'], 'targetAudience': ['核心企业业务人员', '产品经理', '研发工程师', '测试工程师']}}, 'notes': {'model': 'ep-20250724094351-pnjf4'}}, 'metadata': {'analysis_duration': 18.00348210334778}}, 'document_content': '一局对接链数优化\n\n需求文档\n\n| 版本 | V0.1 |\n| --- | --- |\n| 撰写人 | 李威明 |\n| 类型 | 系统对接 |\n| 标签 | 链数、中建一局 |\n\n中企云链（北京）金融信息服务有限公司\n\n文档控制\n\n需求方\n\n| 日期 | 需求人 | 需求部门 | 说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 徐艺 | 金融服务部 |  |\n\n版本记录\n\n| 日期 | 撰写人 | 版本 | 变更说明 |\n| --- | --- | --- | --- |\n| 2025/4/30 | 李威明 | V0.1 | 创建文档 |\n\n目录\n\n第1章 项目介绍\t4\n\n1.1 需求背景\t4\n\n1.2 建设目标及路线\t4\n\n第2章 整体说明\t4\n\n2.1 需求模型\t4\n\n2.2 功能结构图\t4\n\n2.3 信息结构图\t4\n\n2.4 项目范围\t4\n\n2.4.1 新增功能\t4\n\n2.4.2 调整功能\t4\n\n第3章 功能需求说明\t4\n\n3.1 调整说明\t4\n\n# 项目介绍\n\n## 需求背景\n\n- 一局对接链数的项目上线后，核心企业反馈，希望就已推送至平台的数据，在核心企业内部系统内修改部分信息（如额度信息）后，使用原业务编号再次推送至平台。就目前的接口校验逻辑，相同业务编号的业务数据不可重复推送。因而，需要结合核心企业需求，对接口的校验逻辑进行调整。\n\n## 建设目标及路线\n\n- 调整接口校验逻辑，兼容核心企业重推数据的场景。\n\n# 整体说明\n\n## 需求模型\n\n## 功能结构图\n\n## 信息结构图\n\n## 项目范围\n\n### 新增功能\n\n### 调整功能\n\n# 功能需求说明\n\n## 接口校验规则调整\n\n### 调整说明\n\n本期对【确权业务申请】接口中关于bizSerialNo的校验规则进行调整，调整后的校验规则为：\n\n| 序号 | 接口名称 | 隶属服务 | 校验点 | 逻辑 | 错误提示 |\n| --- | --- | --- | --- | --- | --- |\n| 1 | 确权业务申请 | zqyl-data-open | 入参校验 | bizSerialNo不可与已成功推送的非“已作废”、“已删除”状态的链数业务数据对应的bizSerialNo成功记录重复 | bizSerialNo已存在，请先登录平台进行作废/删除。 |\n\n## 链数额度功能调整\n\n### 调整说明\n\n本期，对原“链数额度”功能做如下调整：\n\n- 功能名称由“链数额度”变更为“额度管理”；\n\n- 页面右上方新增“组织单元额度”按钮，当且仅当当前登录企业为多组织企业时展示该按钮。用户点击“组织单元额度”按钮，则跳转至“组织单元额度”列表页。\n\n- 列表新增字段“额度类型”，置于“额度名称”之后，若为链数额度则取值为“链数额度”。\n\n![图片2](http://localhost:8082/uploads/temp/2ce05f14-039a-4f62-aa30-4490350b3733_img_20250806_191102_1.png)\n\n## 新增组织单元额度功能\n\n### 调整说明\n\n本期在核心企业侧链数额度功能下，新增“组织单元额度”列表页。支持用户查询当前登录企业下的具体组织单元的链数额度、云信额度明细。\n\n具体如下：\n\n- 交互说明：\n\n![图片1](http://localhost:8082/uploads/temp/2ce05f14-039a-4f62-aa30-4490350b3733_img_20250806_191102_0.png)\n\n（页面入口：用户点击“额度管理”列表页右上角的“组织单元额度”按钮，跳转至该页面。）\n\n- 返回：用户点击返回，返回至“额度管理”列表页。\n\n- 导出：点击导出，将列表中用户筛选后的数据以xls文件格式导出至本地。\n\n- 列表筛选：用户确定筛选条件后，点击查询按钮，按照用户确定的筛选条件对列表进行筛选；点击重置，列表恢复至未筛选状态。\n\n- 功能说明：\n\n- 列表需展示分配至当前登录企业下所有组织单元的链数额度和云信额度明细。页面载入时，默认展示分配至各组织单元的链数额度明细；若用户将额度类型切换为“云信额度”，则需要展示分配至各组织单元的云信额度明细；若用户将额度类型切换为“全部”，则需要展示分配至各组织单元的链数和云信额度明细。\n\n- 字段说明：\n\n- 筛选字段：\n\n| 序号 | 字段名 | 类型格式 | 长度 | 默认值 | 必填 | 规则 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 组织单元名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 2 | 额度名称 | 文本输入框 | - | - | - | 模糊搜索 |\n| 3 | 额度类型 | 下拉列表 | - | 链数额度 | - | 下拉选项：链数额度、云信额度、全部 |\n\n- 汇总字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 总额度（元） | 数值 | 满足筛选条件的列表数据的“已分配额度（元）”之和 |\n| 2 | 已用额度（元） | 数值 | 满足筛选条件的列表数据的“已用额度（元）”之和 |\n| 3 | 可用额度（元） | 数值 | 满足筛选条件的列表数据的“可用额度（元）”之和 |\n\n- 备注：筛选条件更新后，汇总值需要同步更新计算。\n\n- 列表字段：\n\n| 序号 | 字段名 | 类型格式 | 规则 |\n| --- | --- | --- | --- |\n| 1 | 组织单元名称 | 字符串 |  |\n| 2 | 额度名称 | 字符串 |  |\n| 3 | 额度类型 | 字符串 |  |\n| 4 | 已分配额度（元） | 数值 |  |\n| 5 | 已用额度（元） | 数值 |  |\n| 6 | 可用额度（元） | 数值 |  |\n\n- 备注：列表默认按照组织单元名称为主要关键字、额度类型为次要关键字降序排列。'}
2025-08-06 19:11:03 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.01s)
2025-08-06 19:11:06 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:10 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:13 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:15 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:17 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:20 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:23 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:26 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:29 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:32 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:35 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:38 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:41 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:44 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:47 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:50 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:53 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:56 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:11:59 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:12:02 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:12:05 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:12:08 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:12:11 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:12:13 - api_server - ERROR - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 19:12:13 - api_server - ERROR - ❌ 任务 2ce05f14-039a-4f62-aa30-4490350b3733 AI分析失败: object dict can't be used in 'await' expression
2025-08-06 19:12:13 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 30% - AI分析失败: object dict can't be used in 'await' expression
2025-08-06 19:12:13 - api_server - ERROR - AI分析失败: 2ce05f14-039a-4f62-aa30-4490350b3733, 当前状态: failed, 错误信息: AI分析失败: object dict can't be used in 'await' expression
2025-08-06 19:12:13 - api_server - INFO - 检测到form_data已生成，继续完成流程: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:12:13 - api_server - INFO - 任务 2ce05f14-039a-4f62-aa30-4490350b3733 进度更新: 100% - 完整分析流程完成
2025-08-06 19:12:13 - api_server - INFO - 完整分析流程成功完成: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:12:13 - api_server - INFO - 🎉 完整分析流程完成: 2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:12:14 - api_server - INFO - ✅ GET get_analysis_progress_v2 [200] (0.00s)
2025-08-06 19:12:14 - api_server - INFO - 收到设计方案表单数据获取请求: 任务ID=2ce05f14-039a-4f62-aa30-4490350b3733
2025-08-06 19:12:14 - api_server - INFO - 设计方案表单数据获取成功: 任务ID=2ce05f14-039a-4f62-aa30-4490350b3733, 表单字段数=11
2025-08-06 19:12:14 - api_server - INFO - ✅ GET get_design_form_data [200] (0.00s)
2025-08-06 19:12:14 - api_server - INFO - 🔍 数据类型诊断 - parsing_result: <class 'dict'>
2025-08-06 19:12:14 - api_server - INFO - 🔍 数据类型诊断 - content_analysis: <class 'dict'>
2025-08-06 19:12:14 - api_server - INFO - 🔍 数据类型诊断 - ai_analysis: <class 'dict'>
2025-08-06 19:12:14 - api_server - INFO - ✅ GET get_analysis_result [200] (0.00s)
