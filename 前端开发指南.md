# analyDesign 前端开发指南

## 🎯 项目架构

### 技术栈
- **前端框架**: Vue 3 + Composition API
- **UI 组件库**: Element Plus
- **状态管理**: Pinia
- **构建工具**: Vite
- **样式**: SCSS
- **实时通信**: WebSocket
- **后端**: Python + WebSocket Server

### 项目结构
```
analyDesign/
├── frontend/                    # 前端项目
│   ├── src/
│   │   ├── components/         # Vue 组件
│   │   │   └── ChatInterface.vue
│   │   ├── stores/            # Pinia 状态管理
│   │   │   └── websocket.js
│   │   ├── assets/            # 静态资源
│   │   │   └── styles/
│   │   │       └── global.scss
│   │   ├── utils/             # 工具函数
│   │   ├── App.vue            # 根组件
│   │   └── main.js            # 入口文件
│   ├── package.json           # 前端依赖
│   ├── vite.config.js         # Vite 配置
│   └── index.html             # HTML 模板
├── src/                       # 后端项目
│   ├── websocket_server.py    # WebSocket 服务器
│   ├── enhanced_analyzer.py   # 分析器
│   └── config.py              # 配置文件
├── analyDesign_env/           # Python 虚拟环境
└── requirements.txt           # Python 依赖
```

## 🚀 快速开始

### 1. 环境准备
```powershell
# 设置 Python 环境
.\setup_env.ps1

# 设置前端环境
.\setup_frontend.ps1
```

### 2. 启动应用
```powershell
# 一键启动前后端
.\start_full_app.ps1

# 或者分别启动
# 后端
.\analyDesign_env\Scripts\python.exe src\websocket_server.py

# 前端
cd frontend
npm run dev
```

### 3. 访问应用
- 前端地址: http://localhost:3000
- WebSocket 地址: ws://localhost:8765

## 🎨 界面设计

### 主要特性
1. **三栏布局**: 左侧边栏 + 主聊天区 + 右侧面板（可选）
2. **实时聊天**: WebSocket 长连接，支持实时消息推送
3. **智能分析**: 集成 AI 分析功能，显示置信度和建议
4. **响应式设计**: 适配不同屏幕尺寸
5. **现代 UI**: 基于 Element Plus，美观易用

### 界面组件
- **左侧边栏**: 任务历史、功能介绍
- **聊天区域**: 消息展示、输入框、工具栏
- **消息类型**: 用户消息、AI 回复、系统消息、错误消息
- **状态指示**: 连接状态、发送状态、处理状态

## 🔧 开发指南

### WebSocket 通信协议

#### 客户端发送消息格式
```javascript
{
  "type": "chat",           // 消息类型: chat, file_upload, ping
  "message": "用户输入的内容",
  "message_id": "unique_id",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

#### 服务端响应格式
```javascript
{
  "type": "chat_response",  // 响应类型
  "message": "AI 回复内容",
  "analysis": {             // 分析结果
    "confidence": 0.85,
    "analysis_type": "product_design",
    "suggestions": ["建议1", "建议2"]
  },
  "timestamp": "2024-01-01T00:00:00.000Z",
  "message_id": "unique_id",
  "status": "completed"
}
```

### 状态管理

#### WebSocket Store (Pinia)
```javascript
// 主要状态
const isConnected = ref(false)      // 连接状态
const messages = ref([])            // 消息列表
const connectionStatus = ref('disconnected')

// 主要方法
connect()                           // 建立连接
disconnect()                        // 断开连接
sendMessage(message)                // 发送消息
addMessage(message)                 // 添加消息
clearMessages()                     // 清空消息
```

### 组件开发

#### 消息组件结构
```vue
<template>
  <div class="message" :class="message.type">
    <!-- 用户消息 -->
    <div v-if="message.type === 'user'" class="user-message">
      <!-- 消息内容 -->
    </div>
    
    <!-- AI 回复 -->
    <div v-else-if="message.type === 'chat_response'" class="bot-message">
      <!-- AI 头像 + 消息内容 -->
    </div>
    
    <!-- 处理中状态 -->
    <div v-else-if="message.type === 'processing'" class="processing-message">
      <!-- 加载动画 + 状态文本 -->
    </div>
  </div>
</template>
```

## 🎨 样式指南

### 设计原则
1. **简洁现代**: 清爽的界面，突出内容
2. **一致性**: 统一的颜色、字体、间距
3. **可访问性**: 良好的对比度和可读性
4. **响应式**: 适配各种设备

### 颜色规范
```scss
// 主色调
$primary-color: #409eff;
$success-color: #67c23a;
$warning-color: #e6a23c;
$danger-color: #f56c6c;

// 文字颜色
$text-primary: #303133;
$text-regular: #606266;
$text-secondary: #909399;
$text-placeholder: #c0c4cc;

// 背景颜色
$bg-primary: #ffffff;
$bg-secondary: #f5f7fa;
$bg-tertiary: #fafbfc;
```

### 组件样式
```scss
// 消息气泡
.user-message {
  background: $primary-color;
  color: white;
  border-radius: 12px;
  border-bottom-right-radius: 4px;
}

.bot-message {
  background: white;
  border-radius: 12px;
  border-top-left-radius: 4px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}
```

## 🔌 API 集成

### 后端分析器集成
```python
# 在 websocket_server.py 中
from enhanced_analyzer import EnhancedAnalyzer

class WebSocketChatServer:
    def __init__(self):
        self.analyzer = EnhancedAnalyzer()
    
    async def handle_chat_message(self, websocket, user_message, message_id):
        # 调用分析器
        analysis_result = await self.analyzer.analyze_async(user_message)
        
        # 发送结果
        response = {
            "type": "chat_response",
            "message": analysis_result.get("response"),
            "analysis": analysis_result,
            "timestamp": datetime.now().isoformat(),
            "message_id": message_id
        }
        await websocket.send(json.dumps(response, ensure_ascii=False))
```

## 🚀 部署指南

### 开发环境
```powershell
# 启动开发服务器
.\start_full_app.ps1
```

### 生产环境
```powershell
# 构建前端
cd frontend
npm run build

# 启动后端
.\analyDesign_env\Scripts\python.exe src\websocket_server.py
```

## 🐛 故障排除

### 常见问题

1. **WebSocket 连接失败**
   - 检查后端服务器是否启动
   - 确认端口 8765 未被占用
   - 检查防火墙设置

2. **前端依赖安装失败**
   - 检查 Node.js 版本 (需要 16+)
   - 清除 npm 缓存: `npm cache clean --force`
   - 删除 node_modules 重新安装

3. **样式显示异常**
   - 检查 SCSS 编译是否正常
   - 确认 Element Plus 样式已正确导入

### 调试技巧
```javascript
// 在浏览器控制台查看 WebSocket 状态
console.log(wsStore.connectionStatus)
console.log(wsStore.messages)

// 手动发送测试消息
wsStore.sendMessage("测试消息")
```

## 📝 开发规范

### 代码风格
- 使用 2 空格缩进
- 组件名使用 PascalCase
- 文件名使用 kebab-case
- 变量名使用 camelCase

### Git 提交规范
```
feat: 新功能
fix: 修复 bug
docs: 文档更新
style: 样式调整
refactor: 代码重构
test: 测试相关
chore: 构建/工具相关
```

---

**当前状态**: ✅ 前端环境已配置完成，支持 Vue 3 + WebSocket 实时聊天！ 