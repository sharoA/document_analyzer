# analyDesign æ¥å£æ¢³ç†æ€»ç»“

## ğŸ“‹ ç³»ç»Ÿæ¶æ„æ¦‚è¿°

analyDesign é‡‡ç”¨**åŒæœåŠ¡å™¨æ¶æ„**ï¼Œæä¾›å®Œæ•´çš„éœ€æ±‚åˆ†æå’Œæ–‡æ¡£å¤„ç†æœåŠ¡ï¼š

- **HTTP API æœåŠ¡å™¨** (`src/apis/api_server.py`) - ç«¯å£ **8082**
- **WebSocket æœåŠ¡å™¨** (`src/websockets/websocket_server.py`) - ç«¯å£ **8081**
- **ä¸»å¯åŠ¨å™¨** (`run.py`) - æ”¯æŒå¤šç§å¯åŠ¨æ¨¡å¼

## ğŸŒ HTTP API æ¥å£ (ç«¯å£ 8082)

### 1. åŸºç¡€ä¿¡æ¯æ¥å£

#### 1.1 æœåŠ¡é¦–é¡µ
```http
GET /
```
**åŠŸèƒ½**: è·å–æœåŠ¡åŸºæœ¬ä¿¡æ¯å’Œæ‰€æœ‰å¯ç”¨ç«¯ç‚¹  
**å“åº”**: æœåŠ¡ä¿¡æ¯ã€ç‰ˆæœ¬ã€å¯ç”¨ç«¯ç‚¹åˆ—è¡¨ã€åŠŸèƒ½ç‰¹æ€§

#### 1.2 å¥åº·æ£€æŸ¥
```http
GET /api/health
```
**åŠŸèƒ½**: æ£€æŸ¥æœåŠ¡çŠ¶æ€å’Œä¾èµ–æœåŠ¡è¿æ¥çŠ¶æ€  
**å“åº”**: æœåŠ¡å¥åº·çŠ¶æ€ã€ç«å±±å¼•æ“è¿æ¥çŠ¶æ€

### 2. èŠå¤©å¯¹è¯æ¥å£

#### 2.1 èŠå¤©æ¥å£
```http
POST /api/chat
Content-Type: application/json
```
**è¯·æ±‚ä½“**:
```json
{
  "message": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹",
  "session_id": "å¯é€‰çš„ä¼šè¯ID"
}
```
**åŠŸèƒ½**: ä¸AIåŠ©æ‰‹è¿›è¡Œå¯¹è¯äº¤äº’  
**å“åº”**: AIå›å¤ã€ä¼šè¯IDã€ç½®ä¿¡åº¦ã€æ„å›¾è¯†åˆ«

### 3. ä¼šè¯ç®¡ç†æ¥å£

#### 3.1 è·å–æ‰€æœ‰ä¼šè¯
```http
GET /api/sessions
```
**åŠŸèƒ½**: è·å–æ‰€æœ‰ä¼šè¯åˆ—è¡¨å’Œæ¶ˆæ¯å†å²

#### 3.2 è·å–ç‰¹å®šä¼šè¯
```http
GET /api/sessions/{session_id}
```
**åŠŸèƒ½**: è·å–æŒ‡å®šä¼šè¯çš„è¯¦ç»†ä¿¡æ¯

#### 3.3 åˆ é™¤ä¼šè¯
```http
DELETE /api/sessions/{session_id}
```
**åŠŸèƒ½**: åˆ é™¤æŒ‡å®šä¼šè¯åŠå…¶æ¶ˆæ¯å†å²

### 4. æ–‡ä»¶å¤„ç†æ¥å£

#### 4.1 æ–‡ä»¶ä¸Šä¼ 
```http
POST /api/file/upload
```
**æ”¯æŒæ ¼å¼**:
- `application/json` - Base64ç¼–ç æ–‡ä»¶å†…å®¹
- `multipart/form-data` - ä¼ ç»Ÿæ–‡ä»¶ä¸Šä¼ 

**åŠŸèƒ½**: ä¸Šä¼ æ–‡æ¡£æ–‡ä»¶å¹¶å¼€å§‹è§£æä»»åŠ¡  
**å“åº”**: ä»»åŠ¡IDã€æ–‡ä»¶ä¿¡æ¯ã€æ–‡ä»¶è·¯å¾„

#### 4.2 è·å–è§£æçŠ¶æ€
```http
GET /api/file/parsing/{task_id}
```
**åŠŸèƒ½**: è·å–æ–‡ä»¶è§£æè¿›åº¦å’ŒçŠ¶æ€  
**å“åº”**: è§£æçŠ¶æ€ã€è¿›åº¦ã€æ­¥éª¤è¯¦æƒ…ã€è§£æç»“æœ

#### 4.3 å†…å®¹åˆ†æ
```http
POST /api/file/analyze/{task_id}
```
**åŠŸèƒ½**: å¯¹å·²è§£ææ–‡æ¡£è¿›è¡Œå†…å®¹åˆ†æ  
**å‰ç½®æ¡ä»¶**: æ–‡æ¡£è§£æå®Œæˆ  
**å“åº”**: åˆ†æä»»åŠ¡å¯åŠ¨ç¡®è®¤

#### 4.4 AIæ™ºèƒ½åˆ†æ
```http
POST /api/file/ai-analyze/{task_id}
```
**è¯·æ±‚ä½“**:
```json
{
  "analysis_type": "comprehensive|summary|requirements|custom",
  "custom_prompt": "è‡ªå®šä¹‰åˆ†ææç¤ºï¼ˆå¯é€‰ï¼‰"
}
```
**åŠŸèƒ½**: å¯¹å†…å®¹åˆ†æç»“æœè¿›è¡ŒAIæ™ºèƒ½åˆ†æ  
**å‰ç½®æ¡ä»¶**: å†…å®¹åˆ†æå®Œæˆ  
**å“åº”**: AIåˆ†æä»»åŠ¡å¯åŠ¨ç¡®è®¤

#### 4.5 è·å–å®Œæ•´åˆ†æç»“æœ
```http
GET /api/file/result/{task_id}
```
**åŠŸèƒ½**: è·å–ä¸‰ä¸ªæ¥å£çš„æ•´åˆåˆ†æç»“æœ  
**å“åº”**: 
- æ–‡æ¡£è§£æç»“æœ
- å†…å®¹åˆ†æç»“æœ  
- AIåˆ†æç»“æœ
- æ•´ä½“çŠ¶æ€å’Œè¿›åº¦

#### 4.6 è·å–æ–‡ä»¶åˆ—è¡¨
```http
GET /api/file/list
```
**åŠŸèƒ½**: è·å–æ‰€æœ‰å·²ä¸Šä¼ æ–‡ä»¶çš„åˆ—è¡¨å’ŒçŠ¶æ€

#### 4.7 åˆ é™¤æ–‡ä»¶
```http
DELETE /api/file/delete/{task_id}
```
**åŠŸèƒ½**: åˆ é™¤å·²ä¸Šä¼ æ–‡ä»¶åŠå…¶åˆ†æç»“æœ

### 5. é”™è¯¯å¤„ç†

#### 5.1 404 é”™è¯¯
**å“åº”**: æ¥å£ä¸å­˜åœ¨æç¤º

#### 5.2 500 é”™è¯¯
**å“åº”**: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯æç¤º

## ğŸ”Œ WebSocket å®æ—¶é€šä¿¡æ¥å£ (ç«¯å£ 8081)

### 1. è¿æ¥ç®¡ç†äº‹ä»¶

#### 1.1 è¿æ¥å»ºç«‹
**äº‹ä»¶**: `connect`  
**æœåŠ¡å™¨å“åº”**: `connected`
```json
{
  "status": "success",
  "client_id": "client_sid",
  "message": "è¿æ¥æˆåŠŸ",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

#### 1.2 æ–­å¼€è¿æ¥
**äº‹ä»¶**: `disconnect`  
**åŠŸèƒ½**: å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶è§¦å‘ï¼ŒæœåŠ¡å™¨æ¸…ç†è¿æ¥ä¿¡æ¯

#### 1.3 å¿ƒè·³æ£€æµ‹
**å®¢æˆ·ç«¯å‘é€**: `ping`  
**æœåŠ¡å™¨å“åº”**: `pong`
```json
{
  "timestamp": "2025-01-15T10:30:00Z",
  "client_id": "client_sid"
}
```

### 2. èŠå¤©é€šä¿¡äº‹ä»¶

#### 2.1 å‘é€èŠå¤©æ¶ˆæ¯
**å®¢æˆ·ç«¯å‘é€**: `chat`
```json
{
  "message": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹",
  "session_id": "å¯é€‰çš„ä¼šè¯ID"
}
```

**æœåŠ¡å™¨å“åº”**: `chat_processing`
```json
{
  "session_id": "session_id",
  "message": "æ­£åœ¨å¤„ç†æ‚¨çš„æ¶ˆæ¯...",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

**æœåŠ¡å™¨å“åº”**: `chat_response`
```json
{
  "success": true,
  "response": "AIåŠ©æ‰‹çš„å›å¤å†…å®¹",
  "session_id": "session_id",
  "timestamp": "2025-01-15T10:30:05Z",
  "confidence": 0.9,
  "intent": "éœ€æ±‚åˆ†æ",
  "model": "doubao-pro-4k"
}
```

### 3. æ–‡ä»¶å¤„ç†äº‹ä»¶

#### 3.1 æ–‡ä»¶ä¸Šä¼ è¿›åº¦
**å®¢æˆ·ç«¯å‘é€**: `file_upload_progress`
```json
{
  "task_id": "uuid",
  "progress": 50,
  "status": "uploading"
}
```

**æœåŠ¡å™¨å¹¿æ’­**: `file_progress_update`
```json
{
  "task_id": "uuid",
  "progress": 50,
  "status": "uploading",
  "timestamp": "2025-01-15T10:30:03Z"
}
```

### 4. çŠ¶æ€æŸ¥è¯¢äº‹ä»¶

#### 4.1 è·å–æœåŠ¡å™¨çŠ¶æ€
**å®¢æˆ·ç«¯å‘é€**: `get_status`  
**æœåŠ¡å™¨å“åº”**: `status_response`
```json
{
  "server_status": "running",
  "connected_clients": 5,
  "volcano_engine_status": "connected",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

### 5. é”™è¯¯å¤„ç†äº‹ä»¶

#### 5.1 é”™è¯¯é€šçŸ¥
**æœåŠ¡å™¨å‘é€**: `error`
```json
{
  "error": "é”™è¯¯æè¿°ä¿¡æ¯",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

## ğŸš€ å¯åŠ¨é…ç½®

### 1. ä¸»å¯åŠ¨å™¨ (run.py)

#### 1.1 å¯åŠ¨æ¨¡å¼
```bash
python run.py --mode=full     # å®Œæ•´æœåŠ¡ (API + WebSocket)
python run.py --mode=api      # ä»…APIæœåŠ¡å™¨
python run.py --mode=websocket # ä»…WebSocketæœåŠ¡å™¨
```

#### 1.2 æœåŠ¡åœ°å€
- **APIæœåŠ¡å™¨**: `http://localhost:8082`
- **WebSocketæœåŠ¡å™¨**: `ws://localhost:8081/socket.io/`

### 2. æ‰¹å¤„ç†å¯åŠ¨ (start_back.bat)

#### 2.1 å¯åŠ¨é€‰é¡¹
1. å®Œæ•´æœåŠ¡ (API + WebSocket) - æ¨è
2. ä»…APIæœåŠ¡å™¨ (ç«¯å£8082)
3. ä»…WebSocketæœåŠ¡å™¨ (ç«¯å£8081)

## ğŸ“Š æ¥å£çŠ¶æ€ç 

### HTTP çŠ¶æ€ç 
- `200 OK`: è¯·æ±‚æˆåŠŸ
- `400 Bad Request`: è¯·æ±‚å‚æ•°é”™è¯¯
- `404 Not Found`: æ¥å£ä¸å­˜åœ¨
- `500 Internal Server Error`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### ä¸šåŠ¡çŠ¶æ€ç 
- `success: true`: ä¸šåŠ¡æ“ä½œæˆåŠŸ
- `success: false`: ä¸šåŠ¡æ“ä½œå¤±è´¥

## ğŸ”„ æ•°æ®æµç¨‹

### æ–‡ä»¶åˆ†ææµç¨‹
1. **æ–‡ä»¶ä¸Šä¼ ** â†’ `POST /api/file/upload`
2. **æ–‡æ¡£è§£æ** â†’ `GET /api/file/parsing/{task_id}`
3. **å†…å®¹åˆ†æ** â†’ `POST /api/file/analyze/{task_id}`
4. **AIåˆ†æ** â†’ `POST /api/file/ai-analyze/{task_id}`
5. **è·å–ç»“æœ** â†’ `GET /api/file/result/{task_id}`

### å®æ—¶é€šä¿¡æµç¨‹
1. **å»ºç«‹è¿æ¥** â†’ `connect` äº‹ä»¶
2. **å¿ƒè·³æ£€æµ‹** â†’ `ping/pong` äº‹ä»¶
3. **æ¶ˆæ¯äº¤äº’** â†’ `chat` äº‹ä»¶
4. **çŠ¶æ€æ›´æ–°** â†’ `file_upload_progress` äº‹ä»¶
5. **æ–­å¼€è¿æ¥** â†’ `disconnect` äº‹ä»¶

## ğŸ› ï¸ æŠ€æœ¯ç‰¹æ€§

### APIæœåŠ¡å™¨ç‰¹æ€§
- âœ… RESTful APIè®¾è®¡
- âœ… CORSè·¨åŸŸæ”¯æŒ
- âœ… æ–‡ä»¶ä¸Šä¼ å¤„ç†
- âœ… å¼‚æ­¥ä»»åŠ¡å¤„ç†
- âœ… ç«å±±å¼•æ“AIé›†æˆ
- âœ… ä¼šè¯ç®¡ç†
- âœ… é”™è¯¯å¤„ç†

### WebSocketæœåŠ¡å™¨ç‰¹æ€§
- âœ… å®æ—¶åŒå‘é€šä¿¡
- âœ… è¿æ¥çŠ¶æ€ç®¡ç†
- âœ… å¿ƒè·³æ£€æµ‹
- âœ… æ–‡ä»¶ä¸Šä¼ è¿›åº¦è·Ÿè¸ª
- âœ… é”™è¯¯å¤„ç†
- âœ… å¤šå®¢æˆ·ç«¯æ”¯æŒ

### å‰ç«¯é›†æˆç‰¹æ€§
- âœ… Vue 3 + PiniaçŠ¶æ€ç®¡ç†
- âœ… WebSocketè‡ªåŠ¨é‡è¿
- âœ… æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ 
- âœ… å®æ—¶è¿›åº¦æ˜¾ç¤º
- âœ… MarkdownæŠ¥å‘Šç”Ÿæˆ
- âœ… å“åº”å¼ç•Œé¢è®¾è®¡

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€èŠå¤©
```javascript
// HTTP APIæ–¹å¼
const response = await fetch('http://localhost:8082/api/chat', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    message: 'è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªéœ€æ±‚æ–‡æ¡£',
    session_id: 'session_123'
  })
});

// WebSocketæ–¹å¼
socket.emit('chat', {
  message: 'è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªéœ€æ±‚æ–‡æ¡£',
  session_id: 'session_123'
});
```

### 2. æ–‡ä»¶ä¸Šä¼ åˆ†æ
```javascript
// 1. ä¸Šä¼ æ–‡ä»¶
const uploadResponse = await fetch('http://localhost:8082/api/file/upload', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    file_info: {
      name: 'requirements.docx',
      content: base64Content,
      type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
      size: fileSize
    }
  })
});

const { task_id } = uploadResponse.json();

// 2. æ£€æŸ¥è§£æçŠ¶æ€
const parsingStatus = await fetch(`http://localhost:8082/api/file/parsing/${task_id}`);

// 3. å¯åŠ¨å†…å®¹åˆ†æ
await fetch(`http://localhost:8082/api/file/analyze/${task_id}`, { method: 'POST' });

// 4. å¯åŠ¨AIåˆ†æ
await fetch(`http://localhost:8082/api/file/ai-analyze/${task_id}`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ analysis_type: 'comprehensive' })
});

// 5. è·å–å®Œæ•´ç»“æœ
const result = await fetch(`http://localhost:8082/api/file/result/${task_id}`);
```

## ğŸ”§ é…ç½®è¦æ±‚

### ç¯å¢ƒä¾èµ–
- Python 3.8+
- Flask + Flask-SocketIO
- ç«å±±å¼•æ“APIå¯†é’¥
- Node.js 16+ (å‰ç«¯)

### é…ç½®æ–‡ä»¶
- `config.yaml` - ä¸»é…ç½®æ–‡ä»¶
- `src/resource/config.py` - é…ç½®ç®¡ç†æ¨¡å—

### å¿…è¦ç›®å½•
- `uploads/` - æ–‡ä»¶ä¸Šä¼ ç›®å½•
- `logs/` - æ—¥å¿—ç›®å½•
- `outputs/` - è¾“å‡ºç›®å½•
- `templates/` - æ¨¡æ¿ç›®å½•

---

**æ€»è®¡æ¥å£æ•°é‡**: 
- HTTP APIæ¥å£: **13ä¸ª**
- WebSocketäº‹ä»¶: **8ä¸ª**
- å¯åŠ¨æ¨¡å¼: **3ç§**

**æœåŠ¡ç«¯å£**:
- APIæœåŠ¡å™¨: **8082**
- WebSocketæœåŠ¡å™¨: **8081** 