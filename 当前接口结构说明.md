# analyDesign å½“å‰æ¥å£ç»“æ„è¯´æ˜

## ğŸ“‹ ç³»ç»Ÿæ¶æ„æ¦‚è¿°

analyDesign é‡‡ç”¨**åŒæœåŠ¡å™¨æ¶æ„**ï¼š
- **HTTP API æœåŠ¡å™¨** (`api_server.py`) - ç«¯å£ 8082
- **WebSocket æœåŠ¡å™¨** (`websocket_server.py`) - ç«¯å£ 8081

æ”¯æŒ **RESTful API** å’Œ **WebSocket å®æ—¶é€šä¿¡** ä¸¤ç§äº¤äº’æ–¹å¼ã€‚

## ğŸŒ HTTP API æ¥å£ (ç«¯å£ 8080)

### åŸºç¡€ä¿¡æ¯æ¥å£

#### 1. æœåŠ¡é¦–é¡µ
```http
GET /
```
**åŠŸèƒ½**: è·å–æœåŠ¡åŸºæœ¬ä¿¡æ¯å’Œæ‰€æœ‰å¯ç”¨ç«¯ç‚¹
**å“åº”**:
```json
{
  "service": "analyDesign API Server",
  "version": "2.0.0",
  "status": "running",
  "timestamp": "2025-01-15T10:30:00Z",
  "endpoints": {
    "chat": "/api/chat",
    "health": "/api/health",
    "sessions": "/api/sessions",
    "file_upload": "/api/file/upload",
    "file_list": "/api/file/list",
    "file_delete": "/api/file/delete/<task_id>",
    "parsing_status": "/api/file/parsing/<task_id>",
    "content_analysis": "/api/file/analyze/<task_id>",
    "ai_analysis": "/api/file/ai-analyze/<task_id>",
    "analysis_result": "/api/file/result/<task_id>"
  },
  "features": [
    "HTTP RESTful API",
    "ç«å±±å¼•æ“ AI é›†æˆ",
    "æ–‡ä»¶ä¸Šä¼ å’Œè§£æ",
    "å†…å®¹åˆ†æ",
    "æ™ºèƒ½AIåˆ†æ",
    "ä¼šè¯ç®¡ç†",
    "CORS è·¨åŸŸæ”¯æŒ"
  ]
}
```

#### 2. å¥åº·æ£€æŸ¥
```http
GET /api/health
```
**åŠŸèƒ½**: æ£€æŸ¥æœåŠ¡çŠ¶æ€å’Œä¾èµ–æœåŠ¡è¿æ¥çŠ¶æ€
**å“åº”**:
```json
{
  "status": "healthy",
  "timestamp": "2025-01-15T10:30:00Z",
  "services": {
    "api_server": "running",
    "volcano_engine": "connected"
  }
}
```

### èŠå¤©å¯¹è¯æ¥å£

#### 3. èŠå¤©æ¥å£
```http
POST /api/chat
Content-Type: application/json
```
**è¯·æ±‚ä½“**:
```json
{
  "message": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹",
  "session_id": "å¯é€‰çš„ä¼šè¯ID"
}
```
**å“åº”**:
```json
{
  "success": true,
  "response": "AIåŠ©æ‰‹çš„å›å¤å†…å®¹",
  "session_id": "ä¼šè¯ID",
  "timestamp": "2025-01-15T10:30:00Z",
  "confidence": 0.9,
  "intent": "éœ€æ±‚åˆ†æ",
  "model": "ep-20250528194304-wbvcf"
}
```

### ä¼šè¯ç®¡ç†æ¥å£

#### 4. è·å–æ‰€æœ‰ä¼šè¯
```http
GET /api/sessions
```
**å“åº”**:
```json
{
  "success": true,
  "sessions": {
    "session_id_1": {
      "created_at": "2025-01-15T10:00:00Z",
      "messages": [
        {
          "role": "user",
          "content": "ç”¨æˆ·æ¶ˆæ¯",
          "timestamp": "2025-01-15T10:00:00Z"
        },
        {
          "role": "assistant", 
          "content": "AIå›å¤",
          "timestamp": "2025-01-15T10:00:05Z"
        }
      ]
    }
  },
  "count": 1,
  "timestamp": "2025-01-15T10:30:00Z"
}
```

#### 5. è·å–ç‰¹å®šä¼šè¯
```http
GET /api/sessions/{session_id}
```
**å“åº”**:
```json
{
  "success": true,
  "session": {
    "created_at": "2025-01-15T10:00:00Z",
    "messages": [...]
  },
  "session_id": "session_id",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

#### 6. åˆ é™¤ä¼šè¯
```http
DELETE /api/sessions/{session_id}
```
**å“åº”**:
```json
{
  "success": true,
  "message": "ä¼šè¯å·²åˆ é™¤",
  "session_id": "session_id",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

### æ–‡ä»¶å¤„ç†æ¥å£

#### 7. æ–‡ä»¶ä¸Šä¼ 
```http
POST /api/file/upload
Content-Type: application/json
```
**è¯·æ±‚ä½“** (JSONæ ¼å¼):
```json
{
  "file_info": {
    "name": "document.docx",
    "type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
    "size": 1024000,
    "content": "base64ç¼–ç çš„æ–‡ä»¶å†…å®¹"
  }
}
```
**æˆ–è€…** (multipart/form-dataæ ¼å¼):
```http
POST /api/file/upload
Content-Type: multipart/form-data

file: [æ–‡ä»¶äºŒè¿›åˆ¶æ•°æ®]
```
**å“åº”**:
```json
{
  "success": true,
  "task_id": "uuid",
  "file_info": {
    "name": "document.docx",
    "type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
    "size": 1024000
  },
  "file_path": "uploads/uuid_document.docx",
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œå¼€å§‹è§£æ",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

#### 8. è·å–è§£æçŠ¶æ€
```http
GET /api/file/parsing/{task_id}
```
**å“åº”**:
```json
{
  "success": true,
  "task_id": "uuid",
  "status": "completed",
  "progress": 100,
  "current_step": "è§£æå®Œæˆ",
  "steps": [
    {
      "step": "å¼€å§‹è§£ææ–‡ä»¶",
      "progress": 10,
      "timestamp": "2025-01-15T10:30:01Z",
      "status": "processing"
    }
  ],
  "result": {
    "type": "word",
    "text_content": "æ–‡æ¡£å†…å®¹...",
    "file_name": "document.docx",
    "parsing_duration": 2.5
  }
}
```

#### 9. å†…å®¹åˆ†æ
```http
POST /api/file/analyze/{task_id}
```
**å“åº”**:
```json
{
  "success": true,
  "task_id": "uuid",
  "message": "å†…å®¹åˆ†æå·²å¼€å§‹",
  "timestamp": "2025-01-15T10:30:05Z"
}
```

#### 10. AIæ™ºèƒ½åˆ†æ
```http
POST /api/file/ai-analyze/{task_id}
Content-Type: application/json
```
**è¯·æ±‚ä½“**:
```json
{
  "analysis_type": "comprehensive",
  "custom_prompt": "è¯·é‡ç‚¹åˆ†æéœ€æ±‚çš„å®Œæ•´æ€§"
}
```
**åˆ†æç±»å‹**:
- `comprehensive`: å…¨é¢åˆ†æ
- `summary`: æ‘˜è¦åˆ†æ  
- `requirements`: éœ€æ±‚åˆ†æ
- `custom`: è‡ªå®šä¹‰åˆ†æ

**å“åº”**:
```json
{
  "success": true,
  "task_id": "uuid",
  "message": "AIæ™ºèƒ½åˆ†æå·²å¼€å§‹",
  "analysis_type": "comprehensive",
  "timestamp": "2025-01-15T10:30:10Z"
}
```

#### 11. è·å–å®Œæ•´åˆ†æç»“æœ
```http
GET /api/file/result/{task_id}
```
**å“åº”**:
```json
{
  "success": true,
  "task_id": "uuid",
  "status": "fully_completed",
  "file_info": {
    "name": "document.docx",
    "type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
    "size": 1024000
  },
  "parsing_result": {
    "type": "word",
    "text_content": "æ–‡æ¡£å†…å®¹...",
    "paragraph_count": 25,
    "table_count": 3
  },
  "content_analysis": {
    "document_type": "requirements",
    "language": "chinese",
    "summary": "æ–‡æ¡£æ‘˜è¦...",
    "keyword_extraction": [["éœ€æ±‚", 15], ["åŠŸèƒ½", 12]],
    "structure_analysis": {
      "total_lines": 150,
      "headings": 8
    }
  },
  "ai_analysis": {
    "analysis_type": "comprehensive",
    "ai_response": "AIåˆ†æç»“æœ...",
    "confidence_score": 0.85,
    "analysis_model": "doubao-pro-4k"
  },
  "total_duration": 15.2
}
```

#### 12. è·å–æ–‡ä»¶åˆ—è¡¨
```http
GET /api/file/list
```
**å“åº”**:
```json
{
  "success": true,
  "files": [
    {
      "task_id": "uuid",
      "file_info": {
        "name": "document.docx",
        "type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
        "size": 1024000
      },
      "status": "fully_completed",
      "progress": 100,
      "created_at": "2025-01-15T10:30:00Z",
      "updated_at": "2025-01-15T10:30:15Z"
    }
  ],
  "count": 1,
  "timestamp": "2025-01-15T10:30:00Z"
}
```

#### 13. åˆ é™¤æ–‡ä»¶
```http
DELETE /api/file/delete/{task_id}
```
**å“åº”**:
```json
{
  "success": true,
  "message": "æ–‡ä»¶å·²åˆ é™¤",
  "task_id": "uuid",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

## ğŸ”Œ WebSocket å®æ—¶é€šä¿¡æ¥å£ (ç«¯å£ 5000)

### è¿æ¥ç®¡ç†äº‹ä»¶

#### 1. è¿æ¥å»ºç«‹
**äº‹ä»¶**: `connect`
**æœåŠ¡å™¨å“åº”**:
```json
{
  "status": "success",
  "client_id": "client_sid",
  "message": "è¿æ¥æˆåŠŸ",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

#### 2. æ–­å¼€è¿æ¥
**äº‹ä»¶**: `disconnect`
**è¯´æ˜**: å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶è§¦å‘ï¼ŒæœåŠ¡å™¨æ¸…ç†è¿æ¥ä¿¡æ¯

#### 3. å¿ƒè·³æ£€æµ‹
**å®¢æˆ·ç«¯å‘é€**: `ping`
```json
{
  "timestamp": "2025-01-15T10:30:00Z"
}
```
**æœåŠ¡å™¨å“åº”**: `pong`
```json
{
  "timestamp": "2025-01-15T10:30:00Z",
  "client_id": "client_sid"
}
```

### èŠå¤©é€šä¿¡äº‹ä»¶

#### 4. å‘é€èŠå¤©æ¶ˆæ¯
**å®¢æˆ·ç«¯å‘é€**: `chat`
```json
{
  "message": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹",
  "session_id": "å¯é€‰çš„ä¼šè¯ID"
}
```

**æœåŠ¡å™¨å“åº”**: `chat_processing`
```json
{
  "session_id": "session_id",
  "message": "æ­£åœ¨å¤„ç†æ‚¨çš„æ¶ˆæ¯...",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

**æœåŠ¡å™¨å“åº”**: `chat_response`
```json
{
  "success": true,
  "response": "AIåŠ©æ‰‹çš„å›å¤å†…å®¹",
  "session_id": "session_id",
  "timestamp": "2025-01-15T10:30:05Z",
  "confidence": 0.9,
  "intent": "éœ€æ±‚åˆ†æ",
  "model": "ep-20250528194304-wbvcf"
}
```

### æ–‡ä»¶å¤„ç†äº‹ä»¶

#### 5. æ–‡ä»¶ä¸Šä¼ è¿›åº¦
**å®¢æˆ·ç«¯å‘é€**: `file_upload_progress`
```json
{
  "task_id": "uuid",
  "progress": 50,
  "status": "uploading"
}
```

**æœåŠ¡å™¨å¹¿æ’­**: `file_parsing_progress`
```json
{
  "type": "file_parsing_progress",
  "task_id": "uuid",
  "status": "processing",
  "progress": 50,
  "current_step": "è§£æWordæ–‡æ¡£",
  "file_name": "document.docx",
  "timestamp": "2025-01-15T10:30:03Z"
}
```

#### 6. è·å–çŠ¶æ€
**å®¢æˆ·ç«¯å‘é€**: `get_status`
**æœåŠ¡å™¨å“åº”**: `status_update`
```json
{
  "connected_clients": 5,
  "server_status": "running",
  "volcano_engine_status": "connected",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

### é”™è¯¯å¤„ç†äº‹ä»¶

#### 7. é”™è¯¯é€šçŸ¥
**æœåŠ¡å™¨å‘é€**: `error`
```json
{
  "error": "é”™è¯¯æè¿°ä¿¡æ¯",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

## ğŸ“Š çŠ¶æ€ç å’Œé”™è¯¯å¤„ç†

### HTTP çŠ¶æ€ç 
- `200 OK`: è¯·æ±‚æˆåŠŸ
- `400 Bad Request`: è¯·æ±‚å‚æ•°é”™è¯¯
- `404 Not Found`: èµ„æºä¸å­˜åœ¨
- `409 Conflict`: èµ„æºå†²çªï¼ˆå¦‚é‡å¤ä¸Šä¼ ï¼‰
- `500 Internal Server Error`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### é”™è¯¯å“åº”æ ¼å¼
```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°ä¿¡æ¯",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### CORS è·¨åŸŸæ”¯æŒ
- å…è®¸æ¥æº: `http://localhost:3000`, `http://127.0.0.1:3000`
- æ”¯æŒæ–¹æ³•: `GET`, `POST`, `PUT`, `DELETE`, `OPTIONS`
- æ”¯æŒå¤´éƒ¨: `Content-Type`, `Authorization`
- æ”¯æŒå‡­è¯: `true`

### æ–‡ä»¶ä¸Šä¼ é™åˆ¶
- æœ€å¤§æ–‡ä»¶å¤§å°: **21MB**
- æ”¯æŒæ ¼å¼: `.doc`, `.docx`, `.pdf`, `.txt`, `.md`
- ç¼–ç æ–¹å¼: `base64` (JSON) æˆ– `multipart/form-data`

### ç«å±±å¼•æ“é›†æˆ
- æ¨¡å‹: `ep-20250528194304-wbvcf` (doubao-pro-4k)
- é»˜è®¤æ¸©åº¦: `0.7`
- æœ€å¤§Token: `2000`
- æ”¯æŒæµå¼å’Œéæµå¼å“åº”

### æ—¥å¿—è®°å½•
- æŒ‰å¤©è½®è½¬æ—¥å¿—æ–‡ä»¶
- åŒæ ¼å¼è®°å½• (æ–‡æœ¬ + JSON)
- å®Œæ•´çš„è¯·æ±‚-å“åº”ç”Ÿå‘½å‘¨æœŸè®°å½•
- è¯¦ç»†çš„é”™è¯¯å’Œæ€§èƒ½ç»Ÿè®¡

## ğŸš€ å¯åŠ¨æ–¹å¼

### HTTP API æœåŠ¡å™¨
```bash
python -m src.api_server
# æˆ–
python run.py
```
**è®¿é—®åœ°å€**: http://localhost:8080

### WebSocket æœåŠ¡å™¨
```bash
python -m src.websocket_server
```
**è®¿é—®åœ°å€**: http://localhost:5000

### é›†æˆå¯åŠ¨
```bash
python start_integrated_server.py
```
**åŒæ—¶å¯åŠ¨ä¸¤ä¸ªæœåŠ¡å™¨**

---

**æ€»ç»“**: analyDesign æä¾›äº†å®Œæ•´çš„ RESTful API å’Œ WebSocket å®æ—¶é€šä¿¡æ¥å£ï¼Œæ”¯æŒèŠå¤©å¯¹è¯ã€æ–‡ä»¶å¤„ç†ã€ä¼šè¯ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå…·å¤‡è‰¯å¥½çš„é”™è¯¯å¤„ç†ã€è·¨åŸŸæ”¯æŒå’Œæ—¥å¿—è®°å½•èƒ½åŠ›ã€‚ 