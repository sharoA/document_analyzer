# analyDesign 接口快速参考表

## 🌐 HTTP API 接口 (端口 8082)

| 序号 | 方法 | 路径 | 功能 | 状态 |
|------|------|------|------|------|
| 1 | GET | `/` | 服务首页信息 | ✅ |
| 2 | GET | `/api/health` | 健康检查 | ✅ |
| 3 | POST | `/api/chat` | 聊天对话 | ✅ |
| 4 | GET | `/api/sessions` | 获取所有会话 | ✅ |
| 5 | GET | `/api/sessions/{session_id}` | 获取特定会话 | ✅ |
| 6 | DELETE | `/api/sessions/{session_id}` | 删除会话 | ✅ |
| 7 | POST | `/api/file/upload` | 文件上传 | ✅ |
| 8 | GET | `/api/file/parsing/{task_id}` | 获取解析状态 | ✅ |
| 9 | POST | `/api/file/analyze/{task_id}` | 内容分析 | ✅ |
| 10 | POST | `/api/file/ai-analyze/{task_id}` | AI智能分析 | ✅ |
| 11 | GET | `/api/file/result/{task_id}` | 获取完整结果 | ✅ |
| 12 | GET | `/api/file/list` | 获取文件列表 | ✅ |
| 13 | DELETE | `/api/file/delete/{task_id}` | 删除文件 | ✅ |

## 🔌 WebSocket 事件 (端口 8081)

| 序号 | 事件类型 | 事件名 | 方向 | 功能 | 状态 |
|------|----------|--------|------|------|------|
| 1 | 连接 | `connect` | 客户端→服务器 | 建立连接 | ✅ |
| 2 | 响应 | `connected` | 服务器→客户端 | 连接成功确认 | ✅ |
| 3 | 断开 | `disconnect` | 客户端→服务器 | 断开连接 | ✅ |
| 4 | 心跳 | `ping` | 客户端→服务器 | 心跳检测 | ✅ |
| 5 | 心跳 | `pong` | 服务器→客户端 | 心跳响应 | ✅ |
| 6 | 聊天 | `chat` | 客户端→服务器 | 发送消息 | ✅ |
| 7 | 处理 | `chat_processing` | 服务器→客户端 | 处理中状态 | ✅ |
| 8 | 响应 | `chat_response` | 服务器→客户端 | AI回复 | ✅ |
| 9 | 进度 | `file_upload_progress` | 客户端→服务器 | 上传进度 | ✅ |
| 10 | 更新 | `file_progress_update` | 服务器→客户端 | 进度更新 | ✅ |
| 11 | 查询 | `get_status` | 客户端→服务器 | 获取状态 | ✅ |
| 12 | 状态 | `status_response` | 服务器→客户端 | 状态响应 | ✅ |
| 13 | 错误 | `error` | 服务器→客户端 | 错误通知 | ✅ |

## 🚀 启动命令

| 启动方式 | 命令 | 端口 | 说明 |
|----------|------|------|------|
| 完整服务 | `python run.py --mode=full` | 8081+8082 | 推荐 |
| 仅API | `python run.py --mode=api` | 8082 | HTTP接口 |
| 仅WebSocket | `python run.py --mode=websocket` | 8081 | 实时通信 |
| 批处理启动 | `start_back.bat` | 8081+8082 | Windows |

## 📊 数据流程图

```
文件分析流程:
上传文件 → 文档解析 → 内容分析 → AI分析 → 获取结果
   ↓         ↓         ↓         ↓         ↓
POST      GET       POST      POST      GET
/upload   /parsing  /analyze  /ai-analyze /result

实时通信流程:
连接建立 → 心跳检测 → 消息交互 → 状态更新 → 断开连接
   ↓         ↓         ↓         ↓         ↓
connect   ping/pong   chat    progress  disconnect
```

## 🔧 快速测试

### 测试API服务器
```bash
# 健康检查
curl http://localhost:8082/api/health

# 聊天测试
curl -X POST http://localhost:8082/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"你好"}'
```

### 测试WebSocket
```javascript
// 浏览器控制台测试
const socket = io('http://localhost:8081');
socket.on('connected', (data) => console.log('连接成功:', data));
socket.emit('chat', {message: '你好', session_id: 'test'});
```

## 📝 常用状态码

| HTTP状态码 | 含义 | 业务状态 | 含义 |
|------------|------|----------|------|
| 200 | 成功 | success: true | 操作成功 |
| 400 | 请求错误 | success: false | 操作失败 |
| 404 | 不存在 | status: "completed" | 任务完成 |
| 500 | 服务器错误 | status: "failed" | 任务失败 |

## 🎯 核心功能

| 功能模块 | 相关接口 | 说明 |
|----------|----------|------|
| 聊天对话 | `/api/chat`, `chat事件` | AI智能对话 |
| 文件处理 | `/api/file/*` | 文档上传分析 |
| 会话管理 | `/api/sessions/*` | 对话历史 |
| 实时通信 | WebSocket事件 | 双向通信 |
| 状态监控 | `/api/health`, `get_status` | 服务监控 |

---

**总计**: HTTP接口 **13个** + WebSocket事件 **13个** = **26个接口/事件** 