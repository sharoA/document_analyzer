# ğŸš€ ç¼–ç æ™ºèƒ½ä½“é¡¹ç›®é…ç½®æ–‡ä»¶
# ç”¨äºJinja2æ¨¡ç‰ˆæ¸²æŸ“çš„å˜é‡é…ç½®

# ğŸ¯ é¡¹ç›®åŸºæœ¬ä¿¡æ¯
name: "LangGraph"
agent_name: "ç¼–ç æ™ºèƒ½ä½“"
base_framework: "æ ¸å¿ƒåŠŸèƒ½ç”Ÿæˆ.md"
version: "1.0.0"
description: "åŸºäºLangGraphçš„å¤šæœåŠ¡åè°ƒç¼–ç æ™ºèƒ½ä½“"

# ğŸ—ï¸ æ¶æ„é…ç½®
service_type: "å¾®æœåŠ¡"
tech_stack: "Spring Boot"
programming_language: "Java"
api_style: "RESTful"
architect_type: "ç³»ç»Ÿæ¶æ„å¸ˆ"

# ğŸ“ é¡¹ç›®ç»“æ„
src_path: "src/corder_integration"
integration_module: "corder_integration"
workspace_path: "./workspace"
prompts_module: "prompts"

# ğŸ¨ ç±»åé…ç½®
state_class_name: "CodingAgentState"
orchestrator_class_name: "LangGraphWorkflowOrchestrator"

# ğŸ”§ Gité…ç½®
branch_prefix: "feature"
thread_id_prefix: "coding_session"

# ğŸ§  å¤§æ¨¡å‹é…ç½®
llm_client_import: "openai"
llm_client_class: "AsyncOpenAI"
llm_client_config: ""
llm_method: "chat.completions"
llm_model: "gpt-4"

# ğŸŒ¡ï¸ æ¸©åº¦é…ç½®
temperature:
  analysis: 0.3
  identification: 0.2
  generation: 0.2
  git_extraction: 0.1

# ğŸ—„ï¸ æ•°æ®åº“é…ç½®
database:
  type: "postgresql"  # postgresql | mysql | memory
  connection_string: "postgresql://user:pass@localhost/coding_agent_db"

# ğŸ”§ å·¥å…·é…ç½®
quality_tools: "SonarQube"
testing_framework: "JUnit"

# ğŸ“‹ å·¥ä½œæµèŠ‚ç‚¹é…ç½®
workflow_nodes:
  - name: "task_splitting"
    function_name: "task_splitting_node"
    description: "ä»»åŠ¡æ‹†åˆ†èŠ‚ç‚¹"
  - name: "git_management"
    function_name: "git_management_node"
    description: "Gitç®¡ç†èŠ‚ç‚¹"
  - name: "intelligent_coding"
    function_name: "intelligent_coding_node"
    description: "æ™ºèƒ½ç¼–ç èŠ‚ç‚¹"
  - name: "code_review"
    function_name: "code_review_node"
    description: "ä»£ç å®¡æŸ¥èŠ‚ç‚¹"
  - name: "unit_testing"
    function_name: "unit_testing_node"
    description: "å•å…ƒæµ‹è¯•èŠ‚ç‚¹"
  - name: "git_commit"
    function_name: "git_commit_node"
    description: "Gitæäº¤èŠ‚ç‚¹"

# ğŸ”„ å·¥ä½œæµè¾¹é…ç½®
workflow_edges:
  - type: "simple"
    from: "task_splitting"
    to: "git_management"
  - type: "conditional"
    from: "git_management"
    condition_function: "check_git_setup_success"
    conditions:
      success: "intelligent_coding"
      retry: "git_management"
      fail: "END"
  - type: "conditional"
    from: "intelligent_coding"
    condition_function: "check_coding_completion"
    conditions:
      all_completed: "code_review"
      partial_completed: "intelligent_coding"
      dependencies_waiting: "intelligent_coding"
      critical_error: "END"
  - type: "conditional"
    from: "code_review"
    condition_function: "check_review_quality"
    conditions:
      quality_passed: "unit_testing"
      quality_failed: "intelligent_coding"
      security_risk: "END"
  - type: "conditional"
    from: "unit_testing"
    condition_function: "check_test_results"
    conditions:
      tests_passed: "git_commit"
      tests_failed: "intelligent_coding"
      coverage_insufficient: "unit_testing"
  - type: "simple"
    from: "git_commit"
    to: "END"

# ğŸ¯ æ‰§è¡Œé˜¶æ®µé…ç½®
entry_node: "task_splitting"
initial_phase: "task_splitting"
phases:
  task_splitting: "task_splitting"
  git_management: "git_management"
  intelligent_coding: "intelligent_coding"
  code_review: "code_review"
  unit_testing: "unit_testing"
  git_commit: "git_commit"

# ğŸ”„ æ¡ä»¶æ£€æŸ¥å‡½æ•°é…ç½®
condition_functions:
  - name: "check_git_setup_success"
    description: "æ£€æŸ¥Gitç¯å¢ƒè®¾ç½®æ˜¯å¦æˆåŠŸ"
    logic: |
      if state["repo_initialized"]:
          return "success"
      elif state["retry_count"] < 3:
          return "retry"
      else:
          return "fail"
  - name: "check_coding_completion"
    description: "æ£€æŸ¥ç¼–ç å®ŒæˆçŠ¶æ€"
    logic: |
      total_services = len(state["identified_services"])
      completed_services = len(state["completed_services"])
      
      if completed_services == total_services:
          return "all_completed"
      elif len(state["failed_services"]) > 0:
          return "critical_error"
      else:
          # æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–ç­‰å¾…
          for service in state["identified_services"]:
              if service not in state["completed_services"]:
                  dependencies = state["service_dependencies"].get(service, [])
                  if any(dep not in state["completed_services"] for dep in dependencies):
                      return "dependencies_waiting"
          return "partial_completed"
  - name: "check_review_quality"
    description: "æ£€æŸ¥ä»£ç å®¡æŸ¥è´¨é‡"
    logic: |
      review_results = state.get("code_review_results", {})
      if any(result.get("has_critical_issues", False) for result in review_results.values()):
          return "quality_failed"
      elif any(result.get("security_risk", False) for result in review_results.values()):
          return "security_risk"
      else:
          return "quality_passed"
  - name: "check_test_results"
    description: "æ£€æŸ¥æµ‹è¯•ç»“æœ"
    logic: |
      test_results = state.get("unit_test_results", {})
      coverage_results = state.get("test_coverage", {})
      
      # æ£€æŸ¥æµ‹è¯•æ˜¯å¦é€šè¿‡
      if any(not result.get("all_passed", True) for result in test_results.values()):
          return "tests_failed"
      
      # æ£€æŸ¥è¦†ç›–ç‡
      avg_coverage = sum(coverage_results.values()) / len(coverage_results) if coverage_results else 0
      if avg_coverage < 0.8:  # 80%è¦†ç›–ç‡è¦æ±‚
          return "coverage_insufficient"
      
      return "tests_passed"

# ğŸ§ª æç¤ºè¯é…ç½®
task_splitting_prompts:
  - name: "REQUIREMENTS_ANALYSIS_PROMPT"
    description: "éœ€æ±‚åˆ†ææç¤ºè¯"
  - name: "DESIGN_ANALYSIS_PROMPT"
    description: "è®¾è®¡åˆ†ææç¤ºè¯"
  - name: "SERVICE_BOUNDARY_PROMPT"
    description: "æœåŠ¡è¾¹ç•Œè¯†åˆ«æç¤ºè¯"
  - name: "DEPENDENCY_ANALYSIS_PROMPT"
    description: "ä¾èµ–åˆ†ææç¤ºè¯"
  - name: "TASK_SCHEDULING_PROMPT"
    description: "ä»»åŠ¡è°ƒåº¦æç¤ºè¯"

coding_prompts:
  - name: "SERVICE_ANALYSIS_PROMPT"
    description: "æœåŠ¡åˆ†ææç¤ºè¯"
  - name: "CODE_GENERATION_PROMPT"
    description: "ä»£ç ç”Ÿæˆæç¤ºè¯"
  - name: "API_DESIGN_PROMPT"
    description: "APIè®¾è®¡æç¤ºè¯"
  - name: "SERVICE_INTERCONNECT_PROMPT"
    description: "æœåŠ¡äº’è”æç¤ºè¯"

# ğŸ“ ç¤ºä¾‹é…ç½®
sample_project_name: "ecommerce-system"
sample_requirements: |
  ç”µå•†è®¢å•ç³»ç»Ÿéœ€æ±‚ï¼š
  1. ç”¨æˆ·æœåŠ¡ï¼šç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ç”¨æˆ·ä¿¡æ¯ç®¡ç†
  2. äº§å“æœåŠ¡ï¼šäº§å“å±•ç¤ºã€åº“å­˜ç®¡ç†ã€ä»·æ ¼ç®¡ç†
  3. è®¢å•æœåŠ¡ï¼šè®¢å•åˆ›å»ºã€æ”¯ä»˜å¤„ç†ã€è®¢å•çŠ¶æ€ç®¡ç†
  4. é€šçŸ¥æœåŠ¡ï¼šè®¢å•çŠ¶æ€å˜æ›´é€šçŸ¥ã€ç”¨æˆ·æ¶ˆæ¯æ¨é€
  
  ä¸»è¦åŠŸèƒ½ï¼š
  - ç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•
  - ç”¨æˆ·å¯ä»¥æµè§ˆäº§å“å¹¶ä¸‹å•
  - ç³»ç»Ÿå¤„ç†è®¢å•æ”¯ä»˜
  - è®¢å•çŠ¶æ€å˜æ›´æ—¶å‘é€é€šçŸ¥

sample_design: |
  æŠ€æœ¯è®¾è®¡ï¼š
  - æ¶æ„ï¼šSpring Bootå¾®æœåŠ¡æ¶æ„
  - æ³¨å†Œä¸­å¿ƒï¼šNacos
  - æ•°æ®åº“ï¼šMySQL + MyBatis
  - æœåŠ¡é—´è°ƒç”¨ï¼šFeign + RestTemplate
  
  æœåŠ¡ä¾èµ–å…³ç³»ï¼š
  - è®¢å•æœåŠ¡ä¾èµ–ç”¨æˆ·æœåŠ¡ï¼ˆè·å–ç”¨æˆ·ä¿¡æ¯ï¼‰
  - è®¢å•æœåŠ¡ä¾èµ–äº§å“æœåŠ¡ï¼ˆæ£€æŸ¥åº“å­˜å’Œä»·æ ¼ï¼‰
  - é€šçŸ¥æœåŠ¡ä¾èµ–è®¢å•æœåŠ¡ï¼ˆç›‘å¬è®¢å•çŠ¶æ€å˜æ›´ï¼‰
  
  Gitä»“åº“ï¼šhttps://github.com/company/ecommerce-system.git 