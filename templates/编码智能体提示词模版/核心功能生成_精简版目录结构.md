# 🗂️ 编码智能体精简版目录结构

## 📁 项目整体结构

```
document_analyzer/
├── src/
│   ├── corder_integration/           # 编码智能体核心模块
│   │   ├── __init__.py
│   │   ├── langgraph/               # LangGraph工作流
│   │   │   ├── __init__.py
│   │   │   ├── core_state.py        # 核心状态定义
│   │   │   ├── core_workflow.py     # 工作流编排器
│   │   │   └── nodes/               # 5个核心节点
│   │   │       ├── __init__.py
│   │   │       ├── task_splitting_node.py      # 任务拆分节点
│   │   │       ├── git_code_reading_node.py    # Git代码读取节点
│   │   │       ├── code_modification_node.py   # 代码修改节点
│   │   │       ├── code_checking_node.py       # 代码检查节点
│   │   │       └── git_commit_push_node.py     # Git提交推送节点
│   │   ├── agents/                  # 智能体基类（可选）
│   │   │   ├── __init__.py
│   │   │   └── base_agent.py        # 基础智能体类
│   │   ├── prompts/                 # 提示词模板（可选）
│   │   │   ├── __init__.py
│   │   │   └── coding_prompts.py    # 编码相关提示词
│   │   └── utils/                   # 工具函数
│   │       ├── __init__.py
│   │       ├── git_utils.py         # Git操作工具
│   │       └── file_utils.py        # 文件操作工具
│   ├── api/                         # 现有API接口
│   │   ├── coder_agent_api.py       # 编码智能体API
│   │   └── ...
│   └── main.py                      # 主入口文件
├── templates/                       # 模板文件
├── requirements.txt                 # 依赖包
├── README.md                       # 项目说明
└── .env                            # 环境变量
```

---

## 📝 核心文件说明

### 1. `core_state.py` - 状态定义
```python
"""
定义CoreCodingState状态结构
包含输入、Git状态、代码修改、检查结果等
"""
```

### 2. `core_workflow.py` - 工作流编排
```python
"""
核心工作流编排器
- 构建LangGraph工作流
- 管理5个节点的执行顺序
- 处理条件分支和错误重试
"""
```

### 3. 5个核心节点
- **`task_splitting_node.py`** - 利用GPT-4分析设计方案，拆分开发任务
- **`git_code_reading_node.py`** - 读取指定Git分支的Java代码
- **`code_modification_node.py`** - 基于任务要求修改现有代码
- **`code_checking_node.py`** - 检查修改后代码的正确性
- **`git_commit_push_node.py`** - 提交代码并推送到Git分支

---

## 🔧 依赖包配置

### `requirements.txt`
```txt
# LangGraph工作流
langgraph>=0.0.40
langchain>=0.1.0
langchain-openai>=0.0.5

# OpenAI API
openai>=1.0.0

# Git操作
GitPython>=3.1.0

# 异步支持
asyncio
aiohttp

# 现有依赖
fastapi
uvicorn
python-dotenv
```

### `.env` 环境变量
```env
# OpenAI配置
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4

# Git配置
GIT_USER_NAME=your_git_username
GIT_USER_EMAIL=your_git_email

# 项目配置
PROJECT_ROOT=/path/to/your/projects
LOG_LEVEL=INFO
```

---

## 🚀 集成到现有项目

### 1. 修改 `coder_agent_api.py`
```python
# 在现有API中添加新的端点
from src.corder_integration.langgraph.core_workflow import CoreCodingWorkflow

@app.post("/process-design-document")
async def process_design_document(
    design_document: str,
    project_name: str,
    repo_path: str,
    target_branch: str = "main"
):
    """处理设计文档并生成代码"""
    
    workflow = CoreCodingWorkflow()
    
    result = await workflow.execute(
        design_document=design_document,
        project_name=project_name,
        repo_path=repo_path,
        target_branch=target_branch
    )
    
    return result
```

### 2. 修改 `main.py`
```python
# 添加新的导入
from src.corder_integration.langgraph.core_workflow import CoreCodingWorkflow

# 可以在主函数中测试工作流
if __name__ == "__main__":
    import asyncio
    
    # 测试工作流
    async def test_workflow():
        workflow = CoreCodingWorkflow()
        result = await workflow.execute(
            design_document="测试设计文档",
            project_name="test-project",
            repo_path="/path/to/test/repo",
            target_branch="feature/test"
        )
        print(result)
    
    asyncio.run(test_workflow())
```

---

## 🎯 实施步骤

### 第1步：创建基础结构
```bash
# 创建目录结构
mkdir -p src/corder_integration/langgraph/nodes
mkdir -p src/corder_integration/agents
mkdir -p src/corder_integration/prompts
mkdir -p src/corder_integration/utils

# 创建__init__.py文件
touch src/corder_integration/__init__.py
touch src/corder_integration/langgraph/__init__.py
touch src/corder_integration/langgraph/nodes/__init__.py
touch src/corder_integration/agents/__init__.py
touch src/corder_integration/prompts/__init__.py
touch src/corder_integration/utils/__init__.py
```

### 第2步：安装依赖
```bash
pip install -r requirements.txt
```

### 第3步：配置环境变量
```bash
# 复制.env.example到.env并配置
cp .env.example .env
# 编辑.env文件，添加OpenAI API Key等配置
```

### 第4步：逐步实现核心文件
1. 实现 `core_state.py` - 状态定义
2. 实现 `core_workflow.py` - 工作流编排
3. 实现5个节点文件
4. 测试工作流
5. 集成到现有API

---

## 🔍 测试策略

### 单元测试
```python
# tests/test_core_workflow.py
import pytest
from src.corder_integration.langgraph.core_workflow import CoreCodingWorkflow

@pytest.mark.asyncio
async def test_task_splitting():
    workflow = CoreCodingWorkflow()
    # 测试任务拆分节点
    pass

@pytest.mark.asyncio  
async def test_git_code_reading():
    # 测试Git代码读取节点
    pass

# 更多测试...
```

### 集成测试
```python
# tests/test_integration.py
@pytest.mark.asyncio
async def test_full_workflow():
    """测试完整工作流"""
    workflow = CoreCodingWorkflow()
    
    result = await workflow.execute(
        design_document="测试设计文档",
        project_name="test-project", 
        repo_path="/path/to/test/repo",
        target_branch="feature/test"
    )
    
    assert result["success"] == True
    assert "commit_hash" in result
```

---

## 📊 项目优势

### 🎯 精简设计
- **5个核心节点**：覆盖完整的编码流程
- **清晰职责**：每个节点功能明确
- **易于维护**：模块化设计，便于扩展

### 🔧 技术优势
- **LangGraph**：强大的工作流编排能力
- **GPT-4**：智能代码分析和生成
- **Git集成**：完整的版本控制支持
- **异步处理**：高效的并发执行

### 🚀 实施优势
- **渐进式开发**：可以逐步实现和测试
- **现有集成**：可以轻松集成到现有项目
- **可扩展性**：后续可以添加更多节点和功能

这个精简版目录结构简洁明了，易于理解和实施！ 