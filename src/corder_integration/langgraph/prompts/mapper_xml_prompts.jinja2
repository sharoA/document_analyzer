{# Mapper XMLæ–‡ä»¶ç”Ÿæˆä¸“é—¨æç¤ºè¯æ¨¡æ¿ #}

{% macro mapper_xml_prompt(interface_name, mapper_methods, entity_fields, table_name, project_context) %}
# ğŸ“„ MyBatis Mapper XMLç”Ÿæˆä¸“å®¶

ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„MyBatis XMLæ˜ å°„æ–‡ä»¶ç”Ÿæˆä¸“å®¶ï¼Œä¸“é—¨è´Ÿè´£ç”Ÿæˆå®Œæ•´çš„Mapper XMLæ–‡ä»¶ã€‚

## ğŸ“‹ ç”Ÿæˆä»»åŠ¡
ä¸º{{ interface_name }}Mapperæ¥å£ç”Ÿæˆå®Œæ•´çš„XMLæ˜ å°„æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰æ–¹æ³•çš„SQLå®ç°ã€‚

### åŸºæœ¬ä¿¡æ¯
- **Mapperæ¥å£**: {{ interface_name }}Mapper
- **å®ä½“ç±»**: {{ interface_name }}
- **æ•°æ®è¡¨**: {{ table_name }}
- **å‘½åç©ºé—´**: {{ project_context.get('package_patterns', {}).get('base_package', 'com.example') }}.domain.mapper.{{ interface_name }}Mapper

### Mapperæ¥å£æ–¹æ³•åˆ—è¡¨
{% for method in mapper_methods %}
- **æ–¹æ³•å**: {{ method.name }}
- **è¿”å›ç±»å‹**: {{ method.return_type }}
- **å‚æ•°**: {{ method.parameters }}
- **SQLç±»å‹**: {{ method.sql_type }}
{% endfor %}

### å®ä½“å­—æ®µæ˜ å°„
{% for field in entity_fields %}
- **Javaå­—æ®µ**: {{ field.java_name }} ({{ field.java_type }})
- **æ•°æ®åº“åˆ—**: {{ field.column_name }} ({{ field.jdbc_type }})
{% endfor %}

## ğŸ¯ XMLç”Ÿæˆè¦æ±‚

### 1. æ–‡ä»¶ç»“æ„
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="{{ project_context.get('package_patterns', {}).get('base_package', 'com.example') }}.domain.mapper.{{ interface_name }}Mapper">

    <!-- ç»“æœæ˜ å°„ -->
    <resultMap id="BaseResultMap" type="{{ project_context.get('package_patterns', {}).get('base_package', 'com.example') }}.domain.entity.{{ interface_name }}">
        <id column="id" property="id" jdbcType="BIGINT"/>
        {% for field in entity_fields %}
        <result column="{{ field.column_name }}" property="{{ field.java_name }}" jdbcType="{{ field.jdbc_type }}"/>
        {% endfor %}
    </resultMap>

    <!-- åŸºç¡€åˆ—å -->
    <sql id="Base_Column_List">
        id, {% for field in entity_fields %}{{ field.column_name }}{% if not loop.last %}, {% endif %}{% endfor %}
    </sql>

    <!-- è¡¨å -->
    <sql id="Table_Name">
        {{ table_name }}
    </sql>

    <!-- é€šç”¨æŸ¥è¯¢æ¡ä»¶ -->
    <sql id="Base_Where_Clause">
        <where>
            {% for field in entity_fields %}
            <if test="{{ field.java_name }} != null{% if field.java_type == 'String' %} and {{ field.java_name }} != ''{% endif %}">
                AND {{ field.column_name }} = #{{'{'}}{{ field.java_name }}{{'}'}}
            </if>
            {% endfor %}
        </where>
    </sql>

    <!-- å®ç°æ‰€æœ‰Mapperæ¥å£æ–¹æ³• -->
    {% for method in mapper_methods %}
    <!-- {{ method.description }} -->
    {% if method.sql_type == 'SELECT' %}
    <select id="{{ method.name }}" resultMap="BaseResultMap">
        {{ method.sql_template }}
    </select>
    {% elif method.sql_type == 'INSERT' %}
    <insert id="{{ method.name }}" parameterType="{{ project_context.get('package_patterns', {}).get('base_package', 'com.example') }}.domain.entity.{{ interface_name }}">
        {{ method.sql_template }}
    </insert>
    {% elif method.sql_type == 'UPDATE' %}
    <update id="{{ method.name }}">
        {{ method.sql_template }}
    </update>
    {% elif method.sql_type == 'DELETE' %}
    <delete id="{{ method.name }}">
        {{ method.sql_template }}
    </delete>
    {% endif %}
    {% endfor %}

</mapper>
```

### 2. SQLæ¨¡æ¿ç¤ºä¾‹

#### æ¡ä»¶æŸ¥è¯¢æ¨¡æ¿
```xml
<select id="selectByCondition" resultMap="BaseResultMap">
    SELECT
    <include refid="Base_Column_List"/>
    FROM
    <include refid="Table_Name"/>
    <include refid="Base_Where_Clause"/>
    ORDER BY id DESC
</select>
```

#### åˆ†é¡µæŸ¥è¯¢æ¨¡æ¿
```xml
<select id="selectPageList" resultMap="BaseResultMap">
    SELECT
    <include refid="Base_Column_List"/>
    FROM
    <include refid="Table_Name"/>
    <where>
        {% for field in entity_fields %}
        <if test="params.{{ field.java_name }} != null{% if field.java_type == 'String' %} and params.{{ field.java_name }} != ''{% endif %}">
            AND {{ field.column_name }} = #{{'{'}}params.{{ field.java_name }}{{'}'}}
        </if>
        {% endfor %}
    </where>
    ORDER BY id DESC
</select>
```

#### è‡ªå®šä¹‰æŸ¥è¯¢æ¨¡æ¿
```xml
<select id="customQuery" resultMap="BaseResultMap">
    SELECT
    <include refid="Base_Column_List"/>
    FROM
    <include refid="Table_Name"/>
    WHERE 1=1
    {% for field in entity_fields %}
    <if test="{{ field.java_name }} != null{% if field.java_type == 'String' %} and {{ field.java_name }} != ''{% endif %}">
        AND {{ field.column_name }} = #{{'{'}}{{ field.java_name }}{{'}'}}
    </if>
    {% endfor %}
</select>
```

## ğŸ’¡ å…³é”®è¦æ±‚
1. **æ–¹æ³•å®Œæ•´æ€§**: XMLæ–‡ä»¶å¿…é¡»åŒ…å«Mapperæ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•
2. **SQLæ­£ç¡®æ€§**: ç¡®ä¿SQLè¯­æ³•æ­£ç¡®ï¼Œè¡¨åå’Œå­—æ®µååŒ¹é…
3. **å‚æ•°æ˜ å°„**: æ­£ç¡®å¤„ç†æ–¹æ³•å‚æ•°å’ŒSQLå‚æ•°çš„æ˜ å°„
4. **ç»“æœæ˜ å°„**: å®Œæ•´çš„resultMapæ˜ å°„æ‰€æœ‰å®ä½“å­—æ®µ
5. **åŠ¨æ€SQL**: ä½¿ç”¨MyBatisåŠ¨æ€SQLå¤„ç†å¯é€‰æ¡ä»¶
6. **æ€§èƒ½ä¼˜åŒ–**: åˆç†ä½¿ç”¨ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–

### ç‰¹æ®Šè¦æ±‚
- è¡¨å: {{ table_name }}
- å­—æ®µæ˜ å°„è¦å‡†ç¡®
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢
- åŒ…å«å¸¸ç”¨çš„CRUDæ“ä½œ
- åŠ¨æ€æ¡ä»¶æŸ¥è¯¢

è¯·ç”Ÿæˆå®Œæ•´çš„Mapper XMLæ–‡ä»¶ï¼Œç¡®ä¿æ‰€æœ‰æ–¹æ³•éƒ½æœ‰å¯¹åº”çš„SQLå®ç°ã€‚
{% endmacro %}