{#
å•å…ƒæµ‹è¯•ç”Ÿæˆæç¤ºè¯æ¨¡æ¿
è´Ÿè´£ä¸ºSpring Booté¡¹ç›®ç”Ÿæˆé«˜è´¨é‡çš„JUnit 5æµ‹è¯•ä»£ç 
#}

{% macro test_generation_prompt(service_name, service_code) %}
è¯·ä¸ºä»¥ä¸‹Spring BootæœåŠ¡ç”Ÿæˆå®Œæ•´çš„å•å…ƒæµ‹è¯•å¥—ä»¶ï¼š

## ğŸ“‹ æœåŠ¡åŸºæœ¬ä¿¡æ¯
**æœåŠ¡åç§°**: {{ service_name }}

## ğŸ§ª æµ‹è¯•ç”Ÿæˆè¦æ±‚

### 1. æµ‹è¯•æ¡†æ¶å’Œå·¥å…·
- **ä¸»æ¡†æ¶**: JUnit 5 (Jupiter)
- **Mockæ¡†æ¶**: Mockito 4.x
- **Springæµ‹è¯•**: Spring Boot Test
- **æ–­è¨€åº“**: AssertJ (æ¨è) æˆ– JUnit Assertions
- **æµ‹è¯•å®¹å™¨**: Testcontainers (å¦‚éœ€è¦)

### 2. æµ‹è¯•åˆ†å±‚ç­–ç•¥

#### Controllerå±‚æµ‹è¯• (@WebMvcTest)
- ä½¿ç”¨`@WebMvcTest`æ³¨è§£è¿›è¡Œåˆ‡ç‰‡æµ‹è¯•
- ä½¿ç”¨`MockMvc`æ¨¡æ‹ŸHTTPè¯·æ±‚
- Mock Serviceå±‚ä¾èµ–
- æµ‹è¯•HTTPçŠ¶æ€ç ã€å“åº”æ ¼å¼ã€å¼‚å¸¸å¤„ç†
- éªŒè¯è¯·æ±‚å‚æ•°æ ¡éªŒé€»è¾‘

#### Serviceå±‚æµ‹è¯• (@ExtendWith(MockitoExtension.class))
- ä½¿ç”¨Mockito Mockå¤–éƒ¨ä¾èµ–
- æµ‹è¯•ä¸šåŠ¡é€»è¾‘çš„å„ç§åˆ†æ”¯
- éªŒè¯å¼‚å¸¸å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶
- æµ‹è¯•äº‹åŠ¡å¤„ç†é€»è¾‘

#### Repositoryå±‚æµ‹è¯• (@DataJpaTest)
- ä½¿ç”¨å†…å­˜æ•°æ®åº“H2è¿›è¡Œæµ‹è¯•
- æµ‹è¯•è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•
- éªŒè¯æ•°æ®å®Œæ•´æ€§çº¦æŸ
- æµ‹è¯•çº§è”æ“ä½œå’Œå…³è”å…³ç³»

#### é›†æˆæµ‹è¯• (@SpringBootTest)
- ç«¯åˆ°ç«¯æµ‹è¯•ä¸»è¦ä¸šåŠ¡æµç¨‹
- ä½¿ç”¨TestRestTemplateæˆ–WebTestClient
- æµ‹è¯•æœåŠ¡é—´äº¤äº’
- éªŒè¯å®Œæ•´çš„æ•°æ®æµ

### 3. æµ‹è¯•è¦†ç›–ç›®æ ‡
- **ä»£ç è¦†ç›–ç‡**: 90%+
- **åˆ†æ”¯è¦†ç›–ç‡**: 85%+
- **å¼‚å¸¸è·¯å¾„**: è¦†ç›–æ‰€æœ‰å¼‚å¸¸åœºæ™¯
- **è¾¹ç•Œæ¡ä»¶**: æµ‹è¯•è¾¹ç•Œå€¼å’Œæç«¯æƒ…å†µ

### 4. æµ‹è¯•æ•°æ®ç®¡ç†
- ä½¿ç”¨`@Sql`æ³¨è§£åŠ è½½æµ‹è¯•æ•°æ®
- åˆ›å»ºTest Fixtureså’ŒBuilderæ¨¡å¼
- ä½¿ç”¨TestDataFactoryç”Ÿæˆæµ‹è¯•æ•°æ®
- ç¡®ä¿æµ‹è¯•é—´æ•°æ®éš”ç¦»

### 5. æµ‹è¯•æœ€ä½³å®è·µ
- **å‘½åè§„èŒƒ**: ä½¿ç”¨Given_When_Thenæ¨¡å¼
- **æµ‹è¯•ç»“æ„**: Arrange-Act-Assert (AAA)
- **æµ‹è¯•ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•æ–¹æ³•ç‹¬ç«‹è¿è¡Œ
- **æ€§èƒ½è€ƒè™‘**: é¿å…è¿‡æ…¢çš„é›†æˆæµ‹è¯•
- **å¯è¯»æ€§**: æ¸…æ™°çš„æµ‹è¯•æ„å›¾å’Œæ–­è¨€

## ğŸ“Š è¾“å‡ºæ ¼å¼è¦æ±‚
è¯·ä»¥JSONæ ¼å¼è¾“å‡ºå®Œæ•´çš„æµ‹è¯•ä»£ç ç»“æ„ï¼š

```json
{
    "service_name": "{{ service_name }}",
    "test_framework": "JUnit 5",
    "coverage_target": "90%",
    "test_files": {
        "src/test/java/com/company/{{ service_name.lower() }}/controller/{{ service_name }}ControllerTest.java": "å®Œæ•´çš„Controlleræµ‹è¯•ä»£ç ",
        "src/test/java/com/company/{{ service_name.lower() }}/service/{{ service_name }}ServiceTest.java": "å®Œæ•´çš„Serviceæµ‹è¯•ä»£ç ",
        "src/test/java/com/company/{{ service_name.lower() }}/repository/{{ service_name }}RepositoryTest.java": "å®Œæ•´çš„Repositoryæµ‹è¯•ä»£ç ",
        "src/test/java/com/company/{{ service_name.lower() }}/integration/{{ service_name }}IntegrationTest.java": "å®Œæ•´çš„é›†æˆæµ‹è¯•ä»£ç ",
        "src/test/java/com/company/{{ service_name.lower() }}/util/TestDataFactory.java": "æµ‹è¯•æ•°æ®å·¥å‚ç±»",
        "src/test/java/com/company/{{ service_name.lower() }}/config/TestConfiguration.java": "æµ‹è¯•é…ç½®ç±»"
    },
    "test_dependencies": [
        {
            "groupId": "org.springframework.boot",
            "artifactId": "spring-boot-starter-test",
            "scope": "test",
            "version": "3.1.0"
        },
        {
            "groupId": "org.testcontainers",
            "artifactId": "junit-jupiter",
            "scope": "test",
            "version": "1.18.0"
        },
        {
            "groupId": "com.h2database",
            "artifactId": "h2",
            "scope": "test",
            "version": "2.1.214"
        }
    ],
    "test_configuration": {
        "application-test.yml": "æµ‹è¯•ç¯å¢ƒé…ç½®æ–‡ä»¶å†…å®¹",
        "test-data.sql": "æµ‹è¯•æ•°æ®åˆå§‹åŒ–SQLè„šæœ¬",
        "logback-test.xml": "æµ‹è¯•æ—¥å¿—é…ç½®"
    },
    "test_profiles": [
        {
            "profile": "unit-test",
            "description": "å•å…ƒæµ‹è¯•é…ç½®",
            "features": ["fast", "isolated", "mocked"]
        },
        {
            "profile": "integration-test", 
            "description": "é›†æˆæµ‹è¯•é…ç½®",
            "features": ["database", "external-services", "end-to-end"]
        }
    ],
    "test_utilities": {
        "custom_matchers": "è‡ªå®šä¹‰æ–­è¨€åŒ¹é…å™¨",
        "test_helpers": "æµ‹è¯•è¾…åŠ©å·¥å…·ç±»",
        "mock_configurations": "Mocké…ç½®å·¥å…·"
    },
    "performance_tests": {
        "load_tests": "è´Ÿè½½æµ‹è¯•ä»£ç ",
        "stress_tests": "å‹åŠ›æµ‹è¯•ä»£ç ",
        "benchmark_tests": "æ€§èƒ½åŸºå‡†æµ‹è¯•"
    },
    "test_documentation": {
        "testing_strategy": "æµ‹è¯•ç­–ç•¥æ–‡æ¡£",
        "test_scenarios": "æµ‹è¯•åœºæ™¯æè¿°",
        "coverage_reports": "è¦†ç›–ç‡æŠ¥å‘Šé…ç½®"
    },
    "ci_cd_integration": {
        "maven_surefire": "Maven Surefireæ’ä»¶é…ç½®",
        "jacoco_coverage": "JaCoCoä»£ç è¦†ç›–ç‡é…ç½®",
        "test_reports": "æµ‹è¯•æŠ¥å‘Šé…ç½®"
    }
}
```

## ğŸ” å¾…æµ‹è¯•ä»£ç 
{{ service_code | tojson }}

## ğŸ“ ç‰¹æ®Šè¦æ±‚
1. ç¡®ä¿æ‰€æœ‰publicæ–¹æ³•éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•
2. é‡ç‚¹æµ‹è¯•å¼‚å¸¸å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶
3. éªŒè¯æ•°æ®æ ¡éªŒæ³¨è§£çš„æœ‰æ•ˆæ€§
4. æµ‹è¯•äº‹åŠ¡å›æ»šå’Œæ•°æ®ä¸€è‡´æ€§
5. åŒ…å«æ€§èƒ½æµ‹è¯•å’Œå¹¶å‘æµ‹è¯•
6. ç”Ÿæˆæ¸…æ™°çš„æµ‹è¯•æ–‡æ¡£å’Œæ³¨é‡Š

è¯·åŸºäºä¸Šè¿°è¦æ±‚ç”Ÿæˆé«˜è´¨é‡çš„æµ‹è¯•ä»£ç ï¼Œç¡®ä¿è¾“å‡ºçš„JSONæ ¼å¼æ­£ç¡®ä¸”æµ‹è¯•è¦†ç›–å…¨é¢ã€‚
{% endmacro %} 