{#- Feign Clientæ¥å£ç”Ÿæˆæç¤ºè¯æ¨¡æ¿ -#}

{% macro feign_client_generation_prompt(service_name, target_service, api_info, project_context) %}
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Javaåç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºå¾®æœåŠ¡é—´çš„Feignæ¥å£è°ƒç”¨ã€‚

## ğŸ¯ ä»»åŠ¡è¦æ±‚
ä¸º {{ service_name }} æœåŠ¡ç”Ÿæˆè°ƒç”¨ {{ target_service }} æœåŠ¡çš„Feign Clientæ¥å£ã€‚

## ğŸ“‹ ç›®æ ‡æœåŠ¡ä¿¡æ¯
- **ç›®æ ‡æœåŠ¡**: {{ target_service }}
- **APIè·¯å¾„**: {{ api_info.api_path }}
- **HTTPæ–¹æ³•**: {{ api_info.http_method }}
- **è¯·æ±‚å‚æ•°**: {{ api_info.request_params | tojson }}
- **å“åº”å‚æ•°**: {{ api_info.response_params | tojson }}

## ğŸ—ï¸ é¡¹ç›®ä¸Šä¸‹æ–‡
{{ project_context }}

## ğŸ“ ç”Ÿæˆè¦æ±‚

### 1. Feign Clientæ¥å£è§„èŒƒ
```java
@FeignClient(name = "{{ target_service }}", url = "${feign.{{ target_service }}.url:http://localhost:8080}")
public interface {{ target_service | title }}FeignClient {
    
    @{{ api_info.http_method.title() }}Mapping("{{ api_info.api_path }}")
    ResponseEntity<{{ target_service | title }}Response> {{ api_info.method_name }}(
        {% if api_info.request_params %}@RequestBody {{ target_service | title }}Request request{% endif %}
    );
}
```

### 2. é…ç½®ç±»è¦æ±‚
```java
@Configuration
@EnableFeignClients(basePackages = "com.yljr.crcl.*.application.feign")
public class FeignConfig {
    
    @Bean
    public Logger.Level feignLoggerLevel() {
        return Logger.Level.FULL;
    }
}
```

### 3. DTOç±»è¦æ±‚
- Request DTO: åŒ…å«æ‰€æœ‰è¯·æ±‚å‚æ•°
- Response DTO: åŒ¹é…ç›®æ ‡æœåŠ¡çš„å“åº”ç»“æ„
- ä½¿ç”¨javax.validationæ³¨è§£è¿›è¡Œå‚æ•°æ ¡éªŒ

### 4. é”™è¯¯å¤„ç†
```java
@Component
public class FeignErrorDecoder implements ErrorDecoder {
    
    @Override
    public Exception decode(String methodKey, Response response) {
        // æ ¹æ®HTTPçŠ¶æ€ç å¤„ç†ä¸åŒé”™è¯¯
        switch (response.status()) {
            case 400:
                return new BadRequestException("è¯·æ±‚å‚æ•°é”™è¯¯");
            case 404:
                return new NotFoundException("æœåŠ¡ä¸å­˜åœ¨");
            case 500:
                return new InternalServerException("å†…éƒ¨æœåŠ¡é”™è¯¯");
            default:
                return new FeignException.Default(methodKey, response);
        }
    }
}
```

## ğŸ”„ è°ƒç”¨é“¾è¯´æ˜
åœ¨DDDæ¶æ„ä¸­ï¼ŒFeign Clientçš„è°ƒç”¨é“¾ä¸ºï¼š
Controller â†’ Application Service â†’ Feign Client â†’ ç›®æ ‡æœåŠ¡

## ğŸ“¤ è¾“å‡ºæ ¼å¼
è¯·ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶çš„å®Œæ•´ä»£ç ï¼š

1. **Feign Clientæ¥å£** (application/feign/{{ target_service | title }}FeignClient.java)
2. **Request DTO** (interfaces/dto/{{ target_service | title }}Request.java)
3. **Response DTO** (interfaces/dto/{{ target_service | title }}Response.java)
4. **Feigné…ç½®ç±»** (config/FeignConfig.java)
5. **é”™è¯¯è§£ç å™¨** (config/FeignErrorDecoder.java)

è¯·ç¡®ä¿æ‰€æœ‰ä»£ç éƒ½ç¬¦åˆä¼ä¸šçº§å¼€å‘è§„èŒƒï¼ŒåŒ…å«å®Œæ•´çš„æ³¨é‡Šå’Œå¼‚å¸¸å¤„ç†ã€‚
{% endmacro %} 